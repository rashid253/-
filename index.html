<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Digital Business Card Â· Complete Suite</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, #0b1120 0%, #19233c 100%);
      font-family: 'Inter', sans-serif;
      padding: 16px;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
    }

    .card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(2px);
      border-radius: 32px;
      padding: 24px 20px;
      margin-bottom: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      overflow: visible;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .card-header i {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      flex-shrink: 0;
    }

    .card-header h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #0f172a;
      line-height: 1.3;
    }

    .card-header p {
      font-size: 0.8rem;
      color: #475569;
    }

    .input-group {
      margin-bottom: 18px;
      width: 100%;
    }

    .input-group label {
      display: block;
      font-weight: 600;
      font-size: 0.85rem;
      color: #1e293b;
      margin-bottom: 6px;
    }

    .input-group input,
    .input-group textarea,
    .input-group select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 20px;
      font-size: 0.95rem;
      background: white;
      transition: 0.2s;
      font-family: 'Inter', sans-serif;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .file-upload {
      border: 2px dashed #cbd5e1;
      border-radius: 24px;
      padding: 20px;
      text-align: center;
      background: #f8fafc;
      position: relative;
      cursor: pointer;
      transition: 0.2s;
    }

    .file-upload:hover {
      border-color: #3b82f6;
      background: #f1f5f9;
    }

    .file-upload i {
      font-size: 28px;
      color: #3b82f6;
      margin-bottom: 6px;
    }

    .file-upload span {
      display: block;
      font-weight: 500;
      color: #1e293b;
    }

    .file-upload small {
      font-size: 0.75rem;
      color: #64748b;
    }

    .file-upload input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .preview-image {
      max-width: 80px;
      max-height: 80px;
      border-radius: 16px;
      margin-top: 12px;
      border: 2px solid #e2e8f0;
      display: none;
      object-fit: cover;
    }

    .social-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .social-input {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f1f5f9;
      border-radius: 18px;
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
    }

    .social-input i {
      font-size: 1.2rem;
      min-width: 20px;
    }

    .social-input input {
      border: none;
      background: transparent;
      width: 100%;
      padding: 0;
      font-size: 0.85rem;
    }

    .social-input input:focus {
      outline: none;
    }

    .day-box {
      background: #f8fafc;
      border-radius: 24px;
      padding: 18px;
      margin-bottom: 12px;
      border: 2px solid #e2e8f0;
    }

    .day-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .day-name {
      font-weight: 700;
      color: #0f172a;
      min-width: 90px;
    }

    .day-status {
      padding: 8px 14px;
      border-radius: 40px;
      border: 2px solid #cbd5e1;
      background: white;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .day-time {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-left: 0;
    }

    .day-time input {
      padding: 10px 14px;
      border-radius: 40px;
      border: 2px solid #cbd5e1;
      background: white;
      flex: 1 1 110px;
    }

    .holiday-item {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      background: #f8fafc;
      border-radius: 20px;
      padding: 14px;
      border: 2px solid #e2e8f0;
      margin-bottom: 10px;
    }

    .holiday-item > * {
      flex: 1 1 auto;
    }

    .holiday-item input {
      padding: 12px;
      border: 2px solid #cbd5e1;
      border-radius: 18px;
    }

    .remove-btn {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      background: #ef4444;
      color: white;
      border: none;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      flex-shrink: 0;
    }

    .add-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      padding: 16px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
    }

    .zone-item {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      background: #f8fafc;
      border-radius: 20px;
      padding: 14px;
      border: 2px solid #e2e8f0;
      margin-bottom: 10px;
    }

    .zone-item input {
      padding: 12px;
      border: 2px solid #cbd5e1;
      border-radius: 18px;
      flex: 1 1 100px;
    }

    .zone-item button {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 18px;
      width: 48px;
      height: 48px;
      font-size: 1.4rem;
      cursor: pointer;
    }

    .products-scroll {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding: 8px 4px 16px;
      scrollbar-width: thin;
      -webkit-overflow-scrolling: touch;
    }

    .product-card {
      min-width: 280px;
      background: white;
      border-radius: 28px;
      padding: 20px;
      border: 2px solid #e2e8f0;
      flex-shrink: 0;
    }

    .product-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0 0;
    }

    .product-badges label {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #f1f5f9;
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 0.8rem;
    }

    .btn {
      padding: 16px 24px;
      border: none;
      border-radius: 40px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      margin-bottom: 16px;
      transition: 0.2s;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 12px;
      box-sizing: border-box;
    }

    .modal-content {
      background: white;
      border-radius: 40px;
      width: 100%;
      max-width: 460px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      margin: 0 auto;
    }

    .modal-header {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      padding: 22px 24px;
      border-radius: 40px 40px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .modal-header h2 {
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-close {
      background: rgba(255,255,255,0.25);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 20px;
      font-size: 1.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      padding: 24px;
    }

    .payment-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .payment-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 28px;
      overflow: hidden;
    }

    .payment-card.selected {
      border-color: #10b981;
      box-shadow: 0 8px 20px rgba(16,185,129,0.15);
    }

    .payment-card-header {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
    }

    .payment-icon {
      width: 52px;
      height: 52px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: white;
      flex-shrink: 0;
    }

    .payment-info {
      flex: 1;
    }

    .payment-name {
      font-weight: 700;
      color: #0f172a;
      font-size: 1.1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
    }

    .payment-badge {
      background: #10b981;
      color: white;
      padding: 4px 10px;
      border-radius: 40px;
      font-size: 0.7rem;
    }

    .payment-desc {
      font-size: 0.8rem;
      color: #475569;
    }

    .payment-chevron {
      color: #94a3b8;
      transition: 0.2s;
    }

    .payment-card.selected .payment-chevron {
      transform: rotate(180deg);
      color: #10b981;
    }

    .payment-fields {
      padding: 0 20px 24px 86px;
      display: none;
    }

    .payment-card.selected .payment-fields {
      display: block;
    }

    .field-row {
      margin-bottom: 18px;
    }

    .field-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #334155;
      margin-bottom: 5px;
    }

    .field-input, .field-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 24px;
      font-size: 0.9rem;
      background: white;
    }

    .token-preview {
      background: #0f172a;
      border-radius: 28px;
      padding: 20px;
      margin: 20px 0;
      color: white;
    }

    .token-code {
      font-family: 'Courier New', monospace;
      font-size: 1.4rem;
      font-weight: 800;
      color: #10b981;
      text-align: center;
      padding: 14px;
      background: rgba(255,255,255,0.08);
      border-radius: 20px;
      word-break: break-word;
    }

    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .toggle-switch input[type=checkbox] {
      width: 48px;
      height: 26px;
      appearance: none;
      background: #cbd5e1;
      border-radius: 40px;
      position: relative;
      cursor: pointer;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .toggle-switch input:checked {
      background: #10b981;
    }

    .toggle-switch input::before {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: 0.2s;
    }

    .toggle-switch input:checked::before {
      left: 24px;
    }

    .toggle-switch label {
      font-weight: 600;
      color: #1e293b;
    }

    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
    }

    .loading-spinner {
      width: 54px;
      height: 54px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .success-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #10b981;
      color: white;
      padding: 14px 28px;
      border-radius: 60px;
      font-weight: 600;
      box-shadow: 0 15px 30px rgba(16,185,129,0.5);
      z-index: 4000;
      display: none;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      max-width: 90vw;
    }

    @media (max-width: 420px) {
      .payment-fields { padding-left: 20px; }
      .day-time input { flex: 1 1 100%; }
      .social-grid { grid-template-columns: 1fr; }
      .modal-body { padding: 16px; }
    }
  </style>
</head>
<body>
<div class="container">

<div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i> <span id="successText">Success</span></div>
<div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text">Creating your professional digital business card...</div></div>

<!-- PROFILE SECTION -->
<div class="card">
  <div class="card-header"><i class="fas fa-user"></i><div><h2>Profile Information</h2><p>Your personal and business details</p></div></div>
  <div class="input-group"><label>Profile Image</label><div class="file-upload"><i class="fas fa-cloud-upload-alt"></i><span>Click to upload profile picture</span><small>PNG, JPG up to 5MB</small><input type="file" id="profileImage" accept="image/*"></div></div>
  <div class="input-group"><label>Full Name <span style="color:#ef4444;">*</span></label><input type="text" id="fullName" placeholder="Enter your full name"></div>
  <div class="input-group"><label>Phone Number <span style="color:#ef4444;">*</span></label><input type="tel" id="phoneNumber" placeholder="03XXXXXXXXX"></div>
  <div class="input-group"><label>Email Address</label><input type="email" id="email" placeholder="your@email.com"></div>
  <div class="input-group"><label>Business Address <span style="color:#ef4444;">*</span></label><textarea id="address" rows="2" placeholder="Complete business address"></textarea></div>
</div>

<!-- BUSINESS DETAILS -->
<div class="card">
  <div class="card-header"><i class="fas fa-building"></i><div><h2>Business Details</h2><p>Your business identity</p></div></div>
  <div class="input-group"><label>Business Title <span style="color:#ef4444;">*</span></label><input type="text" id="businessName" placeholder="Your business name"></div>
  <div class="input-group"><label>About Business</label><textarea id="businessAbout" rows="3" placeholder="Describe your business..."></textarea></div>
  <div class="input-group"><label>Website URL</label><input type="url" id="website" placeholder="https://yourwebsite.com"></div>
  
  <h3 style="font-size:1rem; margin:20px 0 12px;">Social Media Links</h3>
  <div class="social-grid">
    <div class="social-input"><i class="fab fa-facebook" style="color:#1877F2;"></i><input type="text" id="facebook" placeholder="Facebook URL"></div>
    <div class="social-input"><i class="fab fa-instagram" style="color:#E4405F;"></i><input type="text" id="instagram" placeholder="Instagram URL"></div>
    <div class="social-input"><i class="fab fa-twitter" style="color:#1DA1F2;"></i><input type="text" id="twitter" placeholder="Twitter URL"></div>
    <div class="social-input"><i class="fab fa-linkedin" style="color:#0A66C2;"></i><input type="text" id="linkedin" placeholder="LinkedIn URL"></div>
    <div class="social-input"><i class="fab fa-youtube" style="color:#FF0000;"></i><input type="text" id="youtube" placeholder="YouTube URL"></div>
    <div class="social-input"><i class="fab fa-tiktok"></i><input type="text" id="tiktok" placeholder="TikTok URL"></div>
  </div>
</div>

<!-- BUSINESS HOURS -->
<div class="card">
  <div class="card-header"><i class="fas fa-clock"></i><div><h2>Business Hours</h2><p>Set your working days and times</p></div></div>
  <div id="daysContainer"></div>
</div>

<!-- SPECIAL HOLIDAYS -->
<div class="card">
  <div class="card-header"><i class="fas fa-calendar-times"></i><div><h2>Special Holidays</h2><p>Days when business is closed</p></div></div>
  <div id="holidaysContainer">
    <div class="holiday-item">
      <input type="text" class="holidayName" placeholder="Holiday name" value="Eid ul-Fitr">
      <input type="date" class="holidayDate" value="2026-04-10">
      <button type="button" class="remove-btn" onclick="removeHoliday(this)">Ã—</button>
    </div>
  </div>
  <button class="add-btn" onclick="addHoliday()"><i class="fas fa-plus"></i> Add Holiday</button>
</div>

<!-- DELIVERY SETTINGS -->
<div class="card">
  <div class="card-header"><i class="fas fa-truck"></i><div><h2>Delivery Settings</h2><p>Configure delivery charges and zones</p></div></div>
  
  <h3 style="font-size:1rem; margin-bottom:16px;">Default Delivery</h3>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>Within City (PKR)</label><input type="number" id="deliveryChargeCity" value="150"></div>
    <div class="input-group"><label>Other Cities (PKR)</label><input type="number" id="deliveryChargeOther" value="300"></div>
  </div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>Within City Time</label><input type="text" id="deliveryTimeCity" value="1-2 business days"></div>
    <div class="input-group"><label>Other Cities Time</label><input type="text" id="deliveryTimeOther" value="3-5 business days"></div>
  </div>
  <div class="input-group"><label>Free Delivery Minimum (PKR)</label><input type="number" id="freeDeliveryMin" value="2000"></div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>Cutoff Time</label><input type="time" id="deliveryCutoffTime" value="16:00"></div>
    <div class="input-group"><label>Max Delivery Days</label><input type="text" id="deliveryDays" value="5-7 days"></div>
  </div>
  
  <h3 style="font-size:1rem; margin:24px 0 16px;">Specific Zones</h3>
  <div id="deliveryZonesList"></div>
  <button class="add-btn" onclick="addDeliveryZone()" style="background:#8b5cf6"><i class="fas fa-plus"></i> Add Zone</button>
  
  <div style="margin-top:20px; background:#f0f9ff; border-radius:20px; padding:16px;">
    <div class="toggle-switch"><input type="checkbox" id="requireAddressConfirmation" checked><label>Require address confirmation</label></div>
    <div class="toggle-switch"><input type="checkbox" id="saveCustomerAddresses" checked><label>Save customer addresses</label></div>
  </div>
</div>

<!-- PRODUCTS & OFFERS -->
<div class="card">
  <div class="card-header"><i class="fas fa-gift"></i><div><h2>Products & Offers</h2><p>Add your products to sell</p></div></div>
  <div id="offersForm" class="products-scroll"></div>
  <button class="add-btn" onclick="addOffer()" style="background:#8b5cf6; margin-top:16px;"><i class="fas fa-plus"></i> Add Product</button>
</div>

<!-- ACTION BUTTONS -->
<button class="btn btn-success" onclick="openPaymentModal()"><i class="fas fa-credit-card"></i> Configure Payments & Tokens</button>
<button class="btn btn-primary" onclick="generate()"><i class="fas fa-magic"></i> Generate Digital Card</button>

<!-- PAYMENT MODAL - COMPLETE -->
<div class="modal" id="paymentModal">
  <div class="modal-content">
    <div class="modal-header"><h2><i class="fas fa-cog"></i> Payment & Token System</h2><button class="modal-close" onclick="closePaymentModal()">Ã—</button></div>
    <div class="modal-body">
      
      <!-- WhatsApp Business -->
      <h3 style="display:flex; gap:8px; margin-bottom:16px;"><i class="fab fa-whatsapp" style="color:#25D366;"></i> WhatsApp Business</h3>
      <div class="input-group"><label>WhatsApp Number</label><input type="text" id="whatsappNumber" placeholder="+92XXXXXXXXXX" value="+92"></div>
      <div class="input-hint" style="font-size:0.75rem; color:#64748b; margin-top:-10px; margin-bottom:16px;">Orders will be sent to this number</div>
      
      <div style="background:#e6f7ff; border-radius:24px; padding:16px; margin:20px 0;">
        <h4 style="display:flex; gap:8px; color:#25D366; margin-bottom:12px;"><i class="fab fa-whatsapp"></i> Order Preview</h4>
        <div style="background:white; border-radius:16px; padding:16px; font-family:monospace; font-size:0.85rem; white-space:pre-wrap; border:1px solid #bae6fd;" id="whatsappPreview">
ðŸŽ‰ *NEW ORDER CONFIRMED* - TOKEN: TKT-123456-A7F2

*Order ID:* ORD-12345678
*Token:* TKT-123456-A7F2
*Customer:* [Customer Name]
*Phone:* [Customer Phone]
*Address:* [Full Address]

*ITEMS:*
â€¢ Product 1 (Qty: 1) - PKR 1,000

*Total:* PKR 1,150
        </div>
      </div>
      
      <!-- Token System -->
      <h3 style="margin:24px 0 12px;"><i class="fas fa-ticket-alt" style="color:#667eea;"></i> Token System</h3>
      <div class="toggle-switch"><input type="checkbox" id="enableTokenSystem" checked><label>Enable token generation</label></div>
      <div class="toggle-switch"><input type="checkbox" id="requireTokenForTracking" checked><label>Require token for tracking</label></div>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:16px;">
        <div class="input-group"><label>Token Prefix</label><input type="text" id="tokenPrefix" value="TKT"></div>
        <div class="input-group"><label>Length</label>
          <select id="tokenLength">
            <option value="8">8 chars</option>
            <option value="10">10 chars</option>
            <option value="12" selected>12 chars</option>
          </select>
        </div>
      </div>
      
      <div class="token-preview">
        <div style="text-align:center; margin-bottom:8px; font-size:0.75rem; color:#94a3b8;">Sample Token</div>
        <div class="token-code" id="tokenPreview">TKT-12345678-A1B2</div>
        <div class="token-format" style="display:flex; justify-content:space-between; font-size:0.7rem; color:#94a3b8; margin-top:8px;">
          <span>Prefix</span><span>Timestamp</span><span>Random</span>
        </div>
      </div>
      
      <!-- Payment Gateways - COMPLETE with all fields -->
      <h3 style="margin:28px 0 12px;"><i class="fas fa-credit-card" style="color:#667eea;"></i> Payment Gateways <span style="background:#10b981; color:white; padding:4px 8px; border-radius:30px; font-size:0.6rem; margin-left:8px;">Multiple Select</span></h3>
      
      <div class="payment-grid" id="paymentGateways">
        <!-- JazzCash -->
        <div class="payment-card" id="gateway-jazzcash">
          <div class="payment-card-header" onclick="togglePaymentGateway('jazzcash')">
            <div class="payment-icon" style="background:#FF6B00;"><i class="fas fa-mobile-alt"></i></div>
            <div class="payment-info"><div class="payment-name">JazzCash <span class="payment-badge" id="jazzcash-badge" style="display:none;">Active</span></div><div class="payment-desc">Mobile wallet payments</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-jazzcash">
            <div class="field-row"><label class="field-label">Account Number</label><input class="field-input" id="jazzcashNumber" value="03001234567"></div>
            <div class="field-row"><label class="field-label">Account Type</label>
              <select class="field-select" id="jazzcashType">
                <option value="jazzcash">JazzCash Account</option>
                <option value="easypaisa">EasyPaisa Account</option>
              </select>
            </div>
            <div class="field-row"><label class="field-label">QR Code (Optional)</label>
              <div class="file-upload"><i class="fas fa-qrcode"></i><span>Click to upload QR code</span><small>PNG, JPG</small><input type="file" id="jazzcashBarcode" accept="image/*" onchange="handleFileUpload(this,'jazzcash')"></div>
              <img id="jazzcash-preview" class="preview-image">
            </div>
          </div>
        </div>
        
        <!-- EasyPaisa -->
        <div class="payment-card" id="gateway-easypaisa">
          <div class="payment-card-header" onclick="togglePaymentGateway('easypaisa')">
            <div class="payment-icon" style="background:#0A5C36;"><i class="fas fa-wallet"></i></div>
            <div class="payment-info"><div class="payment-name">EasyPaisa <span class="payment-badge" id="easypaisa-badge" style="display:none;">Active</span></div><div class="payment-desc">Mobile account payments</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-easypaisa">
            <div class="field-row"><label class="field-label">Account Number</label><input class="field-input" id="easypaisaNumber" value="03001234567"></div>
            <div class="field-row"><label class="field-label">QR Code (Optional)</label>
              <div class="file-upload"><i class="fas fa-qrcode"></i><span>Click to upload QR code</span><input type="file" id="easypaisaBarcode" accept="image/*" onchange="handleFileUpload(this,'easypaisa')"></div>
              <img id="easypaisa-preview" class="preview-image">
            </div>
          </div>
        </div>
        
        <!-- Bank Transfer -->
        <div class="payment-card" id="gateway-bank">
          <div class="payment-card-header" onclick="togglePaymentGateway('bank')">
            <div class="payment-icon" style="background:#2563eb;"><i class="fas fa-university"></i></div>
            <div class="payment-info"><div class="payment-name">Bank Transfer <span class="payment-badge" id="bank-badge" style="display:none;">Active</span></div><div class="payment-desc">Direct bank deposit</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-bank">
            <div class="field-row"><label class="field-label">Bank Name</label>
              <select class="field-select" id="bankName">
                <option value="HBL">Habib Bank Limited (HBL)</option>
                <option value="UBL">United Bank Limited (UBL)</option>
                <option value="MCB">MCB Bank Limited</option>
                <option value="Meezan">Meezan Bank</option>
                <option value="Alfalah">Bank Alfalah</option>
                <option value="Other">Other Bank</option>
              </select>
            </div>
            <div class="field-row"><label class="field-label">Account Title</label><input class="field-input" id="accountTitle" value="Business Account"></div>
            <div class="field-row"><label class="field-label">Account Number</label><input class="field-input" id="accountNumber" value="1234567890"></div>
            <div class="field-row"><label class="field-label">IBAN (Optional)</label><input class="field-input" id="ibanNumber" value="PK36HBL001234567890"></div>
          </div>
        </div>
        
        <!-- Card Payment -->
        <div class="payment-card" id="gateway-card">
          <div class="payment-card-header" onclick="togglePaymentGateway('card')">
            <div class="payment-icon" style="background:#8b5cf6;"><i class="fas fa-credit-card"></i></div>
            <div class="payment-info"><div class="payment-name">Card Payment <span class="payment-badge" id="card-badge" style="display:none;">Active</span></div><div class="payment-desc">Visa / Mastercard</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-card">
            <div class="field-row"><label class="field-label">Processor</label>
              <select class="field-select" id="cardProcessor">
                <option value="stripe">Stripe</option>
                <option value="paypal">PayPal</option>
                <option value="razorpay">Razorpay</option>
              </select>
            </div>
            <div class="field-row"><label class="field-label">Merchant ID / Key</label><input class="field-input" id="merchantId" value="pk_test_xxxxxxxxxxxx"></div>
            <div class="field-row"><label class="field-label">Webhook Secret</label><input class="field-input" id="webhookSecret" placeholder="whsec_..."></div>
          </div>
        </div>
        
        <!-- Cash on Delivery -->
        <div class="payment-card" id="gateway-cod">
          <div class="payment-card-header" onclick="togglePaymentGateway('cod')">
            <div class="payment-icon" style="background:#10b981;"><i class="fas fa-truck"></i></div>
            <div class="payment-info"><div class="payment-name">Cash on Delivery <span class="payment-badge" id="cod-badge" style="display:none;">Active</span></div><div class="payment-desc">Pay when order arrives</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-cod">
            <div class="toggle-switch"><input type="checkbox" id="codEnabled" checked><label>Enable COD</label></div>
            <div class="field-row"><label class="field-label">Minimum Order (PKR)</label><input class="field-input" id="codMinimumOrder" value="500"></div>
          </div>
        </div>
        
        <!-- Cryptocurrency -->
        <div class="payment-card" id="gateway-crypto">
          <div class="payment-card-header" onclick="togglePaymentGateway('crypto')">
            <div class="payment-icon" style="background:#f7931a;"><i class="fab fa-bitcoin"></i></div>
            <div class="payment-info"><div class="payment-name">Cryptocurrency <span class="payment-badge" id="crypto-badge" style="display:none;">Active</span></div><div class="payment-desc">BTC, ETH, USDT</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields" id="fields-crypto">
            <div class="field-row"><label class="field-label">Wallet Address</label><input class="field-input" id="cryptoWalletAddress" value="0x742d35Cc6634C0532925a3b844Bc454e4438f44e"></div>
            <div class="field-row"><label class="field-label">Network</label>
              <select class="field-select" id="cryptoNetwork">
                <option value="ERC20">Ethereum (ERC-20)</option>
                <option value="BEP20">Binance (BEP-20)</option>
                <option value="TRC20">Tron (TRC-20)</option>
              </select>
            </div>
            <div class="field-row"><label class="field-label">QR Code (Optional)</label>
              <div class="file-upload"><i class="fas fa-qrcode"></i><span>Click to upload QR code</span><input type="file" id="cryptoBarcode" accept="image/*" onchange="handleFileUpload(this,'crypto')"></div>
              <img id="crypto-preview" class="preview-image">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ticket System -->
      <h3 style="margin:30px 0 16px;"><i class="fas fa-ticket-alt" style="color:#0ea5e9;"></i> Ticket System</h3>
      <div class="toggle-switch"><input type="checkbox" id="enableAutoTickets" checked><label>Generate order tickets</label></div>
      <div class="toggle-switch"><input type="checkbox" id="enableEmailTickets" checked><label>Send email tickets</label></div>
      <div class="toggle-switch"><input type="checkbox" id="enableWhatsappTickets" checked><label>Send WhatsApp tickets</label></div>
      
      <div class="field-row"><label class="field-label">Ticket Prefix</label><input class="field-input" id="ticketPrefix" value="TKT"></div>
      <div class="field-row"><label class="field-label">Admin Email</label><input class="field-input" id="adminEmail" placeholder="admin@yourbusiness.com"></div>
      <div class="field-row"><label class="field-label">Webhook URL (Optional)</label><input class="field-input" id="webhookUrl" placeholder="https://yourdomain.com/webhook"></div>
      
      <!-- Modal Actions -->
      <button class="btn btn-success" onclick="savePaymentAndTicketSettings()" style="margin:20px 0 12px;"><i class="fas fa-save"></i> Save All Settings</button>
      <button class="btn btn-outline" onclick="testTokenGeneration()" style="background:white; border:2px solid #e2e8f0; color:#1e293b;"><i class="fas fa-flask"></i> Test Token Generation</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  // Supabase client
  const db = supabase.createClient(
    "https://dfvnefbxgayxqgjjgtrr.supabase.co",
    "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
  );

  // Global variables
  let selectedPaymentGateways = [];
  let paymentData = {
    jazzcash: { number: '03001234567', type: 'jazzcash', barcode: '' },
    easypaisa: { number: '03001234567', barcode: '' },
    bank: { bankName: 'HBL', accountTitle: 'Business Account', accountNumber: '1234567890', iban: 'PK36HBL001234567890' },
    card: { processor: 'stripe', merchantId: 'pk_test_xxxxxxxxxxxx', webhookSecret: '' },
    cod: { enabled: true, minimumOrder: 500 },
    crypto: { walletAddress: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e', network: 'ERC20', barcode: '' }
  };
  let ticketSettings = {
    enableAutoTickets: true,
    enableEmailTickets: true,
    enableWhatsappTickets: true,
    ticketPrefix: 'TKT',
    adminEmail: '',
    webhookUrl: ''
  };
  let productCount = 0;

  // Utility functions
  function showSuccess(message) {
    const el = document.getElementById('successMessage');
    document.getElementById('successText').textContent = message;
    el.style.display = 'flex';
    setTimeout(() => el.style.display = 'none', 2500);
  }

  function showLoading() {
    document.getElementById('loadingOverlay').style.display = 'flex';
  }

  function hideLoading() {
    document.getElementById('loadingOverlay').style.display = 'none';
  }

  // Business hours initialization
  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  const daysContainer = document.getElementById('daysContainer');
  days.forEach(day => {
    const dayBox = document.createElement('div');
    dayBox.className = 'day-box';
    dayBox.innerHTML = `
      <div class="day-header">
        <span class="day-name">${day}</span>
        <select class="day-status" style="padding:8px; border-radius:8px; border:2px solid #e2e8f0;">
          <option value="open" selected>Open</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      <div class="day-time">
        <input type="time" class="day-start" value="09:00">
        <span>to</span>
        <input type="time" class="day-end" value="18:00">
      </div>
    `;
    daysContainer.appendChild(dayBox);
  });

  // Holiday functions
  window.addHoliday = function() {
    const container = document.getElementById('holidaysContainer');
    const item = document.createElement('div');
    item.className = 'holiday-item';
    item.innerHTML = `
      <input type="text" class="holidayName" placeholder="Holiday name">
      <input type="date" class="holidayDate" value="${new Date().toISOString().split('T')[0]}">
      <button type="button" class="remove-btn" onclick="removeHoliday(this)">Ã—</button>
    `;
    container.appendChild(item);
  };

  window.removeHoliday = function(btn) {
    btn.parentElement.remove();
  };

  // Product functions
  window.addOffer = function() {
    productCount++;
    const box = document.createElement('div');
    box.className = 'product-card';
    box.innerHTML = `
      <h4 style="margin-bottom:12px;">Product ${productCount}</h4>
      <div class="file-upload" style="margin-bottom:12px;">
        <i class="fas fa-image"></i><span>Product Image</span>
        <input type="file" class="productImg" accept="image/*">
      </div>
      <input type="text" class="productTitle" placeholder="Product Title" style="width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:8px;">
      <textarea class="productDesc" placeholder="Description" rows="2" style="width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:8px;"></textarea>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:12px;">
        <input type="number" class="originalPrice" placeholder="Original Price" style="padding:12px; border:2px solid #e2e8f0; border-radius:10px;">
        <input type="number" class="discountPrice" placeholder="Discounted Price" style="padding:12px; border:2px solid #e2e8f0; border-radius:10px;">
      </div>
      <div class="product-badges">
        <label><input type="checkbox" value="ðŸ”¥ Hot Deal"> Hot Deal</label>
        <label><input type="checkbox" value="â­ Best Seller"> Best Seller</label>
        <label><input type="checkbox" value="ðŸ’¸ Discount"> Discount</label>
      </div>
    `;
    document.getElementById('offersForm').appendChild(box);
  };

  // Delivery zone functions
  window.addDeliveryZone = function(zoneData) {
    const container = document.getElementById('deliveryZonesList');
    const zoneItem = document.createElement('div');
    zoneItem.className = 'zone-item';
    zoneItem.innerHTML = `
      <input type="text" placeholder="City Name" value="${zoneData?.city || ''}">
      <input type="number" placeholder="Charge" value="${zoneData?.charge || ''}">
      <input type="text" placeholder="Delivery Time" value="${zoneData?.time || ''}">
      <button onclick="this.parentElement.remove()">Ã—</button>
    `;
    container.appendChild(zoneItem);
  };

  // Payment modal functions
  window.openPaymentModal = function() {
    document.getElementById('paymentModal').style.display = 'flex';
    testTokenGeneration();
  };

  window.closePaymentModal = function() {
    document.getElementById('paymentModal').style.display = 'none';
  };

  window.togglePaymentGateway = function(gateway) {
    const index = selectedPaymentGateways.indexOf(gateway);
    if (index === -1) {
      selectedPaymentGateways.push(gateway);
    } else {
      selectedPaymentGateways.splice(index, 1);
    }
    
    document.querySelectorAll('.payment-card').forEach(c => c.classList.remove('selected'));
    
    selectedPaymentGateways.forEach(g => {
      const card = document.getElementById(`gateway-${g}`);
      if (card) {
        card.classList.add('selected');
        const badge = document.getElementById(`${g}-badge`);
        if (badge) badge.style.display = 'inline-block';
      }
    });
    
    ['jazzcash','easypaisa','bank','card','cod','crypto'].forEach(g => {
      if (!selectedPaymentGateways.includes(g)) {
        const badge = document.getElementById(`${g}-badge`);
        if (badge) badge.style.display = 'none';
      }
    });
  };

  window.updatePaymentData = function(gateway, field, value) {
    if (!paymentData[gateway]) paymentData[gateway] = {};
    paymentData[gateway][field] = value;
  };

  window.handleFileUpload = function(input, gateway) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById(`${gateway}-preview`);
        if (preview) {
          preview.src = e.target.result;
          preview.style.display = 'block';
        }
        if (!paymentData[gateway]) paymentData[gateway] = {};
        paymentData[gateway].barcodeFile = input.files[0];
      };
      reader.readAsDataURL(input.files[0]);
      showSuccess(`QR uploaded for ${gateway}`);
    }
  };

  window.updateTicketSetting = function(setting, value) {
    ticketSettings[setting] = value;
  };

  window.testTokenGeneration = function() {
    const prefix = document.getElementById('tokenPrefix')?.value || 'TKT';
    const timestamp = Date.now().toString().slice(-8);
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let random = '';
    for (let i = 0; i < 4; i++) {
      random += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById('tokenPreview').textContent = `${prefix}-${timestamp}-${random}`;
  };

  window.savePaymentAndTicketSettings = function() {
    showSuccess('âœ… Payment settings saved successfully!');
    setTimeout(() => closePaymentModal(), 1200);
  };

  // Image compression
  async function resizeImage(file) {
    return new Promise((resolve) => {
      if (!file) { resolve(''); return; }
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        const maxSize = 1024;
        let width = img.width;
        let height = img.height;
        
        if (width > height) {
          if (width > maxSize) {
            height *= maxSize / width;
            width = maxSize;
          }
        } else {
          if (height > maxSize) {
            width *= maxSize / height;
            height = maxSize;
          }
        }
        
        canvas.width = width;
        canvas.height = height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, width, height);
        resolve(canvas.toDataURL('image/jpeg', 0.85));
      };
      img.src = URL.createObjectURL(file);
    });
  }

  // Main generate function
  window.generate = async function() {
    // Validation
    if (!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value) {
      showSuccess('âŒ Name & Phone are required');
      return;
    }
    if (!document.getElementById('businessName').value) {
      showSuccess('âŒ Business title is required');
      return;
    }
    if (!document.getElementById('address').value) {
      showSuccess('âŒ Business address is required');
      return;
    }

    showLoading();

    try {
      const id = crypto.randomUUID();
      
      // Collect business hours
      const businessHours = [];
      document.querySelectorAll('.day-box').forEach(box => {
        businessHours.push({
          status: box.querySelector('.day-status').value,
          start: box.querySelector('.day-start').value,
          end: box.querySelector('.day-end').value
        });
      });

      // Collect holidays
      const holidays = [];
      document.querySelectorAll('#holidaysContainer .holiday-item').forEach(item => {
        const name = item.querySelector('.holidayName').value;
        const date = item.querySelector('.holidayDate').value;
        if (name && date) holidays.push({ name, date });
      });

      // Collect products
      const products = [];
      const productBoxes = document.querySelectorAll('.product-card');
      
      for (let i = 0; i < productBoxes.length; i++) {
        const box = productBoxes[i];
        const file = box.querySelector('.productImg').files[0];
        
        const product = {
          title: box.querySelector('.productTitle').value || '',
          desc: box.querySelector('.productDesc').value || '',
          originalPrice: parseFloat(box.querySelector('.originalPrice').value) || null,
          discountPrice: parseFloat(box.querySelector('.discountPrice').value) || null,
          badges: Array.from(box.querySelectorAll('input[type=checkbox]:checked')).map(cb => cb.value),
          image: file ? await resizeImage(file) : ''
        };
        
        if (product.title || product.image) products.push(product);
      }

      // Collect delivery zones
      const zones = [];
      document.querySelectorAll('#deliveryZonesList .zone-item').forEach(zone => {
        const inputs = zone.querySelectorAll('input');
        zones.push({
          city: inputs[0].value,
          charge: parseFloat(inputs[1].value),
          time: inputs[2].value
        });
      });

      // Process barcode files
      for (const gw of ['jazzcash', 'easypaisa', 'crypto']) {
        if (paymentData[gw]?.barcodeFile) {
          paymentData[gw].barcode = await resizeImage(paymentData[gw].barcodeFile);
        }
      }

      // Build payment methods
      const paymentMethods = {
        whatsapp: {
          active: !!document.getElementById('whatsappNumber').value,
          number: document.getElementById('whatsappNumber').value
        },
        gateways: {},
        tokenSystem: {
          enabled: document.getElementById('enableTokenSystem').checked,
          requireTokenForTracking: document.getElementById('requireTokenForTracking').checked,
          prefix: document.getElementById('tokenPrefix').value,
          length: parseInt(document.getElementById('tokenLength').value)
        }
      };

      selectedPaymentGateways.forEach(gateway => {
        if (gateway === 'cod') {
          paymentMethods.gateways.cod = {
            active: document.getElementById('codEnabled').checked,
            minimumOrder: parseFloat(document.getElementById('codMinimumOrder').value)
          };
        } else {
          paymentMethods.gateways[gateway] = {
            active: true,
            ...paymentData[gateway]
          };
        }
      });

      // Build complete card data
      const cardData = {
        id,
        name: document.getElementById('fullName').value,
        phone: document.getElementById('phoneNumber').value,
        email: document.getElementById('email').value,
        address: document.getElementById('address').value,
        businessName: document.getElementById('businessName').value,
        business: { about: document.getElementById('businessAbout').value },
        socialMedia: {
          facebook: document.getElementById('facebook').value,
          instagram: document.getElementById('instagram').value,
          twitter: document.getElementById('twitter').value,
          linkedin: document.getElementById('linkedin').value,
          youtube: document.getElementById('youtube').value,
          tiktok: document.getElementById('tiktok').value,
          website: document.getElementById('website').value
        },
        businessHours,
        holidays,
        products,
        payments: paymentMethods,
        deliverySettings: {
          default: {
            withinCity: {
              charge: parseFloat(document.getElementById('deliveryChargeCity').value),
              time: document.getElementById('deliveryTimeCity').value
            },
            otherCities: {
              charge: parseFloat(document.getElementById('deliveryChargeOther').value),
              time: document.getElementById('deliveryTimeOther').value
            }
          },
          zones,
          freeDeliveryMin: parseFloat(document.getElementById('freeDeliveryMin').value),
          cutoffTime: document.getElementById('deliveryCutoffTime').value,
          maxDays: document.getElementById('deliveryDays').value,
          addressConfirmation: {
            required: document.getElementById('requireAddressConfirmation').checked,
            saveAddresses: document.getElementById('saveCustomerAddresses').checked
          }
        },
        ticketSettings: {
          enableAutoTickets: document.getElementById('enableAutoTickets').checked,
          enableEmailTickets: document.getElementById('enableEmailTickets').checked,
          enableWhatsappTickets: document.getElementById('enableWhatsappTickets').checked,
          ticketPrefix: document.getElementById('ticketPrefix').value,
          adminEmail: document.getElementById('adminEmail').value,
          webhookUrl: document.getElementById('webhookUrl').value
        },
        version: '3.0.0',
        created: new Date().toISOString()
      };

      // Add profile image
      if (document.getElementById('profileImage').files[0]) {
        cardData.profileImage = await resizeImage(document.getElementById('profileImage').files[0]);
      }

      // Save to Supabase
      const { data: inserted, error } = await db.from('cards').insert({
        id,
        data: JSON.stringify(cardData)
      }).select().single();

      if (error) throw error;

      localStorage.setItem('lastCardId', inserted.id);
      hideLoading();
      showSuccess('âœ… Card created! Redirecting...');
      
      setTimeout(() => {
        location.href = 'card.html?id=' + inserted.id;
      }, 2000);

    } catch (error) {
      hideLoading();
      console.error('Error:', error);
      showSuccess('âŒ Error: ' + error.message);
    }
  };

  // Initialize
  document.addEventListener('DOMContentLoaded', function() {
    // Add sample zones
    addDeliveryZone({city: 'Karachi', charge: 150, time: '1-2 days'});
    addDeliveryZone({city: 'Lahore', charge: 200, time: '2-3 days'});
    addDeliveryZone({city: 'Islamabad', charge: 250, time: '2-3 days'});
    
    // Add first product
    addOffer();
    
    // Select COD by default
    setTimeout(() => {
      togglePaymentGateway('cod');
    }, 100);
    
    // Update WhatsApp preview
    document.getElementById('businessName').addEventListener('input', function(e) {
      const preview = document.getElementById('whatsappPreview');
      if (preview) {
        preview.innerHTML = `ðŸŽ‰ *NEW ORDER CONFIRMED* - TOKEN: TKT-123456-A7F2\n\n*Order ID:* ORD-12345678\n*Token:* TKT-123456-A7F2\n*Customer:* [Customer Name]\n*Phone:* [Customer Phone]\n*Address:* [Full Address]\n\n*ITEMS:*\nâ€¢ Product 1 (Qty: 1) - PKR 1,000\n\n*Total:* PKR 1,150\n\nThank you for your order from ${e.target.value}! ðŸ›ï¸`;
      }
    });
    
    // Token preview on change
    document.getElementById('tokenPrefix').addEventListener('input', testTokenGeneration);
    document.getElementById('tokenLength').addEventListener('change', testTokenGeneration);
  });
</script>
</body>
</html>
