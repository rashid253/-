<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Digital Business Card - Professional E-Commerce Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===== PROFESSIONAL STYLING WITH THUMBNAILS ===== */
:root {
  --primary: #667eea;
  --primary-dark: #5a67d8;
  --secondary: #764ba2;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --border: #e2e8f0;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 16px;
}

.container {
  max-width: 480px;
  margin: 0 auto;
  width: 100%;
}

/* ===== CARDS ===== */
.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.card-header i {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 18px;
  flex-shrink: 0;
}

.card-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: var(--dark);
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card-header p {
  font-size: 12px;
  color: var(--gray);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== FILE UPLOAD ===== */
.upload-container {
  margin-bottom: 16px;
}

.upload-area {
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  background: #f8fafc;
}

.upload-area:hover {
  border-color: var(--primary);
  background: #f1f5f9;
}

.upload-area.has-file {
  border-color: var(--success);
  background: #f0fdf4;
}

.upload-area i {
  font-size: 24px;
  color: var(--primary);
  margin-bottom: 8px;
}

.upload-area.has-file i {
  color: var(--success);
}

.upload-area span {
  display: block;
  font-size: 13px;
  color: var(--gray);
  margin-bottom: 4px;
}

.upload-area.has-file span {
  color: var(--success);
  font-weight: 600;
}

.upload-area small {
  font-size: 11px;
  color: #94a3b8;
}

.upload-area.has-file small {
  color: var(--success);
}

.upload-area input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

/* ===== THUMBNAIL PREVIEW ===== */
.thumbnail-preview {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-top: 12px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  border: 2px solid var(--border);
}

.thumbnail-preview.hidden {
  display: none;
}

.thumbnail-image {
  width: 60px;
  height: 60px;
  border-radius: 10px;
  object-fit: cover;
  border: 3px solid var(--primary);
  background: white;
  flex-shrink: 0;
}

.thumbnail-info {
  flex: 1;
  min-width: 0;
}

.thumbnail-name {
  font-weight: 700;
  color: var(--dark);
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.thumbnail-size {
  font-size: 11px;
  color: var(--gray);
  margin-top: 2px;
}

.thumbnail-remove {
  color: var(--danger);
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  padding: 0 8px;
  flex-shrink: 0;
  font-weight: 700;
}

.thumbnail-remove:hover {
  color: #dc2626;
}

/* ===== PRODUCT CARD (fit screen) ===== */
.products-scroll {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 8px 4px 16px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
}

.product-card {
  min-width: 280px;
  width: 85vw;
  max-width: 340px;
  background: white;
  border-radius: 20px;
  padding: 18px 16px;
  border: 2px solid var(--border);
  flex-shrink: 0;
  scroll-snap-align: start;
  box-shadow: 0 6px 12px rgba(0,0,0,0.05);
  box-sizing: border-box;
  overflow: hidden;
}

.product-image-preview {
  width: 100%;
  height: 150px;
  border-radius: 16px;
  object-fit: cover;
  border: 2px solid var(--border);
  margin-bottom: 12px;
  background: #f1f5f9;
  display: none;
}

.product-image-preview.show {
  display: block;
}

.product-image-placeholder {
  width: 100%;
  height: 150px;
  border-radius: 16px;
  background: #f1f5f9;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #94a3b8;
  font-size: 13px;
  margin-bottom: 12px;
  border: 2px dashed var(--border);
  flex-direction: column;
}

.product-image-placeholder i {
  font-size: 36px;
  margin-bottom: 6px;
  color: #cbd5e1;
}

.product-image-placeholder.hidden {
  display: none;
}

.product-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 8px 0 12px;
}

.badge-item {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  background: #f1f5f9;
  padding: 4px 12px;
  border-radius: 30px;
  font-size: 11px;
  font-weight: 600;
  color: var(--dark);
  border: 1px solid var(--border);
}

.badge-item input[type="checkbox"] {
  margin-right: 2px;
  accent-color: var(--primary);
  transform: scale(1.1);
}

.product-card input,
.product-card textarea {
  width: 100%;
  padding: 10px 12px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 13px;
  margin-bottom: 8px;
  box-sizing: border-box;
}

.price-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 8px;
}

.remove-image-btn {
  background: var(--danger);
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 30px;
  font-size: 12px;
  cursor: pointer;
  margin: 6px 0 12px;
  font-weight: 500;
}

/* ===== INPUT GROUPS ===== */
.input-group {
  margin-bottom: 16px;
  width: 100%;
}

.input-group label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 4px;
}

.input-group input,
.input-group textarea,
.input-group select {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  transition: all 0.3s ease;
  background: white;
  box-sizing: border-box;
}

.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.row-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  width: 100%;
}

.social-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 12px;
  width: 100%;
}

.social-input {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px;
  background: #f8fafc;
  border-radius: 10px;
  border: 2px solid var(--border);
  transition: all 0.3s ease;
  width: 100%;
  box-sizing: border-box;
}

.social-input i {
  width: 18px;
  color: var(--gray);
  font-size: 14px;
  flex-shrink: 0;
}

.social-input input {
  flex: 1;
  border: none;
  background: transparent;
  padding: 0;
  font-size: 12px;
  min-width: 0;
  width: 100%;
}

.social-input input:focus {
  outline: none;
}

.btn {
  padding: 14px 20px;
  border: none;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  box-sizing: border-box;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
}

.success-message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
  padding: 12px 20px;
  border-radius: 40px;
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
  z-index: 4000;
  font-weight: 600;
  font-size: 13px;
  display: none;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
  max-width: 90%;
  overflow: hidden;
  text-overflow: ellipsis;
}

.loading-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(10px);
  z-index: 3000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid rgba(255,255,255,0.2);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

.loading-text {
  color: white;
  font-size: 15px;
  font-weight: 600;
  text-align: center;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  padding: 16px;
  box-sizing: border-box;
  overflow-y: auto;
}

.modal-content {
  background: white;
  border-radius: 24px;
  width: 100%;
  max-width: 440px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  margin: auto;
  box-sizing: border-box;
}

.modal-header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 16px 20px;
  border-radius: 24px 24px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

.modal-close {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

/* ===== PAYMENT GATEWAY CARDS (now with functional toggles) ===== */
.payment-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.payment-card {
  background: white;
  border: 2px solid var(--border);
  border-radius: 18px;
  transition: all 0.2s;
}

.payment-card.selected {
  border-color: var(--success);
  background: #f0fdf4;
}

.payment-card-header {
  padding: 14px 16px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  user-select: none;
}

.payment-icon {
  width: 48px;
  height: 48px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 22px;
  flex-shrink: 0;
}

.payment-info {
  flex: 1;
}

.payment-name {
  font-weight: 700;
  color: var(--dark);
  font-size: 16px;
}

.payment-chevron {
  color: var(--gray);
  transition: transform 0.2s;
}

.payment-card.expanded .payment-chevron {
  transform: rotate(180deg);
}

.payment-fields {
  padding: 0 20px 20px 78px; /* left space for icon */
  display: none;
}

.payment-card.expanded .payment-fields {
  display: block;
}

.field-row {
  margin-bottom: 16px;
}

.field-label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  color: var(--gray);
  margin-bottom: 5px;
}

.field-input, .field-textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  background: white;
}

.field-checkbox {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}

/* token preview */
.token-preview {
  background: #1e293b;
  border-radius: 16px;
  padding: 16px;
  margin: 16px 0;
  color: white;
}

/* toggle switches */
.toggle-switch {
  display: flex;
  align-items: center;
  gap: 10px;
}
.toggle-switch input {
  appearance: none;
  width: 44px;
  height: 24px;
  background: var(--border);
  border-radius: 30px;
  position: relative;
  cursor: pointer;
  transition: 0.2s;
}
.toggle-switch input:checked {
  background: var(--success);
}
.toggle-switch input::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: 0.2s;
}
.toggle-switch input:checked::before {
  left: 22px;
}

@media (max-width: 480px) {
  .social-grid { grid-template-columns: repeat(2, 1fr); }
  .row-2 { grid-template-columns: 1fr; }
  .product-card { min-width: 260px; width: 80vw; }
}
</style>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">

<!-- Success Message -->
<div class="success-message" id="successMessage">
  <i class="fas fa-check-circle"></i>
  <span id="successText">Success!</span>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Creating your professional digital business card...</div>
</div>

<!-- ===== PROFILE SECTION ===== (unchanged, keep compact) -->
<div class="card">
  <div class="card-header"><i class="fas fa-user"></i><div><h2>Profile Information</h2><p>Your personal and business details</p></div></div>
  <div class="upload-container">
    <label style="font-size:13px; font-weight:600;">Profile Image</label>
    <div class="upload-area" id="profileUploadArea">
      <i class="fas fa-cloud-upload-alt" id="profileUploadIcon"></i>
      <span id="profileUploadText">Click to upload profile picture</span>
      <small id="profileUploadHint">PNG, JPG up to 5MB</small>
      <input type="file" id="profileImage" accept="image/*" onchange="handleProfileImageUpload(this)">
    </div>
    <div class="thumbnail-preview hidden" id="profilePreviewContainer">
      <img src="" class="thumbnail-image" id="profilePreview"><div class="thumbnail-info"><div class="thumbnail-name" id="profilePreviewName"></div><div class="thumbnail-size" id="profilePreviewSize"></div></div>
      <button class="thumbnail-remove" onclick="removeProfileImage()">√ó</button>
    </div>
  </div>
  <div class="input-group"><label>Full Name *</label><input type="text" id="fullName" placeholder="Enter your full name"></div>
  <div class="input-group"><label>Phone Number *</label><input type="tel" id="phoneNumber" placeholder="03XXXXXXXXX"></div>
  <div class="input-group"><label>Email Address</label><input type="email" id="email" placeholder="your@email.com"></div>
  <div class="input-group"><label>Business Address *</label><textarea id="address" rows="2" placeholder="Complete business address"></textarea></div>
</div>

<!-- ===== BUSINESS DETAILS ===== -->
<div class="card">
  <div class="card-header"><i class="fas fa-building"></i><div><h2>Business Details</h2><p>Your business identity</p></div></div>
  <div class="input-group"><label>Business Title *</label><input type="text" id="businessName" placeholder="Your business name"></div>
  <div class="input-group"><label>About Business</label><textarea id="businessAbout" rows="3" placeholder="Describe your business..."></textarea></div>
  <div class="input-group"><label>Website URL</label><input type="url" id="website" placeholder="https://yourwebsite.com"></div>
  <h3 style="font-size:15px; margin:16px 0 10px;">Social Media Links</h3>
  <div class="social-grid">
    <div class="social-input"><i class="fab fa-facebook" style="color:#1877F2;"></i><input type="text" id="facebook" placeholder="Facebook"></div>
    <div class="social-input"><i class="fab fa-instagram" style="color:#E4405F;"></i><input type="text" id="instagram" placeholder="Instagram"></div>
    <div class="social-input"><i class="fab fa-twitter" style="color:#1DA1F2;"></i><input type="text" id="twitter" placeholder="Twitter"></div>
    <div class="social-input"><i class="fab fa-linkedin" style="color:#0A66C2;"></i><input type="text" id="linkedin" placeholder="LinkedIn"></div>
    <div class="social-input"><i class="fab fa-youtube" style="color:#FF0000;"></i><input type="text" id="youtube" placeholder="YouTube"></div>
    <div class="social-input"><i class="fab fa-tiktok" style="color:#000000;"></i><input type="text" id="tiktok" placeholder="TikTok"></div>
  </div>
</div>

<!-- ===== BUSINESS HOURS ===== -->
<div class="card">
  <div class="card-header"><i class="fas fa-clock"></i><div><h2>Business Hours</h2><p>Set your working days and times</p></div></div>
  <div id="daysContainer"></div>
</div>

<!-- ===== HOLIDAYS ===== -->
<div class="card">
  <div class="card-header"><i class="fas fa-calendar-times"></i><div><h2>Special Holidays</h2><p>Days when business is closed</p></div></div>
  <div id="holidaysContainer">
    <div class="holiday-item" style="display:grid; grid-template-columns:1fr 120px auto; gap:8px; margin-bottom:10px; padding:10px; background:#f8fafc; border-radius:12px; border:2px solid var(--border);">
      <input type="text" class="holidayName" placeholder="Holiday name" value="Eid ul-Fitr" style="padding:8px; border-radius:8px; border:2px solid var(--border);">
      <input type="date" class="holidayDate" style="padding:8px; border-radius:8px; border:2px solid var(--border);">
      <button type="button" class="remove-btn" onclick="removeHoliday(this)" style="width:36px; height:36px; border-radius:8px; background:var(--danger); color:white; border:none; cursor:pointer;">√ó</button>
    </div>
  </div>
  <button class="add-btn" onclick="addHoliday()" style="background:var(--primary); color:white; border:none; padding:12px; border-radius:12px; font-weight:600; width:100%; margin-top:8px; cursor:pointer;"><i class="fas fa-plus"></i> Add Holiday</button>
</div>

<!-- ===== DELIVERY SETTINGS ===== (unchanged) -->
<div class="card">
  <div class="card-header"><i class="fas fa-truck"></i><div><h2>Delivery Settings</h2><p>Configure delivery charges and zones</p></div></div>
  <h3 style="font-size:15px; margin:0 0 12px;">Default Delivery</h3>
  <div class="row-2"><div class="input-group"><label>Within City (PKR)</label><input type="number" id="deliveryChargeCity" value="150"></div><div class="input-group"><label>Other Cities (PKR)</label><input type="number" id="deliveryChargeOther" value="300"></div></div>
  <div class="row-2"><div class="input-group"><label>Within City Time</label><input type="text" id="deliveryTimeCity" value="1-2 business days"></div><div class="input-group"><label>Other Cities Time</label><input type="text" id="deliveryTimeOther" value="3-5 business days"></div></div>
  <div class="input-group"><label>Free Delivery Minimum (PKR)</label><input type="number" id="freeDeliveryMin" value="2000"></div>
  <div class="row-2"><div class="input-group"><label>Cutoff Time</label><input type="time" id="deliveryCutoffTime" value="16:00"></div><div class="input-group"><label>Max Delivery Days</label><input type="text" id="deliveryDays" value="5-7 days"></div></div>
  <h3 style="font-size:15px; margin:20px 0 12px;">Specific Zones</h3><div id="deliveryZonesList"></div>
  <button class="add-btn" onclick="addDeliveryZone()" style="background:#8b5cf6; color:white; border:none; padding:12px; border-radius:12px; font-weight:600; width:100%; margin-bottom:16px; cursor:pointer;"><i class="fas fa-plus"></i> Add Zone</button>
  <div style="background:#f0f9ff; border-radius:14px; padding:14px;">
    <div class="toggle-switch" style="margin-bottom:12px;"><input type="checkbox" id="requireAddressConfirmation" checked><label for="requireAddressConfirmation" style="font-weight:600;">Require address confirmation</label></div>
    <div class="toggle-switch"><input type="checkbox" id="saveCustomerAddresses" checked><label for="saveCustomerAddresses" style="font-weight:600;">Save customer addresses</label></div>
  </div>
</div>

<!-- ===== PRODUCTS ===== -->
<div class="card">
  <div class="card-header"><i class="fas fa-gift"></i><div><h2>Products & Offers</h2><p>Add your products to sell</p></div></div>
  <div id="offersForm" class="products-scroll"></div>
  <button class="add-btn" onclick="addOffer()" style="background:#8b5cf6; color:white; border:none; padding:12px; border-radius:12px; font-weight:600; width:100%; margin-top:12px; cursor:pointer;"><i class="fas fa-plus"></i> Add Product</button>
</div>

<!-- ===== ACTION BUTTONS ===== -->
<button class="btn btn-success" onclick="openPaymentModal()" style="margin-bottom:12px;"><i class="fas fa-credit-card"></i> Configure Payments & Tokens</button>
<button class="btn btn-primary" onclick="generate()" id="generateButton"><i class="fas fa-magic"></i> Generate Digital Card</button>

<!-- ===== PAYMENT MODAL ‚Äì COMPLETELY REWORKED, FULLY FUNCTIONAL ===== -->
<div class="modal" id="paymentModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-cog"></i> Payment & Token System</h2>
      <button class="modal-close" onclick="closePaymentModal()">√ó</button>
    </div>
    
    <div class="modal-body" style="padding:20px;">
      <!-- WhatsApp Settings -->
      <h3 style="font-size:16px; margin-bottom:12px;">WhatsApp Business</h3>
      <div class="input-group"><label>WhatsApp Number</label><input type="text" id="whatsappNumber" placeholder="+923001234567" value="+92"></div>
      
      <!-- Token System -->
      <h3 style="font-size:16px; margin:20px 0 12px;">Token System</h3>
      <div class="row-2">
        <div class="input-group"><label>Token Prefix</label><input type="text" id="tokenPrefix" value="TKT"></div>
        <div class="input-group"><label>Length</label><select id="tokenLength"><option value="8">8 chars</option><option value="10">10 chars</option><option value="12" selected>12 chars</option></select></div>
      </div>
      <div class="token-preview"><div style="text-align:center; margin-bottom:4px; font-size:11px;">Sample Token</div><div class="token-code" id="tokenPreview" style="font-family:monospace; font-size:16px; font-weight:800; color:#10b981; text-align:center; padding:10px; background:rgba(255,255,255,0.1); border-radius:10px; word-break:break-all;">TKT-12345678-A1B2</div></div>
      
      <!-- PAYMENT GATEWAYS ‚Äì full functional multi‚Äëselect, expanded fields, new options -->
      <h3 style="font-size:16px; margin:20px 0 12px;">Payment Gateways (click to expand / toggle)</h3>
      <div class="payment-grid" id="paymentGatewaysContainer">
        <!-- JazzCash -->
        <div class="payment-card" data-gateway="jazzcash">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#FF6B00;"><i class="fas fa-mobile-alt"></i></div>
            <div class="payment-info"><div class="payment-name">JazzCash</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">Account Number</label><input type="text" class="field-input" id="jazzcashNumber" placeholder="03XXXXXXXXX" value="03001234567"></div>
            <div class="field-row"><label class="field-label">QR Code</label><div class="upload-area" style="border:2px dashed var(--border); border-radius:12px; padding:12px;"><i class="fas fa-qrcode"></i><span>Click to upload QR</span><input type="file" id="jazzcashBarcode" accept="image/*" onchange="handleFileUpload(this, 'jazzcash')"></div></div>
          </div>
        </div>
        <!-- EasyPaisa -->
        <div class="payment-card" data-gateway="easypaisa">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#0A5C36;"><i class="fas fa-wallet"></i></div>
            <div class="payment-info"><div class="payment-name">EasyPaisa</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">Account Number</label><input type="text" class="field-input" id="easypaisaNumber" placeholder="03XXXXXXXXX" value="03001234567"></div>
            <div class="field-row"><label class="field-label">QR Code</label><div class="upload-area"><i class="fas fa-qrcode"></i><span>Click to upload QR</span><input type="file" id="easypaisaBarcode" accept="image/*" onchange="handleFileUpload(this, 'easypaisa')"></div></div>
          </div>
        </div>
        <!-- Cash on Delivery -->
        <div class="payment-card" data-gateway="cod">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#10b981;"><i class="fas fa-truck"></i></div>
            <div class="payment-info"><div class="payment-name">Cash on Delivery</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">Minimum Order (PKR)</label><input type="number" class="field-input" id="codMinimumOrder" value="500"></div>
          </div>
        </div>
        <!-- NEW: Bank Transfer -->
        <div class="payment-card" data-gateway="bank">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#3b82f6;"><i class="fas fa-university"></i></div>
            <div class="payment-info"><div class="payment-name">Bank Transfer</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">Bank Name</label><input type="text" class="field-input" id="bankName" placeholder="e.g., HBL" value="HBL"></div>
            <div class="field-row"><label class="field-label">Account Title</label><input type="text" class="field-input" id="bankAccountTitle" placeholder="John Doe" value="Business Name"></div>
            <div class="field-row"><label class="field-label">IBAN / Account No.</label><input type="text" class="field-input" id="bankIban" placeholder="PK12...." value="PK12ABCD123456"></div>
          </div>
        </div>
        <!-- NEW: Credit / Debit Card (Stripe-like) -->
        <div class="payment-card" data-gateway="card">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#8b5cf6;"><i class="far fa-credit-card"></i></div>
            <div class="payment-info"><div class="payment-name">Credit / Debit Card</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">Processor</label><select class="field-input" id="cardProcessor"><option value="stripe">Stripe</option><option value="paypal">PayPal</option><option value="square">Square</option></select></div>
            <div class="field-row"><label class="field-label">API Public Key / Client ID</label><input type="text" class="field-input" id="cardApiKey" placeholder="pk_...." value="pk_test_123"></div>
          </div>
        </div>
        <!-- NEW: Cryptocurrency -->
        <div class="payment-card" data-gateway="crypto">
          <div class="payment-card-header">
            <div class="payment-icon" style="background:#f59e0b;"><i class="fab fa-bitcoin"></i></div>
            <div class="payment-info"><div class="payment-name">Cryptocurrency</div></div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          <div class="payment-fields">
            <div class="field-row"><label class="field-label">BTC Address</label><input type="text" class="field-input" id="cryptoBtc" placeholder="1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa"></div>
            <div class="field-row"><label class="field-label">ETH Address</label><input type="text" class="field-input" id="cryptoEth" placeholder="0x...."></div>
            <div class="field-row"><label class="field-label">USDT (TRC20)</label><input type="text" class="field-input" id="cryptoUsdt" placeholder="T...."></div>
          </div>
        </div>
      </div>
      
      <!-- selected gateways indicator (visual only) -->
      <div style="background:#f1f5f9; border-radius:12px; padding:12px; margin:16px 0; font-size:13px;">
        <span style="font-weight:600;">Enabled gateways:</span> <span id="selectedGatewaysList">Cash on Delivery</span>
      </div>
      
      <button class="btn btn-success" onclick="savePaymentAndTicketSettings()" style="margin:16px 0 10px;"><i class="fas fa-save"></i> Save All Settings</button>
      <button class="btn btn-outline" onclick="testTokenGeneration()" style="background:white; border:2px solid var(--border); color:var(--dark); padding:14px; border-radius:12px; font-weight:600; width:100%; cursor:pointer;"><i class="fas fa-flask"></i> Test Token Generation</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
// ===== SUPABASE CLIENT =====
const supa = supabase.createClient("https://dfvnefbxgayxqgjjgtrr.supabase.co","sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE");

// ===== GLOBAL VARIABLES =====
let productCount = 0;
let profileImageFile = null;
let productImageFiles = {};
// payment data store (extended)
let paymentData = {
  jazzcash: { number: '03001234567', barcode: '' },
  easypaisa: { number: '03001234567', barcode: '' },
  cod: { minimumOrder: 500 },
  bank: { bankName: 'HBL', accountTitle: 'Business Name', iban: 'PK12ABCD123456' },
  card: { processor: 'stripe', apiKey: 'pk_test_123' },
  crypto: { btc: '1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa', eth: '0x...', usdt: 'T...' }
};
// store selected gateways (multiple allowed)
let selectedGateways = ['cod']; // default

// ===== INIT PAYMENT MODAL TOGGLES =====
function initPaymentModal() {
  const container = document.getElementById('paymentGatewaysContainer');
  if (!container) return;
  
  // clear any previous listeners (simple reattach)
  container.querySelectorAll('.payment-card').forEach(card => {
    const header = card.querySelector('.payment-card-header');
    const gateway = card.dataset.gateway;
    
    // expand/collapse on header click
    header.addEventListener('click', (e) => {
      e.stopPropagation();
      card.classList.toggle('expanded');
    });
    
    // selection on card click (toggle selected class)
    card.addEventListener('click', (e) => {
      // if the click originated from an input/button, ignore selection toggle
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON' || e.target.closest('input') || e.target.closest('button') || e.target.closest('.upload-area')) return;
      
      // toggle selection
      if (selectedGateways.includes(gateway)) {
        selectedGateways = selectedGateways.filter(g => g !== gateway);
        card.classList.remove('selected');
      } else {
        selectedGateways.push(gateway);
        card.classList.add('selected');
      }
      updateSelectedGatewaysDisplay();
    });
    
    // pre-select default (cod)
    if (gateway === 'cod') {
      selectedGateways.push('cod');
      card.classList.add('selected');
    }
  });
  
  // also attach file upload handlers for jazzcash/easypaisa (already have onchange)
}

function updateSelectedGatewaysDisplay() {
  const names = {
    jazzcash: 'JazzCash', easypaisa: 'EasyPaisa', cod: 'Cash on Delivery',
    bank: 'Bank Transfer', card: 'Credit/Debit Card', crypto: 'Cryptocurrency'
  };
  const list = selectedGateways.map(g => names[g] || g).join(', ');
  document.getElementById('selectedGatewaysList').innerText = list || 'None';
}

// ===== PROFILE, PRODUCT, HOLIDAY, DELIVERY ZONES (keep as before) =====
function handleProfileImageUpload(input) {
  if (input.files?.[0]) {
    const file = input.files[0];
    if (!file.type.match('image.*')) { showSuccess('‚ùå Please select an image file'); return; }
    if (file.size > 5*1024*1024) { showSuccess('‚ùå Image size should be less than 5MB'); return; }
    profileImageFile = file;
    document.getElementById('profileUploadArea').classList.add('has-file');
    document.getElementById('profileUploadIcon').className = 'fas fa-check-circle';
    document.getElementById('profileUploadText').textContent = 'Image selected: ' + file.name;
    document.getElementById('profileUploadHint').textContent = 'Click to change image';
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('profilePreview').src = e.target.result;
      document.getElementById('profilePreviewName').textContent = file.name;
      let size = file.size; let sz = size<1024?size+' B': size<1048576?(size/1024).toFixed(1)+' KB': (size/1048576).toFixed(1)+' MB';
      document.getElementById('profilePreviewSize').textContent = sz;
      document.getElementById('profilePreviewContainer').classList.remove('hidden');
    };
    reader.readAsDataURL(file);
    showSuccess('‚úÖ Profile image uploaded');
  }
}
function removeProfileImage() {
  document.getElementById('profileImage').value=''; profileImageFile=null;
  document.getElementById('profileUploadArea').classList.remove('has-file');
  document.getElementById('profileUploadIcon').className = 'fas fa-cloud-upload-alt';
  document.getElementById('profileUploadText').textContent = 'Click to upload profile picture';
  document.getElementById('profileUploadHint').textContent = 'PNG, JPG up to 5MB';
  document.getElementById('profilePreviewContainer').classList.add('hidden');
  showSuccess('üóëÔ∏è Profile image removed');
}

function handleProductImageUpload(input, idx) {
  if (input.files?.[0]) {
    const file = input.files[0];
    if (!file.type.match('image.*')) { showSuccess('‚ùå Invalid image'); return; }
    if (file.size > 5*1024*1024) { showSuccess('‚ùå Max 5MB'); return; }
    productImageFiles[idx] = file;
    const card = input.closest('.product-card');
    const reader = new FileReader();
    reader.onload = e => {
      card.querySelector('.product-image-placeholder')?.classList.add('hidden');
      const preview = card.querySelector('.product-image-preview');
      preview.src = e.target.result; preview.classList.add('show');
      const up = card.querySelector('.upload-area');
      up.classList.add('has-file'); up.querySelector('i').className='fas fa-check-circle'; up.querySelector('span').textContent=file.name;
    };
    reader.readAsDataURL(file);
    showSuccess('‚úÖ Product image');
  }
}
function removeProductImage(idx, card) {
  card.querySelector('.productImg').value=''; delete productImageFiles[idx];
  card.querySelector('.upload-area').classList.remove('has-file');
  card.querySelector('.upload-area i').className='fas fa-image'; card.querySelector('.upload-area span').textContent='Product Image';
  card.querySelector('.product-image-preview').classList.remove('show');
  card.querySelector('.product-image-placeholder').classList.remove('hidden');
  showSuccess('üóëÔ∏è Removed');
}

function addOffer() {
  productCount++;
  const box = document.createElement('div');
  box.className = 'product-card'; box.dataset.index = productCount;
  box.innerHTML = `
    <h3 style="margin-bottom:10px;">Product ${productCount}</h3>
    <img class="product-image-preview"><div class="product-image-placeholder"><i class="fas fa-image"></i><div>No image</div></div>
    <div class="upload-area"><i class="fas fa-image"></i><span>Product Image</span><input type="file" class="productImg" accept="image/*"></div>
    <button class="remove-image-btn" onclick="removeProductImage(${productCount}, this.parentElement)"><i class="fas fa-trash"></i> Remove image</button>
    <input type="text" class="productTitle" placeholder="Product Title">
    <textarea class="productDesc" placeholder="Description" rows="2"></textarea>
    <div class="price-row"><input type="number" class="originalPrice" placeholder="Original Price"><input type="number" class="discountPrice" placeholder="Discounted Price"></div>
    <div class="product-badges">
      <label class="badge-item"><input type="checkbox" value="üî• Hot Deal"> üî• Hot Deal</label>
      <label class="badge-item"><input type="checkbox" value="‚≠ê Best Seller"> ‚≠ê Best Seller</label>
      <label class="badge-item"><input type="checkbox" value="üí∏ Discount"> üí∏ Discount</label>
      <label class="badge-item"><input type="checkbox" value="üöö Fast"> üöö Fast</label>
    </div>
  `;
  box.querySelector('.productImg').addEventListener('change', function(){ handleProductImageUpload(this, productCount); });
  document.getElementById('offersForm').appendChild(box);
}

// ===== HOLIDAYS =====
function addHoliday() {
  const c = document.getElementById('holidaysContainer');
  const d = document.createElement('div'); d.className='holiday-item'; d.style.cssText='display:grid; grid-template-columns:1fr 120px auto; gap:8px; margin-bottom:10px; padding:10px; background:#f8fafc; border-radius:12px; border:2px solid var(--border);';
  d.innerHTML = `<input type="text" class="holidayName" placeholder="Holiday name" style="padding:8px; border-radius:8px; border:2px solid var(--border);"><input type="date" class="holidayDate" value="${new Date().toISOString().split('T')[0]}" style="padding:8px; border-radius:8px; border:2px solid var(--border);"><button type="button" class="remove-btn" onclick="removeHoliday(this)" style="width:36px; height:36px; border-radius:8px; background:var(--danger); color:white; border:none;">√ó</button>`;
  c.appendChild(d);
}
function removeHoliday(b){ b.parentElement.remove(); }

// ===== DELIVERY ZONES =====
function addDeliveryZone(zoneData) {
  const c = document.getElementById('deliveryZonesList');
  const d = document.createElement('div'); d.className='zone-item'; d.style.cssText='display:grid; grid-template-columns:1fr 80px 100px auto; gap:6px; margin-bottom:10px; padding:10px; background:#f8fafc; border-radius:10px; border:2px solid var(--border); align-items:center;';
  d.innerHTML = `<input type="text" placeholder="City" value="${zoneData?.city||''}" style="padding:8px; border:2px solid var(--border); border-radius:6px;"><input type="number" placeholder="Charge" value="${zoneData?.charge||''}" style="padding:8px; border:2px solid var(--border); border-radius:6px;"><input type="text" placeholder="Time" value="${zoneData?.time||''}" style="padding:8px; border:2px solid var(--border); border-radius:6px;"><button onclick="this.parentElement.remove()" style="background:var(--danger); color:white; border:none; border-radius:6px; padding:8px;">√ó</button>`;
  c.appendChild(d);
}

// ===== BUSINESS HOURS =====
const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const daysContainer = document.getElementById('daysContainer');
days.forEach(day => {
  const box = document.createElement('div'); box.className='day-box'; box.style.cssText='background:#f8fafc; border-radius:14px; padding:14px; margin-bottom:10px; border:2px solid var(--border);';
  box.innerHTML = `<div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;"><span style="font-weight:700; min-width:70px;">${day}</span><select style="padding:6px 10px; border-radius:20px; border:2px solid var(--border);"><option value="open">Open</option><option value="closed">Closed</option></select></div><div style="display:flex; align-items:center; gap:8px;"><input type="time" value="09:00" style="padding:8px; border:2px solid var(--border); border-radius:8px;"><span>to</span><input type="time" value="18:00" style="padding:8px; border:2px solid var(--border); border-radius:8px;"></div>`;
  daysContainer.appendChild(box);
});

// ===== UI HELPERS =====
function showSuccess(m) { document.getElementById('successText').textContent = m; document.getElementById('successMessage').style.display='flex'; setTimeout(()=>document.getElementById('successMessage').style.display='none',3000); }
function showLoading() { document.getElementById('loadingOverlay').style.display='flex'; }
function hideLoading() { document.getElementById('loadingOverlay').style.display='none'; }

// ===== PAYMENT FUNCTIONS =====
function handleFileUpload(input, gateway) {
  if (input.files?.[0]) {
    const file = input.files[0];
    paymentData[gateway] = paymentData[gateway] || {};
    paymentData[gateway].barcodeFile = file;
    const up = input.closest('.upload-area');
    if (up) { up.classList.add('has-file'); up.style.borderColor='#10b981'; up.style.background='#f0fdf4'; up.querySelector('i').className='fas fa-check-circle'; }
    showSuccess(`‚úÖ QR uploaded for ${gateway}`);
  }
}

function testTokenGeneration() {
  const prefix = document.getElementById('tokenPrefix')?.value||'TKT';
  const ts = Date.now().toString().slice(-8);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let rand=''; for(let i=0;i<4;i++) rand+=chars[Math.floor(Math.random()*chars.length)];
  document.getElementById('tokenPreview').textContent = `${prefix}-${ts}-${rand}`;
  showSuccess('‚úÖ Token generated');
}

function openPaymentModal() {
  document.getElementById('paymentModal').style.display='flex';
  testTokenGeneration();
  // refresh selected visual from selectedGateways array
  document.querySelectorAll('.payment-card').forEach(card => {
    const g = card.dataset.gateway;
    if (selectedGateways.includes(g)) card.classList.add('selected');
    else card.classList.remove('selected');
  });
  updateSelectedGatewaysDisplay();
}
function closePaymentModal() { document.getElementById('paymentModal').style.display='none'; }

function savePaymentAndTicketSettings() {
  // gather all field values into paymentData (simple)
  paymentData.jazzcash.number = document.getElementById('jazzcashNumber')?.value || '';
  paymentData.easypaisa.number = document.getElementById('easypaisaNumber')?.value || '';
  paymentData.cod.minimumOrder = parseFloat(document.getElementById('codMinimumOrder')?.value) || 500;
  paymentData.bank.bankName = document.getElementById('bankName')?.value || '';
  paymentData.bank.accountTitle = document.getElementById('bankAccountTitle')?.value || '';
  paymentData.bank.iban = document.getElementById('bankIban')?.value || '';
  paymentData.card.processor = document.getElementById('cardProcessor')?.value || 'stripe';
  paymentData.card.apiKey = document.getElementById('cardApiKey')?.value || '';
  paymentData.crypto.btc = document.getElementById('cryptoBtc')?.value || '';
  paymentData.crypto.eth = document.getElementById('cryptoEth')?.value || '';
  paymentData.crypto.usdt = document.getElementById('cryptoUsdt')?.value || '';
  
  showSuccess('‚úÖ Payment settings saved!');
  setTimeout(closePaymentModal, 1200);
}

// ===== RESIZE IMAGE =====
function resizeImage(file) {
  return new Promise(resolve => {
    if (!file) { resolve(''); return; }
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      let w = img.width, h = img.height; const max=1024;
      if (w>h) { if(w>max){ h*=max/w; w=max; } } else { if(h>max){ w*=max/h; h=max; } }
      canvas.width = w; canvas.height = h;
      canvas.getContext('2d').drawImage(img,0,0,w,h);
      resolve(canvas.toDataURL('image/jpeg',0.85));
    };
    img.src = URL.createObjectURL(file);
  });
}

// ===== MAIN GENERATE (unchanged except uses updated paymentData & selectedGateways) =====
async function generate() {
  if (!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value || !document.getElementById('businessName').value || !document.getElementById('address').value) {
    showSuccess('‚ùå Please fill all required fields (*)'); return;
  }
  showLoading();
  try {
    const id = crypto.randomUUID();
    // businessHours, holidays, products, zones collection (same as before) ‚Äì omitted for brevity but identical
    // (keep from original) ‚Äì we'll reuse existing logic from original code; here we keep it short.
    // For brevity, I'll include the essential product & profile image processing.
    // In final answer, the full function is present in original; I'm maintaining it.
    // For now, mock a simple insert to demonstrate functionality.
    
    // Actually, we keep the original code's generate logic (copy from earlier). 
    // Since this is a partial edit due to length, I assume the generate() from previous version is included.
    // In this final answer, I'll embed a minimal version that works with the new payment fields.
    // But for safety, I'll paste the core of generate from original.
    
    // ************* ORIGINAL GENERATE LOGIC (condensed) *************
    const businessHours = []; document.querySelectorAll('.day-box').forEach(box => { let s=box.querySelector('select')?.value||'open', t=box.querySelectorAll('input[type="time"]'); businessHours.push({status:s, start:t[0]?.value||'09:00', end:t[1]?.value||'18:00'}); });
    const holidays = []; document.querySelectorAll('#holidaysContainer .holiday-item').forEach(item => { let n=item.querySelector('.holidayName')?.value, d=item.querySelector('.holidayDate')?.value; if(n&&d) holidays.push({name:n,date:d}); });
    const products = []; const productBoxes = document.querySelectorAll('.product-card'); for(let i=0;i<productBoxes.length;i++){ const box=productBoxes[i]; const idx=parseInt(box.dataset.index||i+1); const file=productImageFiles[idx]; products.push({ title:box.querySelector('.productTitle')?.value||'', desc:box.querySelector('.productDesc')?.value||'', originalPrice:parseFloat(box.querySelector('.originalPrice')?.value)||null, discountPrice:parseFloat(box.querySelector('.discountPrice')?.value)||null, badges:Array.from(box.querySelectorAll('input[type=checkbox]:checked')).map(cb=>cb.value), image:file?await resizeImage(file):'' }); }
    const zones = []; document.querySelectorAll('#deliveryZonesList .zone-item').forEach(z=>{ let i=z.querySelectorAll('input'); if(i[0]?.value&&i[1]?.value&&i[2]?.value) zones.push({city:i[0].value,charge:parseFloat(i[1].value),time:i[2].value}); });
    if(paymentData.jazzcash.barcodeFile) paymentData.jazzcash.barcode = await resizeImage(paymentData.jazzcash.barcodeFile);
    if(paymentData.easypaisa.barcodeFile) paymentData.easypaisa.barcode = await resizeImage(paymentData.easypaisa.barcodeFile);
    
    const paymentMethods = {
      whatsapp: { active:!!document.getElementById('whatsappNumber')?.value, number:document.getElementById('whatsappNumber')?.value },
      gateways: {},
      tokenSystem: { enabled:true, requireTokenForTracking:true, prefix:document.getElementById('tokenPrefix')?.value, length:parseInt(document.getElementById('tokenLength')?.value) }
    };
    selectedGateways.forEach(g => {
      if (g==='cod') paymentMethods.gateways.cod = { active:true, minimumOrder:paymentData.cod.minimumOrder };
      else if (g==='jazzcash') paymentMethods.gateways.jazzcash = { active:true, number:paymentData.jazzcash.number, barcode:paymentData.jazzcash.barcode };
      else if (g==='easypaisa') paymentMethods.gateways.easypaisa = { active:true, number:paymentData.easypaisa.number, barcode:paymentData.easypaisa.barcode };
      else if (g==='bank') paymentMethods.gateways.bank = { active:true, ...paymentData.bank };
      else if (g==='card') paymentMethods.gateways.card = { active:true, ...paymentData.card };
      else if (g==='crypto') paymentMethods.gateways.crypto = { active:true, ...paymentData.crypto };
    });
    
    const cardData = {
      id, name:document.getElementById('fullName').value, phone:document.getElementById('phoneNumber').value, email:document.getElementById('email').value, address:document.getElementById('address').value, businessName:document.getElementById('businessName').value,
      business:{ about:document.getElementById('businessAbout').value }, socialMedia:{ facebook:document.getElementById('facebook').value, instagram:document.getElementById('instagram').value, twitter:document.getElementById('twitter').value, linkedin:document.getElementById('linkedin').value, youtube:document.getElementById('youtube').value, tiktok:document.getElementById('tiktok').value, website:document.getElementById('website').value },
      businessHours, holidays, products, payments:paymentMethods,
      deliverySettings:{ default:{ withinCity:{ charge:parseFloat(document.getElementById('deliveryChargeCity').value)||150, time:document.getElementById('deliveryTimeCity').value||'1-2 business days' }, otherCities:{ charge:parseFloat(document.getElementById('deliveryChargeOther').value)||300, time:document.getElementById('deliveryTimeOther').value||'3-5 business days' } }, zones, freeDeliveryMin:parseFloat(document.getElementById('freeDeliveryMin').value)||2000, cutoffTime:document.getElementById('deliveryCutoffTime').value||'16:00', maxDays:document.getElementById('deliveryDays').value||'5-7 days', addressConfirmation:{ required:document.getElementById('requireAddressConfirmation')?.checked||false, saveAddresses:document.getElementById('saveCustomerAddresses')?.checked||false } },
      ticketSettings:{ enableAutoTickets:true, enableEmailTickets:true, enableWhatsappTickets:true, ticketPrefix:'TKT' }, version:'3.1.0', created:new Date().toISOString()
    };
    if(profileImageFile) cardData.profileImage = await resizeImage(profileImageFile);
    
    const { data: inserted, error } = await supa.from('cards').insert({ id, data:JSON.stringify(cardData) }).select().single();
    if(error) throw error;
    localStorage.setItem('lastCardId', inserted.id);
    hideLoading(); showSuccess('‚úÖ Card created! Redirecting...');
    setTimeout(()=>{ location.href='card.html?id='+inserted.id; },2000);
  } catch(e) { hideLoading(); showSuccess('‚ùå Error: '+e.message); }
}

// ===== INIT =====
document.addEventListener('DOMContentLoaded', function() {
  addDeliveryZone({city:'Karachi', charge:150, time:'1-2 days'});
  addDeliveryZone({city:'Lahore', charge:200, time:'2-3 days'});
  addDeliveryZone({city:'Islamabad', charge:250, time:'2-3 days'});
  addOffer();
  initPaymentModal(); // setup payment cards
  // ensure COD is selected by default
  selectedGateways = ['cod'];
  updateSelectedGatewaysDisplay();
});
</script>
</body>
</html>
