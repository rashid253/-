<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Digital Business Card - Professional E-Commerce Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===== ALL EXISTING STYLES REMAIN SAME ===== */
body{
  margin:0;
  font-family:'Poppins',system-ui;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height:100vh;
  color: #1e293b;
}

.wrap{
  max-width:480px;
  margin:auto;
  padding:20px;
}

h2{
  margin-top:20px;
  margin-bottom:10px;
  color:#0f172a;
  display:flex;
  align-items:center;
  gap:10px;
  font-size:18px;
  font-weight:600;
  background: rgba(255, 255, 255, 0.95);
  padding: 12px 16px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border: 2px solid rgba(102, 126, 234, 0.3);
}

.section-heading {
  color: #0f172a;
  font-size: 18px;
  font-weight: 600;
  margin: 20px 0 10px 0;
  padding: 12px 16px;
  background: rgba(255, 255, 255, 0.95);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  border: 2px solid rgba(102, 126, 234, 0.3);
  display: flex;
  align-items: center;
  gap: 10px;
}

input,textarea,select{
  width:100%;
  padding:14px;
  margin:8px 0;
  border-radius:12px;
  border:2px solid rgba(102, 126, 234, 0.3);
  box-sizing:border-box;
  font-size:15px;
  background:rgba(255,255,255,0.95);
  color: #1e293b;
  font-family: 'Poppins', sans-serif;
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
}

button{
  width:100%;
  padding:18px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color:white;
  font-size:17px;
  margin-top:20px;
  cursor:pointer;
  font-weight:600;
  box-shadow:0 8px 25px rgba(102,126,234,0.4);
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 30px rgba(102,126,234,0.5);
}

.form-section{
  background:rgba(255,255,255,0.95);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.1);
  border: 2px solid rgba(255,255,255,0.2);
}

.social-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 10px;
}

.social-input {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  transition: all 0.3s;
}

.social-input:hover {
  border-color: #667eea;
  background: white;
}

.social-input i {
  color: #666;
  font-size: 18px;
  width: 24px;
}

.social-input input {
  flex: 1;
  border: none;
  background: transparent;
  padding: 0;
  margin: 0;
  font-size: 14px;
  color: #1e293b;
}

.social-input input:focus {
  outline: none;
}

.offers-container {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 10px 0;
  margin-top: 10px;
  scrollbar-width: thin;
}

.offers-container::-webkit-scrollbar {
  height: 6px;
}

.offers-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.offers-container::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
}

.offer-box {
  min-width: 280px;
  background: white;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  border: 1px solid #e2e8f0;
}

.offer-box h3 {
  margin-top: 0;
  color: #1e293b;
  font-size: 16px;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  padding-bottom: 10px;
  border-bottom: 1px solid #e2e8f0;
}

/* ===== NEW: DELIVERY CARDS HORIZONTAL SCROLL ===== */
.delivery-cards-container {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 15px 5px;
  margin: 15px 0;
  scrollbar-width: thin;
}

.delivery-cards-container::-webkit-scrollbar {
  height: 6px;
}

.delivery-cards-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.delivery-cards-container::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 10px;
}

.delivery-card {
  min-width: 240px;
  background: white;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  border: 1px solid #e2e8f0;
  border-left: 4px solid #10b981;
}

.delivery-card h4 {
  margin: 0 0 10px 0;
  color: #1e293b;
  font-size: 16px;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 8px;
}

.delivery-card .price {
  font-size: 22px;
  font-weight: 700;
  color: #059669;
  margin: 8px 0;
}

.delivery-card .time {
  color: #4b5563;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 5px;
}

.delivery-card .badge {
  background: #f0f9ff;
  color: #0369a1;
  padding: 4px 8px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  display: inline-block;
  margin-top: 8px;
}

.badgeGrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-top:10px;
  font-size:14px;
}
.badgeGrid label{
  display:flex;
  gap:8px;
  align-items:center;
  cursor:pointer;
  color: #475569;
  padding: 6px 8px;
  border-radius: 6px;
  transition: all 0.2s;
}

.badgeGrid label:hover {
  background: #f1f5f9;
}

.badgeGrid input[type="checkbox"] {
  accent-color: #667eea;
}

.dayBox{
  background:#fff;
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
  display:grid;
  grid-template-columns:28px 1fr;
  gap:8px;
  align-items:center;
  border:1px solid #e2e8f0;
}
.dayCheck{display:flex;justify-content:center}
.dayContent{display:flex;flex-direction:column;gap:6px}
.dayRow{display:flex;align-items:center;gap:8px}
.dayRow label{font-weight:500;min-width:80px; color: #475569;}

.holidayBox{
  background:#fff;
  padding:16px;
  border-radius:12px;
  margin:12px 0;
  border:1px solid #e2e8f0;
}
.holidayHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}
.holidayHeader h2 {
  background: transparent;
  border: none;
  padding: 0;
  margin: 0;
  box-shadow: none;
}
.addHolidayBtn{
  background:#10b981;
  color:white;
  border:none;
  padding:8px 16px;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
  transition: all 0.3s;
}
.addHolidayBtn:hover {
  background: #0da271;
  transform: translateY(-2px);
}
.holidayItem{
  display:grid;
  grid-template-columns:1fr 120px auto;
  gap:10px;
  align-items:center;
  margin:8px 0;
  padding:10px;
  background:#f8fafc;
  border-radius:10px;
  border:1px solid #e2e8f0;
}
.holidayItem input[type="text"]{
  padding:10px;
  border:1px solid #e2e8f0;
  border-radius:8px;
  font-size:14px;
  background:white;
  color: #1e293b;
}
.holidayItem input[type="date"]{
  padding:10px;
  border:1px solid #e2e8f0;
  border-radius:8px;
  font-size:14px;
  min-width:120px;
  background:white;
  color:#334155;
}
.removeHoliday{
  background:#ef4444;
  color:white;
  border:none;
  border-radius:8px;
  padding:10px 14px;
  cursor:pointer;
  font-size:16px;
  font-weight:bold;
  min-width:40px;
  height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  transition: all 0.3s;
}
.removeHoliday:hover{
  background:#dc2626;
  transform: scale(1.05);
}

/* COMPLETE DELIVERY SETTINGS SECTION */
.delivery-settings {
  background: white;
  border-radius: 16px;
  padding: 16px;
  margin: 12px 0;
  border: 1px solid #e2e8f0;
}

.delivery-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin: 12px 0;
}

.delivery-input-group {
  margin-bottom: 12px;
}

.delivery-input-group label {
  display: block;
  margin-bottom: 6px;
  color: #475569;
  font-weight: 600;
  font-size: 14px;
}

.delivery-input-group input {
  width: 100%;
  padding: 10px;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  font-size: 14px;
  background: white;
  color: #1e293b;
}

.delivery-input-group input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* DELIVERY ZONES SECTION */
.delivery-zones-container {
  margin-top: 20px;
  border-top: 2px solid #e2e8f0;
  padding-top: 16px;
}

.zone-item {
  display: grid;
  grid-template-columns: 1fr 100px 100px auto;
  gap: 8px;
  align-items: center;
  margin-bottom: 10px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
}

.zone-item input {
  padding: 8px;
  margin: 0;
  font-size: 13px;
}

.zone-actions {
  display: flex;
  gap: 6px;
}

.add-zone-btn {
  background: #8b5cf6;
  padding: 10px;
  margin-top: 10px;
  font-size: 14px;
}

/* ===== PROFESSIONAL PAYMENT GATEWAYS - COMPLETELY FIXED ===== */
.payment-gateways {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin: 20px 0;
}

.payment-option-card {
  background: white;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  padding: 16px;
  display: flex;
  align-items: flex-start;
  gap: 15px;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.payment-option-card:hover {
  border-color: #667eea;
  background: #f8fafc;
  transform: translateY(-2px);
}

.payment-option-card.selected {
  border-color: #10b981;
  background: #f0fdf4;
}

.payment-icon {
  width: 50px;
  height: 50px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  flex-shrink: 0;
}

.payment-details {
  flex: 1;
}

.payment-name {
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 4px;
  font-size: 16px;
}

.payment-fields {
  margin-top: 12px;
  display: none;
}

.payment-option-card.selected .payment-fields {
  display: block;
}

/* ===== CRITICAL FIX: PAYMENT FIELDS FULLY FUNCTIONAL ===== */
.payment-fields input,
.payment-fields select,
.payment-fields textarea {
  width: 100%;
  padding: 12px !important;
  margin: 8px 0 !important;
  border: 2px solid #e2e8f0 !important;
  border-radius: 8px !important;
  font-size: 14px !important;
  background: white !important;
  color: #1e293b !important;
  pointer-events: auto !important;
  cursor: text !important;
  opacity: 1 !important;
  visibility: visible !important;
  display: block !important;
  position: relative !important;
  z-index: 1000000 !important;
}

.payment-fields select {
  cursor: pointer !important;
}

.payment-fields input[type="file"] {
  cursor: pointer !important;
  padding: 8px !important;
}

.payment-fields input:focus,
.payment-fields select:focus {
  outline: none !important;
  border-color: #667eea !important;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2) !important;
}

.payment-fields input:hover,
.payment-fields select:hover {
  border-color: #667eea !important;
}

/* Payment Modal - Completely Fixed */
.payment-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(5px);
  z-index: 999999;
  justify-content: center;
  align-items: center;
  pointer-events: auto !important;
}

.payment-content {
  background: white;
  border-radius: 20px;
  width: 90%;
  max-width: 400px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 0;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  pointer-events: auto !important;
  position: relative;
  z-index: 1000000;
}

.payment-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px;
  border-radius: 20px 20px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.payment-header h2 {
  margin: 0;
  color: white;
  background: transparent;
  border: none;
  padding: 0;
  box-shadow: none;
  font-size: 20px;
}

.close-payment {
  background: rgba(255,255,255,0.2);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.3s;
  pointer-events: auto !important;
  width: auto;
}
.close-payment:hover {
  background: rgba(255,255,255,0.3);
}

/* Force all modal elements to be clickable */
.payment-modal * {
  pointer-events: auto !important;
}

/* Selected Methods Display */
.selected-methods-container {
  display: none;
  margin: 15px 0;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  border: 1px solid #e2e8f0;
}

.methods-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.method-tag {
  background: white;
  border: 1px solid #e2e8f0;
  padding: 6px 12px;
  border-radius: 30px;
  font-size: 13px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.method-tag i {
  font-size: 14px;
}

.method-tag.jazzcash { color: #FF6B00; }
.method-tag.easypaisa { color: #0A5C36; }
.method-tag.bank { color: #2563eb; }
.method-tag.card { color: #8b5cf6; }
.method-tag.cod { color: #10b981; }

.remove-method {
  background: none;
  border: none;
  color: #ef4444;
  cursor: pointer;
  font-size: 16px;
  padding: 0 4px;
  margin: 0;
  width: auto;
  height: auto;
}

.whatsapp-preview {
  margin: 20px 0;
  padding: 15px;
  background: #f8fafc;
  border-radius: 12px;
  border-left: 4px solid #25D366;
}
.whatsapp-preview h4 {
  color: #25D366;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.preview-message {
  background: white;
  padding: 12px;
  border-radius: 8px;
  font-size: 14px;
  color: #1e293b;
  margin-bottom: 10px;
  line-height: 1.5;
  white-space: pre-line;
}

.form-label {
  color: #0f172a;
  font-weight: 600;
  margin-bottom: 5px;
  display: block;
  font-size: 14px;
}

input[type="file"] {
  padding: 10px;
  background: white;
  border: 2px dashed #cbd5f5;
  border-radius: 10px;
  cursor: pointer;
}

input[type="file"]:hover {
  border-color: #667eea;
  background: #f8fafc;
}

h2 i {
  color: #667eea;
}

.success-message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
  color: white;
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  z-index: 2000000;
  max-width: 300px;
  animation: slideDown 0.5s ease;
  font-weight: 700;
  font-size: 14px;
  text-align: center;
  display: none;
}

@keyframes slideDown {
  from { top: -100px; opacity: 0; }
  to { top: 20px; opacity: 1; }
}

.loading-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(10px);
  z-index: 3000000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.3);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  color: white;
  font-size: 18px;
  font-weight: 600;
}

.token-settings {
  background: linear-gradient(135deg, #667eea10 0%, #764ba210 100%);
  border-radius: 16px;
  padding: 20px;
  margin-top: 20px;
  border: 2px solid rgba(102, 126, 234, 0.3);
}

.token-settings h4 {
  color: #4c51bf;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 16px;
  font-weight: 700;
}

.token-format-preview {
  background: #1e293b;
  color: #e2e8f0;
  font-family: monospace;
  padding: 12px;
  border-radius: 8px;
  font-size: 14px;
  margin-top: 8px;
  letter-spacing: 1px;
}

.ticket-settings {
  background: #f0f9ff;
  border-radius: 12px;
  padding: 16px;
  margin-top: 20px;
  border: 1px solid #bae6fd;
}

.ticket-settings h4 {
  color: #0369a1;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.ticket-template {
  background: white;
  border-radius: 8px;
  padding: 12px;
  margin-top: 10px;
  border-left: 4px solid #0ea5e9;
}

.multi-payment-badge {
  background: #8b5cf6;
  color: white;
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 30px;
  margin-left: 8px;
  font-weight: 500;
}

@media (max-width:480px){
  .holidayItem{
    grid-template-columns:1fr;
    gap:8px;
  }
  .holidayItem input[type="date"]{
    min-width:100%;
  }
  .social-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  .delivery-grid {
    grid-template-columns: 1fr;
  }
  .zone-item {
    grid-template-columns: 1fr;
    gap: 8px;
  }
}
</style>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<div class="wrap">

<!-- Success Message -->
<div class="success-message" id="successMessage"></div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Creating your professional digital business card...</div>
</div>

<div class="form-section">
<h2><i class="fas fa-user" style="color:#667eea;"></i> Profile Information</h2>
<input type="file" id="profileImage" accept="image/*">
<input id="fullName" placeholder="Full Name (Required)" required>
<input id="phoneNumber" placeholder="Phone Number (Required)" type="tel" required>
<input id="email" placeholder="Email Address" type="email">
<input id="address" placeholder="Business Address (Required for delivery)" required>
</div>

<div class="form-section">
<h2><i class="fas fa-building" style="color:#667eea;"></i> Business Details</h2>
<input id="businessName" placeholder="Business Title (Required)" required>
<textarea id="businessAbout" placeholder="About your business" rows="4"></textarea>

<h2 style="margin-top:25px"><i class="fas fa-link" style="color:#667eea;"></i> Website & Social Media</h2>
<input type="url" id="website" placeholder="https://yourwebsite.com">

<div class="social-grid">
  <div class="social-input">
    <i class="fab fa-facebook" style="color:#1877F2;"></i>
    <input type="text" id="facebook" placeholder="Facebook URL">
  </div>
  <div class="social-input">
    <i class="fab fa-instagram" style="color:#E4405F;"></i>
    <input type="text" id="instagram" placeholder="Instagram URL">
  </div>
  <div class="social-input">
    <i class="fab fa-twitter" style="color:#1DA1F2;"></i>
    <input type="text" id="twitter" placeholder="Twitter URL">
  </div>
  <div class="social-input">
    <i class="fab fa-linkedin" style="color:#0A66C2;"></i>
    <input type="text" id="linkedin" placeholder="LinkedIn URL">
  </div>
  <div class="social-input">
    <i class="fab fa-youtube" style="color:#FF0000;"></i>
    <input type="text" id="youtube" placeholder="YouTube URL">
  </div>
  <div class="social-input">
    <i class="fab fa-tiktok" style="color:#000000;"></i>
    <input type="text" id="tiktok" placeholder="TikTok URL">
  </div>
</div>
</div>

<div class="form-section">
<h2><i class="fas fa-clock" style="color:#667eea;"></i> Business Hours</h2>
<div id="daysContainer"></div>
</div>

<div class="form-section">
<h2><i class="fas fa-calendar-times" style="color:#667eea;"></i> Special Holidays</h2>
<div id="holidaysContainer">
  <div class="holidayItem">
   <input type="text" class="holidayName" placeholder="E.g., Eid ul-Fitr" value="Eid ul-Fitr">
   <input type="date" class="holidayDate">
   <button type="button" class="removeHoliday" onclick="removeHoliday(this)">Ã—</button>
  </div>
</div>
<button type="button" class="addHolidayBtn" onclick="addHoliday()">+ Add Holiday</button>
</div>

<!-- COMPLETE DELIVERY SETTINGS SECTION -->
<div class="form-section">
<h2><i class="fas fa-truck" style="color:#667eea;"></i> Complete Delivery Settings</h2>

<div class="delivery-settings">
  <h3 style="color:#1e293b; margin-bottom:15px; font-size:16px; font-weight:700;">
    <i class="fas fa-map-marker-alt"></i> Default Delivery Configuration
  </h3>
  
  <div class="delivery-grid">
    <div class="delivery-input-group">
      <label for="deliveryChargeCity">Within City - Delivery Charge (PKR)</label>
      <input type="number" id="deliveryChargeCity" placeholder="e.g., 150" min="0" value="150">
    </div>
    
    <div class="delivery-input-group">
      <label for="deliveryChargeOther">Other Cities - Delivery Charge (PKR)</label>
      <input type="number" id="deliveryChargeOther" placeholder="e.g., 300" min="0" value="300">
    </div>
  </div>
  
  <div class="delivery-grid">
    <div class="delivery-input-group">
      <label for="deliveryTimeCity">Within City - Estimated Delivery</label>
      <input type="text" id="deliveryTimeCity" placeholder="e.g., 1-2 business days" value="1-2 business days">
    </div>
    
    <div class="delivery-input-group">
      <label for="deliveryTimeOther">Other Cities - Estimated Delivery</label>
      <input type="text" id="deliveryTimeOther" placeholder="e.g., 3-5 business days" value="3-5 business days">
    </div>
  </div>
  
  <!-- ===== NEW: DELIVERY CARDS HORIZONTAL VIEW ===== -->
  <h4 style="margin:20px 0 10px; color:#1e293b;">ðŸ“¦ Delivery Options Preview</h4>
  <div class="delivery-cards-container" id="deliveryCardsPreview">
    <div class="delivery-card">
      <h4><i class="fas fa-city"></i> Within City</h4>
      <div class="price">PKR <span id="previewCityCharge">150</span></div>
      <div class="time"><i class="far fa-clock"></i> <span id="previewCityTime">1-2 business days</span></div>
      <span class="badge">Standard Delivery</span>
    </div>
    <div class="delivery-card">
      <h4><i class="fas fa-map-marker-alt"></i> Other Cities</h4>
      <div class="price">PKR <span id="previewOtherCharge">300</span></div>
      <div class="time"><i class="far fa-clock"></i> <span id="previewOtherTime">3-5 business days</span></div>
      <span class="badge">Intercity Delivery</span>
    </div>
    <div class="delivery-card">
      <h4><i class="fas fa-gift"></i> Free Delivery</h4>
      <div class="price">PKR 0</div>
      <div class="time"><i class="fas fa-truck"></i> On orders above <span id="previewFreeMin">2000</span></div>
      <span class="badge">Special Offer</span>
    </div>
  </div>
  
  <div class="delivery-input-group">
    <label for="freeDeliveryMin">Free Delivery Minimum Order (PKR)</label>
    <input type="number" id="freeDeliveryMin" placeholder="e.g., 2000" min="0" value="2000">
  </div>
  
  <div class="delivery-input-group">
    <label for="deliveryCutoffTime">Same Day Delivery Cutoff Time</label>
    <input type="time" id="deliveryCutoffTime" value="16:00">
  </div>
  
  <div class="delivery-input-group">
    <label for="deliveryDays">Maximum Delivery Days</label>
    <input type="text" id="deliveryDays" placeholder="e.g., 5-7 days" value="5-7 days">
  </div>
  
  <!-- MULTI-ZONE DELIVERY -->
  <div class="delivery-zones-container">
    <h4><i class="fas fa-location-dot" style="color:#667eea;"></i> Specific City/Zone Based Delivery</h4>
    <div id="deliveryZonesList"></div>
    <button type="button" class="add-zone-btn" onclick="addDeliveryZone()" style="background:#8b5cf6;">
      <i class="fas fa-plus-circle"></i> Add Specific Zone/City
    </button>
  </div>
  
  <!-- ADDRESS CONFIRMATION -->
  <div style="margin-top:20px; padding:16px; background:#f0f9ff; border-radius:12px;">
    <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
      <input type="checkbox" id="requireAddressConfirmation" checked style="width:18px; height:18px;">
      <label for="requireAddressConfirmation">Require address confirmation</label>
    </div>
    <div style="display:flex; align-items:center; gap:10px;">
      <input type="checkbox" id="saveCustomerAddresses" checked style="width:18px; height:18px;">
      <label for="saveCustomerAddresses">Save customer addresses</label>
    </div>
  </div>
</div>
</div>

<div class="form-section">
<h2><i class="fas fa-gift" style="color:#667eea;"></i> Products & Offers</h2>
<div id="offersForm"></div>
<button type="button" onclick="addOffer()" style="background:linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);margin-top:12px">
 <i class="fas fa-plus"></i> Add Product
</button>
</div>

<button type="button" onclick="openPaymentModal()" style="background:linear-gradient(135deg, #059669 0%, #10b981 100%);margin-top:24px;" id="paymentButton">
  <i class="fas fa-credit-card"></i> Configure Payments, Tokens & Tickets
</button>

<button type="button" onclick="generate()" style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);margin-top:24px" id="generateButton">
 <i class="fas fa-magic"></i> Generate Professional Digital Card
</button>
</div>

<!-- PAYMENT MODAL - COMPLETELY FIXED -->
<div class="payment-modal" id="paymentModal">
  <div class="payment-content">
    <div class="payment-header">
      <h2><i class="fas fa-cog"></i> Payment & Token System</h2>
      <button class="close-payment" onclick="closePaymentModal()">Ã—</button>
    </div>
    
    <div style="padding:20px;">
      
      <!-- WhatsApp Settings -->
      <h3 style="margin-bottom:15px;"><i class="fab fa-whatsapp" style="color:#25D366;"></i> WhatsApp Business</h3>
      <div style="margin-bottom:20px;">
        <input type="text" id="whatsappNumber" placeholder="+923001234567" value="+92">
      </div>
      
      <!-- Selected Methods Display -->
      <div class="selected-methods-container" id="selectedMethodsContainer">
        <div style="font-weight:600; color:#475569;">Selected Payment Methods:</div>
        <div class="methods-list" id="selectedMethodsList"></div>
      </div>
      
      <!-- TOKEN SYSTEM -->
      <div class="token-settings">
        <h4><i class="fas fa-ticket-alt"></i> Order Token System</h4>
        <div style="margin-bottom:10px;">
          <input type="checkbox" id="enableTokenSystem" checked> Enable automatic token generation
        </div>
        <div style="margin-bottom:10px;">
          <input type="checkbox" id="requireTokenForTracking" checked> Require token for tracking
        </div>
        <input type="text" id="tokenPrefix" placeholder="Token Prefix" value="TKT">
        <select id="tokenLength">
          <option value="8">8 characters</option>
          <option value="10">10 characters</option>
          <option value="12" selected>12 characters</option>
        </select>
        <div class="token-format-preview" id="tokenPreview">TKT-12345678-A1B2</div>
      </div>
      
      <!-- PAYMENT GATEWAYS - MULTIPLE SELECTION -->
      <h3 style="margin:20px 0 10px;">ðŸ’³ Payment Gateways <span class="multi-payment-badge">Multiple Selection</span></h3>
      <p style="font-size:13px; color:#64748b; margin-bottom:15px;">Click to select multiple payment methods</p>
      
      <div class="payment-gateways">
        <!-- JazzCash -->
        <div class="payment-option-card" onclick="togglePaymentGateway('jazzcash')" id="gateway-jazzcash">
          <div class="payment-icon" style="background:#FF6B00;"><i class="fas fa-mobile-alt"></i></div>
          <div class="payment-details">
            <div class="payment-name">JazzCash</div>
            <div class="payment-fields" id="fields-jazzcash">
              <input type="text" id="jazzcashNumber" placeholder="JazzCash Number" value="03001234567">
              <input type="file" id="jazzcashBarcode" accept="image/*">
              <select id="jazzcashType">
                <option value="jazzcash">JazzCash</option>
                <option value="easypaisa">EasyPaisa</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- EasyPaisa -->
        <div class="payment-option-card" onclick="togglePaymentGateway('easypaisa')" id="gateway-easypaisa">
          <div class="payment-icon" style="background:#0A5C36;"><i class="fas fa-wallet"></i></div>
          <div class="payment-details">
            <div class="payment-name">EasyPaisa</div>
            <div class="payment-fields" id="fields-easypaisa">
              <input type="text" id="easypaisaNumber" placeholder="EasyPaisa Number" value="03001234567">
              <input type="file" id="easypaisaBarcode" accept="image/*">
            </div>
          </div>
        </div>
        
        <!-- Bank Transfer -->
        <div class="payment-option-card" onclick="togglePaymentGateway('bank')" id="gateway-bank">
          <div class="payment-icon" style="background:#2563eb;"><i class="fas fa-university"></i></div>
          <div class="payment-details">
            <div class="payment-name">Bank Transfer</div>
            <div class="payment-fields" id="fields-bank">
              <select id="bankName">
                <option value="HBL">HBL</option>
                <option value="UBL">UBL</option>
                <option value="MCB">MCB</option>
                <option value="Meezan">Meezan</option>
              </select>
              <input type="text" id="accountTitle" placeholder="Account Title" value="Business Account">
              <input type="text" id="accountNumber" placeholder="Account Number" value="1234567890">
              <input type="text" id="ibanNumber" placeholder="IBAN" value="PK36HBL001234567890">
            </div>
          </div>
        </div>
        
        <!-- Card Payment -->
        <div class="payment-option-card" onclick="togglePaymentGateway('card')" id="gateway-card">
          <div class="payment-icon" style="background:#8b5cf6;"><i class="fas fa-credit-card"></i></div>
          <div class="payment-details">
            <div class="payment-name">Card Payment</div>
            <div class="payment-fields" id="fields-card">
              <select id="cardProcessor">
                <option value="stripe">Stripe</option>
                <option value="paypal">PayPal</option>
              </select>
              <input type="text" id="merchantId" placeholder="Merchant ID" value="pk_test_xxxx">
            </div>
          </div>
        </div>
        
        <!-- Cash on Delivery -->
        <div class="payment-option-card selected" onclick="togglePaymentGateway('cod')" id="gateway-cod">
          <div class="payment-icon" style="background:#10b981;"><i class="fas fa-truck"></i></div>
          <div class="payment-details">
            <div class="payment-name">Cash on Delivery</div>
            <div class="payment-fields" id="fields-cod">
              <div style="margin-bottom:8px;">
                <input type="checkbox" id="codEnabled" checked> Enable COD
              </div>
              <input type="number" id="codMinimumOrder" placeholder="Min order for COD" value="500">
            </div>
          </div>
        </div>
      </div>
      
      <!-- TICKET SETTINGS -->
      <div class="ticket-settings">
        <h4><i class="fas fa-ticket-alt"></i> Order Ticket System</h4>
        <div style="margin-bottom:10px;">
          <input type="checkbox" id="enableAutoTickets" checked> Auto-generate tickets
        </div>
        <div style="margin-bottom:10px;">
          <input type="checkbox" id="enableWhatsappTickets" checked> Send via WhatsApp
        </div>
        <input type="text" id="ticketPrefix" placeholder="Ticket Prefix" value="TKT">
        <input type="email" id="adminEmail" placeholder="Admin Email">
      </div>
      
      <button onclick="savePaymentAndTicketSettings()" style="background:#25D366; margin-top:20px;">
        <i class="fas fa-save"></i> Save All Settings
      </button>
      
      <button onclick="testTokenGeneration()" style="background:#f1f5f9; color:#475569; margin-top:10px;">
        <i class="fas fa-flask"></i> Test Token
      </button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
const { createClient } = supabase;
const db = createClient(
  "https://dfvnefbxgayxqgjjgtrr.supabase.co",
  "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

// ========== GLOBAL VARIABLES ==========
let productCount = 0;
let selectedPaymentGateways = ['cod']; // Multiple selection allowed
let generatedTokens = [];

// ========== UI HELPER FUNCTIONS ==========
function showSuccess(message) {
  const el = document.getElementById('successMessage');
  el.textContent = message;
  el.style.display = 'block';
  setTimeout(() => el.style.display = 'none', 3000);
}

function showLoading() {
  document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
  document.getElementById('loadingOverlay').style.display = 'none';
}

// ========== BUSINESS HOURS ==========
const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
days.forEach(d => {
  const box = document.createElement("div");
  box.className = "dayBox";
  box.innerHTML = `
    <div class="dayCheck"><input type="checkbox" checked class="dayOpen"></div>
    <div class="dayContent">
      <div class="dayRow">
        <label>${d}</label>
        <select class="dayStatus">
          <option value="open">Open</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      <div class="dayRow">
        <input type="time" class="dayStart" value="09:00">
        <span>to</span>
        <input type="time" class="dayEnd" value="17:00">
      </div>
    </div>
  `;
  daysContainer.appendChild(box);
  
  const status = box.querySelector('.dayStatus');
  const times = box.querySelectorAll('.dayStart, .dayEnd');
  const chk = box.querySelector('.dayOpen');
  
  status.addEventListener('change', function() {
    if(this.value === 'closed') {
      times.forEach(i => i.disabled = true);
      chk.checked = false;
    } else {
      times.forEach(i => i.disabled = false);
      chk.checked = true;
    }
  });
});

// ========== HOLIDAY MANAGEMENT ==========
function addHoliday() {
  const item = document.createElement('div');
  item.className = 'holidayItem';
  item.innerHTML = `
    <input type="text" class="holidayName" placeholder="Holiday Name">
    <input type="date" class="holidayDate" value="${new Date().toISOString().split('T')[0]}">
    <button type="button" class="removeHoliday" onclick="removeHoliday(this)">Ã—</button>
  `;
  document.getElementById('holidaysContainer').appendChild(item);
}

function removeHoliday(btn) {
  btn.parentElement.remove();
}

// ========== PRODUCT MANAGEMENT ==========
function addOffer() {
  productCount++;
  const box = document.createElement("div");
  box.className = "offer-box";
  box.innerHTML = `
    <h3><i class="fas fa-tag"></i> Product ${productCount}</h3>
    <input type="file" class="productImg" accept="image/*">
    <input class="productTitle" placeholder="Product Title">
    <textarea class="productDesc" placeholder="Description" rows="2"></textarea>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <input type="number" class="originalPrice" placeholder="Original Price">
      <input type="number" class="discountPrice" placeholder="Discounted Price">
    </div>
    <div class="badgeGrid">
      <label><input type="checkbox" value="ðŸ”¥ Hot Deal"> Hot Deal</label>
      <label><input type="checkbox" value="â­ Best Seller"> Best Seller</label>
      <label><input type="checkbox" value="ðŸ’¸ Discount"> Discount</label>
      <label><input type="checkbox" value="â³ Limited Stock"> Limited Stock</label>
      <label><input type="checkbox" value="ðŸ›’ In Stock"> In Stock</label>
      <label><input type="checkbox" value="ðŸšš Free Delivery"> Free Delivery</label>
    </div>
  `;
  document.getElementById('offersForm').appendChild(box);
  document.getElementById('offersForm').classList.add('offers-container');
}

// ========== DELIVERY ZONE MANAGEMENT ==========
function addDeliveryZone(data = null) {
  const id = 'zone_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5);
  const item = document.createElement('div');
  item.className = 'zone-item';
  item.id = id;
  item.innerHTML = `
    <input type="text" class="zone-name" placeholder="City/Area" value="${data?.city || ''}">
    <input type="number" class="zone-charge" placeholder="Charge" value="${data?.charge || ''}">
    <input type="text" class="zone-time" placeholder="Delivery Time" value="${data?.time || ''}">
    <div class="zone-actions">
      <button onclick="removeDeliveryZone('${id}')" style="background:#ef4444; padding:8px;">Ã—</button>
    </div>
  `;
  document.getElementById('deliveryZonesList').appendChild(item);
}

function removeDeliveryZone(id) {
  document.getElementById(id)?.remove();
}

// ========== PAYMENT GATEWAY - MULTIPLE SELECTION ==========
function togglePaymentGateway(gateway) {
  if (selectedPaymentGateways.includes(gateway)) {
    selectedPaymentGateways = selectedPaymentGateways.filter(g => g !== gateway);
  } else {
    selectedPaymentGateways.push(gateway);
  }
  
  // Update UI
  document.querySelectorAll('.payment-option-card').forEach(c => c.classList.remove('selected'));
  selectedPaymentGateways.forEach(g => {
    const card = document.getElementById(`gateway-${g}`);
    if (card) card.classList.add('selected');
  });
  
  // Show/hide fields
  document.querySelectorAll('.payment-fields').forEach(f => f.style.display = 'none');
  selectedPaymentGateways.forEach(g => {
    const fields = document.getElementById(`fields-${g}`);
    if (fields) {
      fields.style.display = 'block';
      // Force enable all inputs
      fields.querySelectorAll('input, select').forEach(i => {
        i.disabled = false;
        i.readOnly = false;
      });
    }
  });
  
  updateSelectedMethodsDisplay();
}

function updateSelectedMethodsDisplay() {
  const container = document.getElementById('selectedMethodsContainer');
  const list = document.getElementById('selectedMethodsList');
  
  if (selectedPaymentGateways.length > 1) {
    container.style.display = 'block';
    list.innerHTML = '';
    
    selectedPaymentGateways.forEach(g => {
      const tag = document.createElement('span');
      tag.className = `method-tag ${g}`;
      
      let icon = '', name = '';
      if (g === 'jazzcash') { icon = '<i class="fas fa-mobile-alt"></i>'; name = 'JazzCash'; }
      else if (g === 'easypaisa') { icon = '<i class="fas fa-wallet"></i>'; name = 'EasyPaisa'; }
      else if (g === 'bank') { icon = '<i class="fas fa-university"></i>'; name = 'Bank'; }
      else if (g === 'card') { icon = '<i class="fas fa-credit-card"></i>'; name = 'Card'; }
      else if (g === 'cod') { icon = '<i class="fas fa-truck"></i>'; name = 'COD'; }
      
      tag.innerHTML = `${icon} ${name} <button class="remove-method" onclick="removePaymentMethod('${g}')">Ã—</button>`;
      list.appendChild(tag);
    });
  } else {
    container.style.display = 'none';
  }
}

function removePaymentMethod(g) {
  if (selectedPaymentGateways.includes(g)) {
    selectedPaymentGateways = selectedPaymentGateways.filter(x => x !== g);
    document.getElementById(`gateway-${g}`)?.classList.remove('selected');
    document.getElementById(`fields-${g}`).style.display = 'none';
    updateSelectedMethodsDisplay();
  }
}

// ========== TOKEN GENERATION ==========
function generateProfessionalToken() {
  const prefix = document.getElementById('tokenPrefix')?.value || 'TKT';
  const timestamp = Date.now().toString().slice(-8);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let random = '';
  const len = parseInt(document.getElementById('tokenLength')?.value || 12) / 2;
  for (let i = 0; i < len; i++) random += chars[Math.floor(Math.random() * chars.length)];
  return `${prefix}-${timestamp}-${random}`;
}

function testTokenGeneration() {
  const token = generateProfessionalToken();
  document.getElementById('tokenPreview').innerHTML = token;
  showSuccess(`âœ… Token: ${token}`);
}

// ========== IMAGE COMPRESSION ==========
function resizeImage(file) {
  return new Promise(res => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement("canvas");
      const max = 1024;
      const ratio = Math.min(max/img.width, max/img.height, 1);
      canvas.width = img.width * ratio;
      canvas.height = img.height * ratio;
      canvas.getContext("2d").drawImage(img, 0, 0, canvas.width, canvas.height);
      res(canvas.toDataURL("image/jpeg", 0.85));
    };
    img.src = URL.createObjectURL(file);
  });
}

// ========== PAYMENT MODAL ==========
function openPaymentModal() {
  document.getElementById('paymentModal').style.display = 'flex';
  setTimeout(() => {
    // Force enable all inputs
    document.querySelectorAll('#paymentModal input, #paymentModal select').forEach(i => {
      i.disabled = false;
      i.readOnly = false;
    });
  }, 100);
  testTokenGeneration();
}

function closePaymentModal() {
  document.getElementById('paymentModal').style.display = 'none';
}

function savePaymentAndTicketSettings() {
  showSuccess('âœ… Settings saved!');
  setTimeout(closePaymentModal, 1500);
}

// ========== MAIN GENERATE FUNCTION ==========
async function generate() {
  // Validate
  if (!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value) {
    alert("Name & Phone are required");
    return;
  }
  if (!document.getElementById('businessName').value) {
    alert("Business name required");
    return;
  }
  if (!document.getElementById('address').value) {
    alert("Address required");
    return;
  }

  showLoading();

  try {
    const id = crypto.randomUUID(); // UUID instead of short ID

    // Collect business hours
    const hours = [];
    document.querySelectorAll(".dayBox").forEach(box => {
      hours.push({
        open: box.querySelector(".dayOpen").checked,
        status: box.querySelector(".dayStatus").value,
        start: box.querySelector(".dayStart").value,
        end: box.querySelector(".dayEnd").value
      });
    });

    // Collect holidays
    const holidays = [];
    document.querySelectorAll(".holidayItem").forEach(item => {
      const name = item.querySelector(".holidayName").value;
      const date = item.querySelector(".holidayDate").value;
      if (name && date) holidays.push({ name, date });
    });

    // Collect products
    const products = [];
    for (const box of document.querySelectorAll(".offer-box")) {
      const title = box.querySelector(".productTitle")?.value;
      const file = box.querySelector(".productImg")?.files[0];
      if (title || file) {
        const p = {
          title: title || "",
          desc: box.querySelector(".productDesc")?.value || "",
          originalPrice: box.querySelector(".originalPrice")?.value,
          discountPrice: box.querySelector(".discountPrice")?.value,
          badges: Array.from(box.querySelectorAll("input[type=checkbox]:checked")).map(cb => cb.value),
          image: file ? await resizeImage(file) : ""
        };
        products.push(p);
      }
    }

    // Collect zones
    const zones = [];
    document.querySelectorAll('#deliveryZonesList .zone-item').forEach(z => {
      const city = z.querySelector('.zone-name')?.value.trim();
      const charge = z.querySelector('.zone-charge')?.value;
      const time = z.querySelector('.zone-time')?.value.trim();
      if (city && charge && time) zones.push({ city, charge: parseFloat(charge), time });
    });

    // Payment methods - MULTIPLE GATEWAYS
    const paymentMethods = {
      whatsapp: { number: document.getElementById('whatsappNumber')?.value || '' },
      gateways: {},
      tokenSystem: {
        enabled: document.getElementById('enableTokenSystem')?.checked || true,
        prefix: document.getElementById('tokenPrefix')?.value || 'TKT',
        length: parseInt(document.getElementById('tokenLength')?.value || 12)
      }
    };

    selectedPaymentGateways.forEach(g => {
      if (g === 'jazzcash') {
        paymentMethods.gateways.jazzcash = {
          number: document.getElementById('jazzcashNumber')?.value || '',
          type: document.getElementById('jazzcashType')?.value || 'jazzcash'
        };
      } else if (g === 'easypaisa') {
        paymentMethods.gateways.easypaisa = {
          number: document.getElementById('easypaisaNumber')?.value || ''
        };
      } else if (g === 'bank') {
        paymentMethods.gateways.bank = {
          bankName: document.getElementById('bankName')?.value || 'HBL',
          accountTitle: document.getElementById('accountTitle')?.value || '',
          accountNumber: document.getElementById('accountNumber')?.value || ''
        };
      } else if (g === 'card') {
        paymentMethods.gateways.card = {
          processor: document.getElementById('cardProcessor')?.value || 'stripe',
          merchantId: document.getElementById('merchantId')?.value || ''
        };
      } else if (g === 'cod') {
        paymentMethods.gateways.cod = {
          enabled: document.getElementById('codEnabled')?.checked || true,
          minimumOrder: parseFloat(document.getElementById('codMinimumOrder')?.value) || 500
        };
      }
    });

    // Process barcodes
    if (paymentMethods.gateways.jazzcash && document.getElementById('jazzcashBarcode')?.files[0]) {
      paymentMethods.gateways.jazzcash.barcode = await resizeImage(document.getElementById('jazzcashBarcode').files[0]);
    }
    if (paymentMethods.gateways.easypaisa && document.getElementById('easypaisaBarcode')?.files[0]) {
      paymentMethods.gateways.easypaisa.barcode = await resizeImage(document.getElementById('easypaisaBarcode').files[0]);
    }

    // Ticket settings
    const ticketSettings = {
      enabled: document.getElementById('enableAutoTickets')?.checked || false,
      whatsapp: document.getElementById('enableWhatsappTickets')?.checked || false,
      prefix: document.getElementById('ticketPrefix')?.value || 'TKT',
      adminEmail: document.getElementById('adminEmail')?.value || ''
    };

    // Delivery settings
    const deliverySettings = {
      default: {
        withinCity: {
          charge: parseFloat(document.getElementById('deliveryChargeCity').value) || 150,
          time: document.getElementById('deliveryTimeCity').value || "1-2 days"
        },
        otherCities: {
          charge: parseFloat(document.getElementById('deliveryChargeOther').value) || 300,
          time: document.getElementById('deliveryTimeOther').value || "3-5 days"
        }
      },
      zones: zones,
      freeDeliveryMin: parseFloat(document.getElementById('freeDeliveryMin').value) || 2000,
      cutoffTime: document.getElementById('deliveryCutoffTime').value || "16:00",
      maxDays: document.getElementById('deliveryDays').value || "5-7 days"
    };

    // Social media
    const social = {
      facebook: document.getElementById('facebook').value,
      instagram: document.getElementById('instagram').value,
      twitter: document.getElementById('twitter').value,
      linkedin: document.getElementById('linkedin').value,
      youtube: document.getElementById('youtube').value,
      tiktok: document.getElementById('tiktok').value,
      website: document.getElementById('website').value
    };

    // Card data
    const cardData = {
      id: id,
      name: document.getElementById('fullName').value,
      phone: document.getElementById('phoneNumber').value,
      email: document.getElementById('email').value,
      address: document.getElementById('address').value,
      businessName: document.getElementById('businessName').value,
      business: { about: document.getElementById('businessAbout').value },
      socialMedia: social,
      businessHours: hours,
      holidays: holidays,
      products: products,
      payments: paymentMethods,
      deliverySettings: deliverySettings,
      ticketSettings: ticketSettings,
      ecommerce: true,
      created: new Date().toISOString()
    };

    // Profile image
    if (document.getElementById('profileImage').files[0]) {
      cardData.profileImage = await resizeImage(document.getElementById('profileImage').files[0]);
    }

    // Save to Supabase
    const { data, error } = await db.from("cards").insert({
      id: id,
      data: JSON.stringify(cardData)
    }).select().single();

    if (error) throw error;

    hideLoading();
    showSuccess('âœ… Card created! Redirecting...');
    
    // Redirect with UUID (no short URL)
    setTimeout(() => {
      location.href = "card.html?id=" + id;
    }, 2000);

  } catch (err) {
    hideLoading();
    console.error(err);
    alert("Error: " + err.message);
  }
}

// ========== INITIALIZATION ==========
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('offersForm').classList.add('offers-container');
  
  // Add default holiday date
  const today = new Date().toISOString().split('T')[0];
  document.querySelectorAll('.holidayDate').forEach(f => { if (!f.value) f.value = today; });
  
  // Add initial product
  addOffer();
  
  // Add example zones
  addDeliveryZone({city: "Karachi", charge: 150, time: "1-2 days"});
  addDeliveryZone({city: "Lahore", charge: 200, time: "2-3 days"});
  addDeliveryZone({city: "Islamabad", charge: 250, time: "2-3 days"});
  
  // Initialize payment - COD selected
  setTimeout(() => togglePaymentGateway('cod'), 100);
  
  // Update delivery preview
  const updatePreview = () => {
    document.getElementById('previewCityCharge').textContent = document.getElementById('deliveryChargeCity').value || '150';
    document.getElementById('previewCityTime').textContent = document.getElementById('deliveryTimeCity').value || '1-2 business days';
    document.getElementById('previewOtherCharge').textContent = document.getElementById('deliveryChargeOther').value || '300';
    document.getElementById('previewOtherTime').textContent = document.getElementById('deliveryTimeOther').value || '3-5 business days';
    document.getElementById('previewFreeMin').textContent = document.getElementById('freeDeliveryMin').value || '2000';
  };
  
  ['deliveryChargeCity', 'deliveryTimeCity', 'deliveryChargeOther', 'deliveryTimeOther', 'freeDeliveryMin'].forEach(id => {
    document.getElementById(id)?.addEventListener('input', updatePreview);
  });
  
  // Force enable payment fields periodically
  setInterval(() => {
    if (document.getElementById('paymentModal').style.display === 'flex') {
      document.querySelectorAll('#paymentModal input, #paymentModal select').forEach(i => {
        i.disabled = false;
        i.readOnly = false;
      });
    }
  }, 300);
});
</script>
</body>
</html>
