<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Digital Business Card - Professional E-Commerce Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===== PROFESSIONAL STYLING ===== */
:root {
  --primary: #667eea;
  --primary-dark: #5a67d8;
  --secondary: #764ba2;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --border: #e2e8f0;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 480px;
  margin: 0 auto;
}

/* ===== PROFESSIONAL CARDS ===== */
.card {
  background: white;
  border-radius: 24px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  border: 1px solid rgba(255,255,255,0.2);
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--border);
}

.card-header i {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 20px;
}

.card-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: var(--dark);
  margin: 0;
}

.card-header p {
  font-size: 13px;
  color: var(--gray);
  margin-top: 2px;
}

/* ===== PROFESSIONAL INPUTS ===== */
.input-group {
  margin-bottom: 16px;
}

.input-group label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 6px;
}

.input-group input,
.input-group textarea,
.input-group select {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--border);
  border-radius: 14px;
  font-size: 14px;
  transition: all 0.3s ease;
  background: white;
}

.input-group input:focus,
.input-group textarea:focus,
.input-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.input-group input.error {
  border-color: var(--danger);
}

.input-hint {
  font-size: 11px;
  color: var(--gray);
  margin-top: 4px;
}

/* ===== PROFESSIONAL BUTTONS ===== */
.btn {
  padding: 16px 24px;
  border: none;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning), #d97706);
  color: white;
}

.btn-outline {
  background: white;
  border: 2px solid var(--border);
  color: var(--dark);
}

.btn-outline:hover {
  border-color: var(--primary);
  background: #f8fafc;
}

/* ===== PROFESSIONAL PAYMENT GATEWAYS ===== */
.payment-section {
  margin-top: 30px;
}

.section-title {
  font-size: 18px;
  font-weight: 700;
  color: var(--dark);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.section-title i {
  color: var(--primary);
}

.payment-grid {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.payment-card {
  background: white;
  border: 2px solid var(--border);
  border-radius: 20px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.payment-card.selected {
  border-color: var(--success);
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.15);
}

.payment-card-header {
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  background: white;
}

.payment-card-header:hover {
  background: #f8fafc;
}

.payment-icon {
  width: 56px;
  height: 56px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  color: white;
  flex-shrink: 0;
}

.payment-info {
  flex: 1;
}

.payment-name {
  font-weight: 700;
  color: var(--dark);
  font-size: 16px;
  margin-bottom: 4px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.payment-badge {
  background: var(--success);
  color: white;
  padding: 4px 8px;
  border-radius: 30px;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.5px;
}

.payment-desc {
  font-size: 12px;
  color: var(--gray);
}

.payment-chevron {
  color: var(--gray);
  transition: transform 0.3s ease;
}

.payment-card.selected .payment-chevron {
  transform: rotate(180deg);
  color: var(--success);
}

/* ===== PROFESSIONAL PAYMENT FIELDS ===== */
.payment-fields {
  padding: 0 20px 20px 92px;
  display: none;
  animation: slideDown 0.3s ease;
}

.payment-card.selected .payment-fields {
  display: block;
}

.field-row {
  margin-bottom: 16px;
}

.field-label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  color: var(--gray);
  margin-bottom: 6px;
}

.field-input {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  transition: all 0.3s ease;
}

.field-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.field-select {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  background: white;
  cursor: pointer;
}

/* ===== PROFESSIONAL FILE UPLOAD ===== */
.file-upload {
  border: 2px dashed var(--border);
  border-radius: 12px;
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.file-upload:hover {
  border-color: var(--primary);
  background: #f8fafc;
}

.file-upload i {
  font-size: 24px;
  color: var(--primary);
  margin-bottom: 8px;
}

.file-upload span {
  display: block;
  font-size: 13px;
  color: var(--gray);
}

.file-upload small {
  font-size: 11px;
  color: #94a3b8;
}

.file-upload input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

.preview-image {
  max-width: 80px;
  max-height: 80px;
  border-radius: 8px;
  margin-top: 12px;
  border: 2px solid var(--border);
  display: none;
}

/* ===== PROFESSIONAL TOGGLE SWITCH ===== */
.toggle-switch {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}

.toggle-switch input {
  width: 44px;
  height: 24px;
  appearance: none;
  background: var(--border);
  border-radius: 30px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s ease;
}

.toggle-switch input:checked {
  background: var(--success);
}

.toggle-switch input::before {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  top: 2px;
  left: 2px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.toggle-switch input:checked::before {
  left: 22px;
}

.toggle-switch label {
  font-weight: 600;
  color: var(--dark);
  cursor: pointer;
}

/* ===== PROFESSIONAL TOKEN PREVIEW ===== */
.token-preview {
  background: linear-gradient(135deg, #1e293b, #0f172a);
  border-radius: 16px;
  padding: 20px;
  margin: 20px 0;
  color: white;
}

.token-code {
  font-family: 'Courier New', monospace;
  font-size: 20px;
  font-weight: 800;
  color: var(--success);
  letter-spacing: 2px;
  text-align: center;
  padding: 12px;
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  margin: 10px 0;
}

.token-format {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #94a3b8;
  margin-top: 12px;
}

/* ===== PROFESSIONAL MODAL ===== */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(10px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.modal-content {
  background: white;
  border-radius: 32px;
  width: 100%;
  max-width: 440px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 30px 60px rgba(0,0,0,0.3);
}

.modal-header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 24px;
  border-radius: 32px 32px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h2 {
  font-size: 20px;
  font-weight: 700;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.modal-close {
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.modal-close:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.modal-body {
  padding: 24px;
}

/* ===== PROFESSIONAL LOADING ===== */
.loading-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(10px);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(255,255,255,0.2);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

.loading-text {
  color: white;
  font-size: 16px;
  font-weight: 600;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===== PROFESSIONAL SUCCESS MESSAGE ===== */
.success-message {
  position: fixed;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
  padding: 16px 24px;
  border-radius: 60px;
  box-shadow: 0 20px 40px rgba(16, 185, 129, 0.3);
  z-index: 3000;
  font-weight: 600;
  font-size: 14px;
  display: none;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
  animation: slideDown 0.5s ease;
}

/* ===== PROFESSIONAL GRIDS ===== */
.social-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 16px;
}

.social-input {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  border: 2px solid var(--border);
  transition: all 0.3s ease;
}

.social-input:hover {
  border-color: var(--primary);
  background: white;
}

.social-input i {
  width: 20px;
  color: var(--gray);
}

.social-input input {
  flex: 1;
  border: none;
  background: transparent;
  padding: 0;
  font-size: 13px;
}

.social-input input:focus {
  outline: none;
}

/* ===== PROFESSIONAL DAYS ===== */
.day-box {
  background: #f8fafc;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 12px;
  border: 2px solid var(--border);
}

.day-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.day-name {
  font-weight: 700;
  color: var(--dark);
  min-width: 100px;
}

.day-status {
  padding: 6px 12px;
  border-radius: 30px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 2px solid var(--border);
  background: white;
}

.day-time {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-left: 36px;
}

.day-time input {
  padding: 8px 12px;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 13px;
}

/* ===== PROFESSIONAL HOLIDAYS ===== */
.holiday-item {
  display: grid;
  grid-template-columns: 1fr 120px auto;
  gap: 10px;
  align-items: center;
  margin-bottom: 12px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  border: 2px solid var(--border);
}

.remove-btn {
  width: 40px;
  height: 40px;
  border-radius: 10px;
  background: var(--danger);
  color: white;
  border: none;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.add-btn {
  background: var(--primary);
  color: white;
  border: none;
  padding: 12px;
  border-radius: 12px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  width: 100%;
  margin-top: 8px;
}

/* ===== PROFESSIONAL PRODUCTS ===== */
.products-scroll {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 8px 0 16px;
  scrollbar-width: thin;
}

.product-card {
  min-width: 280px;
  background: white;
  border-radius: 20px;
  padding: 16px;
  border: 2px solid var(--border);
}

.product-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin: 12px 0;
}

.product-badge {
  background: #f1f5f9;
  padding: 4px 10px;
  border-radius: 30px;
  font-size: 11px;
  font-weight: 600;
  color: var(--dark);
}

/* ===== PROFESSIONAL DELIVERY ZONES ===== */
.zone-item {
  display: grid;
  grid-template-columns: 1fr 100px 100px auto;
  gap: 8px;
  margin-bottom: 12px;
  padding: 12px;
  background: #f8fafc;
  border-radius: 12px;
  border: 2px solid var(--border);
  align-items: center;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 480px) {
  .container { padding: 10px; }
  .payment-fields { padding-left: 20px; }
  .holiday-item { grid-template-columns: 1fr; }
  .social-grid { grid-template-columns: repeat(2, 1fr); }
  .zone-item { grid-template-columns: 1fr; }
}
</style>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<div class="container">

<!-- Success Message -->
<div class="success-message" id="successMessage">
  <i class="fas fa-check-circle"></i>
  <span id="successText">Success!</span>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Creating your professional digital business card...</div>
</div>

<!-- ===== PROFILE SECTION ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-user"></i>
    <div>
      <h2>Profile Information</h2>
      <p>Your personal and business details</p>
    </div>
  </div>
  
  <div class="input-group">
    <label>Profile Image</label>
    <div class="file-upload">
      <i class="fas fa-cloud-upload-alt"></i>
      <span>Click to upload profile picture</span>
      <small>PNG, JPG up to 5MB</small>
      <input type="file" id="profileImage" accept="image/*">
    </div>
  </div>
  
  <div class="input-group">
    <label>Full Name <span style="color: var(--danger);">*</span></label>
    <input type="text" id="fullName" placeholder="Enter your full name" required>
  </div>
  
  <div class="input-group">
    <label>Phone Number <span style="color: var(--danger);">*</span></label>
    <input type="tel" id="phoneNumber" placeholder="03XXXXXXXXX" required>
  </div>
  
  <div class="input-group">
    <label>Email Address</label>
    <input type="email" id="email" placeholder="your@email.com">
  </div>
  
  <div class="input-group">
    <label>Business Address <span style="color: var(--danger);">*</span></label>
    <textarea id="address" rows="2" placeholder="Complete business address" required></textarea>
  </div>
</div>

<!-- ===== BUSINESS DETAILS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-building"></i>
    <div>
      <h2>Business Details</h2>
      <p>Your business identity</p>
    </div>
  </div>
  
  <div class="input-group">
    <label>Business Title <span style="color: var(--danger);">*</span></label>
    <input type="text" id="businessName" placeholder="Your business name" required>
  </div>
  
  <div class="input-group">
    <label>About Business</label>
    <textarea id="businessAbout" rows="3" placeholder="Describe your business..."></textarea>
  </div>
  
  <div class="input-group">
    <label>Website URL</label>
    <input type="url" id="website" placeholder="https://yourwebsite.com">
  </div>
  
  <h3 style="font-size: 16px; margin: 20px 0 12px; color: var(--dark);">Social Media Links</h3>
  
  <div class="social-grid">
    <div class="social-input">
      <i class="fab fa-facebook" style="color:#1877F2;"></i>
      <input type="text" id="facebook" placeholder="Facebook URL">
    </div>
    <div class="social-input">
      <i class="fab fa-instagram" style="color:#E4405F;"></i>
      <input type="text" id="instagram" placeholder="Instagram URL">
    </div>
    <div class="social-input">
      <i class="fab fa-twitter" style="color:#1DA1F2;"></i>
      <input type="text" id="twitter" placeholder="Twitter URL">
    </div>
    <div class="social-input">
      <i class="fab fa-linkedin" style="color:#0A66C2;"></i>
      <input type="text" id="linkedin" placeholder="LinkedIn URL">
    </div>
    <div class="social-input">
      <i class="fab fa-youtube" style="color:#FF0000;"></i>
      <input type="text" id="youtube" placeholder="YouTube URL">
    </div>
    <div class="social-input">
      <i class="fab fa-tiktok" style="color:#000000;"></i>
      <input type="text" id="tiktok" placeholder="TikTok URL">
    </div>
  </div>
</div>

<!-- ===== BUSINESS HOURS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-clock"></i>
    <div>
      <h2>Business Hours</h2>
      <p>Set your working days and times</p>
    </div>
  </div>
  
  <div id="daysContainer"></div>
</div>

<!-- ===== HOLIDAYS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-calendar-times"></i>
    <div>
      <h2>Special Holidays</h2>
      <p>Days when business is closed</p>
    </div>
  </div>
  
  <div id="holidaysContainer">
    <div class="holiday-item">
      <input type="text" class="holidayName" placeholder="Holiday name" value="Eid ul-Fitr">
      <input type="date" class="holidayDate">
      <button type="button" class="remove-btn" onclick="removeHoliday(this)">Ã—</button>
    </div>
  </div>
  
  <button class="add-btn" onclick="addHoliday()">
    <i class="fas fa-plus"></i> Add Holiday
  </button>
</div>

<!-- ===== DELIVERY SETTINGS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-truck"></i>
    <div>
      <h2>Delivery Settings</h2>
      <p>Configure delivery charges and zones</p>
    </div>
  </div>
  
  <h3 style="font-size: 16px; margin: 0 0 16px; color: var(--dark);">Default Delivery</h3>
  
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
    <div class="input-group">
      <label>Within City (PKR)</label>
      <input type="number" id="deliveryChargeCity" value="150">
    </div>
    <div class="input-group">
      <label>Other Cities (PKR)</label>
      <input type="number" id="deliveryChargeOther" value="300">
    </div>
  </div>
  
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
    <div class="input-group">
      <label>Within City Time</label>
      <input type="text" id="deliveryTimeCity" value="1-2 business days">
    </div>
    <div class="input-group">
      <label>Other Cities Time</label>
      <input type="text" id="deliveryTimeOther" value="3-5 business days">
    </div>
  </div>
  
  <div class="input-group">
    <label>Free Delivery Minimum (PKR)</label>
    <input type="number" id="freeDeliveryMin" value="2000">
  </div>
  
  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
    <div class="input-group">
      <label>Cutoff Time</label>
      <input type="time" id="deliveryCutoffTime" value="16:00">
    </div>
    <div class="input-group">
      <label>Max Delivery Days</label>
      <input type="text" id="deliveryDays" value="5-7 days">
    </div>
  </div>
  
  <h3 style="font-size: 16px; margin: 24px 0 16px; color: var(--dark);">Specific Zones</h3>
  
  <div id="deliveryZonesList"></div>
  
  <button class="add-btn" onclick="addDeliveryZone()" style="background: #8b5cf6;">
    <i class="fas fa-plus"></i> Add Zone
  </button>
  
  <div style="margin-top: 20px; padding: 16px; background: #f0f9ff; border-radius: 16px;">
    <div class="toggle-switch">
      <input type="checkbox" id="requireAddressConfirmation" checked>
      <label for="requireAddressConfirmation">Require address confirmation</label>
    </div>
    <div class="toggle-switch">
      <input type="checkbox" id="saveCustomerAddresses" checked>
      <label for="saveCustomerAddresses">Save customer addresses</label>
    </div>
  </div>
</div>

<!-- ===== PRODUCTS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-gift"></i>
    <div>
      <h2>Products & Offers</h2>
      <p>Add your products to sell</p>
    </div>
  </div>
  
  <div id="offersForm" class="products-scroll"></div>
  
  <button class="add-btn" onclick="addOffer()" style="background: #8b5cf6; margin-top: 16px;">
    <i class="fas fa-plus"></i> Add Product
  </button>
</div>

<!-- ===== ACTION BUTTONS ===== -->
<button class="btn btn-success" onclick="openPaymentModal()" style="margin-bottom: 16px;">
  <i class="fas fa-credit-card"></i> Configure Payments & Tokens
</button>

<button class="btn btn-primary" onclick="generate()" id="generateButton">
  <i class="fas fa-magic"></i> Generate Digital Card
</button>

<!-- ===== PAYMENT MODAL - PROFESSIONAL ===== -->
<div class="modal" id="paymentModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-cog"></i> Payment & Token System</h2>
      <button class="modal-close" onclick="closePaymentModal()">Ã—</button>
    </div>
    
    <div class="modal-body">
      <!-- WhatsApp Settings -->
      <h3 style="font-size: 18px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <i class="fab fa-whatsapp" style="color: #25D366;"></i> WhatsApp Business
      </h3>
      
      <div class="input-group">
        <label>WhatsApp Number</label>
        <input type="text" id="whatsappNumber" placeholder="+923001234567" value="+92">
        <div class="input-hint">Orders will be sent to this number</div>
      </div>
      
      <div style="background: #f0f9ff; border-radius: 16px; padding: 16px; margin: 20px 0;">
        <h4 style="display: flex; align-items: center; gap: 8px; color: #25D366; margin-bottom: 12px;">
          <i class="fab fa-whatsapp"></i> Order Preview
        </h4>
        <div style="background: white; border-radius: 12px; padding: 16px; font-size: 13px; font-family: monospace; white-space: pre-line;" id="whatsappPreview">
ðŸŽ‰ *NEW ORDER CONFIRMED* - TOKEN: TKT-123456-A7F2

*Order ID:* ORD-12345678
*Token:* TKT-123456-A7F2
*Customer:* [Customer Name]
*Phone:* [Customer Phone]
*Address:* [Full Address]

*ITEMS:*
â€¢ Product 1 (Qty: 1) - PKR 1,000

*Total:* PKR 1,150
        </div>
      </div>
      
      <!-- Token System -->
      <h3 style="font-size: 18px; margin: 30px 0 16px; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-ticket-alt" style="color: #667eea;"></i> Token System
      </h3>
      
      <div class="toggle-switch">
        <input type="checkbox" id="enableTokenSystem" checked>
        <label for="enableTokenSystem">Enable token generation</label>
      </div>
      
      <div class="toggle-switch">
        <input type="checkbox" id="requireTokenForTracking" checked>
        <label for="requireTokenForTracking">Require token for tracking</label>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px;">
        <div class="input-group">
          <label>Token Prefix</label>
          <input type="text" id="tokenPrefix" value="TKT">
        </div>
        <div class="input-group">
          <label>Length</label>
          <select id="tokenLength">
            <option value="8">8 chars</option>
            <option value="10">10 chars</option>
            <option value="12" selected>12 chars</option>
          </select>
        </div>
      </div>
      
      <div class="token-preview">
        <div style="text-align: center; margin-bottom: 8px; font-size: 12px; color: #94a3b8;">Sample Token</div>
        <div class="token-code" id="tokenPreview">TKT-12345678-A1B2</div>
        <div class="token-format">
          <span>Prefix</span>
          <span>Timestamp</span>
          <span>Random</span>
        </div>
      </div>
      
      <!-- Payment Gateways -->
      <h3 style="font-size: 18px; margin: 30px 0 16px; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-credit-card" style="color: #667eea;"></i> Payment Gateways
        <span style="background: var(--success); color: white; padding: 4px 8px; border-radius: 30px; font-size: 10px;">Multiple Select</span>
      </h3>
      
      <div class="payment-grid" id="paymentGateways">
        <!-- JazzCash -->
        <div class="payment-card" id="gateway-jazzcash">
          <div class="payment-card-header" onclick="togglePaymentGateway('jazzcash')">
            <div class="payment-icon" style="background: #FF6B00;">
              <i class="fas fa-mobile-alt"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                JazzCash
                <span class="payment-badge" id="jazzcash-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">Mobile wallet payments</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-jazzcash">
            <div class="field-row">
              <label class="field-label">Account Number</label>
              <input type="text" class="field-input" id="jazzcashNumber" placeholder="03XXXXXXXXX" value="03001234567" onchange="updatePaymentData('jazzcash', 'number', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">Account Type</label>
              <select class="field-select" id="jazzcashType" onchange="updatePaymentData('jazzcash', 'type', this.value)">
                <option value="jazzcash">JazzCash Account</option>
                <option value="easypaisa">EasyPaisa Account</option>
              </select>
            </div>
            
            <div class="field-row">
              <label class="field-label">QR Code (Optional)</label>
              <div class="file-upload">
                <i class="fas fa-qrcode"></i>
                <span>Click to upload QR code</span>
                <small>PNG, JPG</small>
                <input type="file" id="jazzcashBarcode" accept="image/*" onchange="handleFileUpload(this, 'jazzcash')">
              </div>
              <img id="jazzcash-preview" class="preview-image">
            </div>
          </div>
        </div>
        
        <!-- EasyPaisa -->
        <div class="payment-card" id="gateway-easypaisa">
          <div class="payment-card-header" onclick="togglePaymentGateway('easypaisa')">
            <div class="payment-icon" style="background: #0A5C36;">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                EasyPaisa
                <span class="payment-badge" id="easypaisa-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">Mobile account payments</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-easypaisa">
            <div class="field-row">
              <label class="field-label">Account Number</label>
              <input type="text" class="field-input" id="easypaisaNumber" placeholder="03XXXXXXXXX" value="03001234567" onchange="updatePaymentData('easypaisa', 'number', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">QR Code (Optional)</label>
              <div class="file-upload">
                <i class="fas fa-qrcode"></i>
                <span>Click to upload QR code</span>
                <small>PNG, JPG</small>
                <input type="file" id="easypaisaBarcode" accept="image/*" onchange="handleFileUpload(this, 'easypaisa')">
              </div>
              <img id="easypaisa-preview" class="preview-image">
            </div>
          </div>
        </div>
        
        <!-- Bank Transfer -->
        <div class="payment-card" id="gateway-bank">
          <div class="payment-card-header" onclick="togglePaymentGateway('bank')">
            <div class="payment-icon" style="background: #2563eb;">
              <i class="fas fa-university"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                Bank Transfer
                <span class="payment-badge" id="bank-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">Direct bank deposit</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-bank">
            <div class="field-row">
              <label class="field-label">Bank Name</label>
              <select class="field-select" id="bankName" onchange="updatePaymentData('bank', 'bankName', this.value)">
                <option value="HBL">Habib Bank Limited (HBL)</option>
                <option value="UBL">United Bank Limited (UBL)</option>
                <option value="MCB">MCB Bank Limited</option>
                <option value="Meezan">Meezan Bank</option>
                <option value="Alfalah">Bank Alfalah</option>
                <option value="Other">Other Bank</option>
              </select>
            </div>
            
            <div class="field-row">
              <label class="field-label">Account Title</label>
              <input type="text" class="field-input" id="accountTitle" value="Business Account" onchange="updatePaymentData('bank', 'accountTitle', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">Account Number</label>
              <input type="text" class="field-input" id="accountNumber" value="1234567890" onchange="updatePaymentData('bank', 'accountNumber', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">IBAN (Optional)</label>
              <input type="text" class="field-input" id="ibanNumber" value="PK36HBL001234567890" onchange="updatePaymentData('bank', 'iban', this.value)">
            </div>
          </div>
        </div>
        
        <!-- Card Payment -->
        <div class="payment-card" id="gateway-card">
          <div class="payment-card-header" onclick="togglePaymentGateway('card')">
            <div class="payment-icon" style="background: #8b5cf6;">
              <i class="fas fa-credit-card"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                Card Payment
                <span class="payment-badge" id="card-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">Visa / Mastercard</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-card">
            <div class="field-row">
              <label class="field-label">Processor</label>
              <select class="field-select" id="cardProcessor" onchange="updatePaymentData('card', 'processor', this.value)">
                <option value="stripe">Stripe</option>
                <option value="paypal">PayPal</option>
                <option value="razorpay">Razorpay</option>
              </select>
            </div>
            
            <div class="field-row">
              <label class="field-label">Merchant ID / Key</label>
              <input type="text" class="field-input" id="merchantId" value="pk_test_xxxxxxxxxxxx" onchange="updatePaymentData('card', 'merchantId', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">Webhook Secret</label>
              <input type="text" class="field-input" id="webhookSecret" onchange="updatePaymentData('card', 'webhookSecret', this.value)">
            </div>
          </div>
        </div>
        
        <!-- Cash on Delivery -->
        <div class="payment-card" id="gateway-cod">
          <div class="payment-card-header" onclick="togglePaymentGateway('cod')">
            <div class="payment-icon" style="background: #10b981;">
              <i class="fas fa-truck"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                Cash on Delivery
                <span class="payment-badge" id="cod-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">Pay when order arrives</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-cod">
            <div class="toggle-switch">
              <input type="checkbox" id="codEnabled" checked onchange="updatePaymentData('cod', 'enabled', this.checked)">
              <label for="codEnabled">Enable COD</label>
            </div>
            
            <div class="field-row">
              <label class="field-label">Minimum Order (PKR)</label>
              <input type="number" class="field-input" id="codMinimumOrder" value="500" onchange="updatePaymentData('cod', 'minimumOrder', this.value)">
            </div>
          </div>
        </div>
        
        <!-- Cryptocurrency -->
        <div class="payment-card" id="gateway-crypto">
          <div class="payment-card-header" onclick="togglePaymentGateway('crypto')">
            <div class="payment-icon" style="background: #f7931a;">
              <i class="fab fa-bitcoin"></i>
            </div>
            <div class="payment-info">
              <div class="payment-name">
                Cryptocurrency
                <span class="payment-badge" id="crypto-badge" style="display: none;">Active</span>
              </div>
              <div class="payment-desc">BTC, ETH, USDT</div>
            </div>
            <i class="fas fa-chevron-down payment-chevron"></i>
          </div>
          
          <div class="payment-fields" id="fields-crypto">
            <div class="field-row">
              <label class="field-label">Wallet Address</label>
              <input type="text" class="field-input" id="cryptoWalletAddress" value="0x742d35Cc6634C0532925a3b844Bc454e4438f44e" onchange="updatePaymentData('crypto', 'walletAddress', this.value)">
            </div>
            
            <div class="field-row">
              <label class="field-label">Network</label>
              <select class="field-select" id="cryptoNetwork" onchange="updatePaymentData('crypto', 'network', this.value)">
                <option value="ERC20">Ethereum (ERC-20)</option>
                <option value="BEP20">Binance (BEP-20)</option>
                <option value="TRC20">Tron (TRC-20)</option>
              </select>
            </div>
            
            <div class="field-row">
              <label class="field-label">QR Code (Optional)</label>
              <div class="file-upload">
                <i class="fas fa-qrcode"></i>
                <span>Click to upload QR code</span>
                <small>PNG, JPG</small>
                <input type="file" id="cryptoBarcode" accept="image/*" onchange="handleFileUpload(this, 'crypto')">
              </div>
              <img id="crypto-preview" class="preview-image">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Ticket System -->
      <h3 style="font-size: 18px; margin: 30px 0 16px; display: flex; align-items: center; gap: 8px;">
        <i class="fas fa-ticket-alt" style="color: #0ea5e9;"></i> Ticket System
      </h3>
      
      <div class="toggle-switch">
        <input type="checkbox" id="enableAutoTickets" checked onchange="updateTicketSetting('enableAutoTickets', this.checked)">
        <label for="enableAutoTickets">Generate order tickets</label>
      </div>
      
      <div class="toggle-switch">
        <input type="checkbox" id="enableEmailTickets" checked onchange="updateTicketSetting('enableEmailTickets', this.checked)">
        <label for="enableEmailTickets">Send email tickets</label>
      </div>
      
      <div class="toggle-switch">
        <input type="checkbox" id="enableWhatsappTickets" checked onchange="updateTicketSetting('enableWhatsappTickets', this.checked)">
        <label for="enableWhatsappTickets">Send WhatsApp tickets</label>
      </div>
      
      <div class="field-row">
        <label class="field-label">Ticket Prefix</label>
        <input type="text" class="field-input" id="ticketPrefix" value="TKT" onchange="updateTicketSetting('ticketPrefix', this.value)">
      </div>
      
      <div class="field-row">
        <label class="field-label">Admin Email</label>
        <input type="email" class="field-input" id="adminEmail" placeholder="admin@yourbusiness.com" onchange="updateTicketSetting('adminEmail', this.value)">
      </div>
      
      <div class="field-row">
        <label class="field-label">Webhook URL (Optional)</label>
        <input type="url" class="field-input" id="webhookUrl" placeholder="https://yourdomain.com/webhook" onchange="updateTicketSetting('webhookUrl', this.value)">
      </div>
      
      <!-- Action Buttons -->
      <button class="btn btn-success" onclick="savePaymentAndTicketSettings()" style="margin: 20px 0 12px;">
        <i class="fas fa-save"></i> Save All Settings
      </button>
      
      <button class="btn btn-outline" onclick="testTokenGeneration()">
        <i class="fas fa-flask"></i> Test Token Generation
      </button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
// ===== SUPABASE CLIENT =====
const db = supabase.createClient(
  "https://dfvnefbxgayxqgjjgtrr.supabase.co",
  "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

// ===== PROFESSIONAL VARIABLES =====
let productCount = 0;
let selectedPaymentGateways = []; // Multiple selection
let paymentData = {
  jazzcash: { number: '03001234567', type: 'jazzcash', barcode: '' },
  easypaisa: { number: '03001234567', barcode: '' },
  bank: { bankName: 'HBL', accountTitle: 'Business Account', accountNumber: '1234567890', iban: 'PK36HBL001234567890' },
  card: { processor: 'stripe', merchantId: 'pk_test_xxxxxxxxxxxx', webhookSecret: '' },
  cod: { enabled: true, minimumOrder: 500 },
  crypto: { walletAddress: '0x742d35Cc6634C0532925a3b844Bc454e4438f44e', network: 'ERC20', barcode: '' }
};
let ticketSettings = {
  enableAutoTickets: true,
  enableEmailTickets: true,
  enableWhatsappTickets: true,
  ticketPrefix: 'TKT',
  adminEmail: '',
  webhookUrl: ''
};

// ===== PROFESSIONAL UI FUNCTIONS =====
function showSuccess(message) {
  const successEl = document.getElementById('successMessage');
  document.getElementById('successText').textContent = message;
  successEl.style.display = 'flex';
  setTimeout(() => { successEl.style.display = 'none'; }, 3000);
}

function showLoading() {
  document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
  document.getElementById('loadingOverlay').style.display = 'none';
}

// ===== BUSINESS HOURS INITIALIZATION =====
const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const daysContainer = document.getElementById('daysContainer');

days.forEach(day => {
  const dayBox = document.createElement('div');
  dayBox.className = 'day-box';
  dayBox.innerHTML = `
    <div class="day-header">
      <span class="day-name">${day}</span>
      <select class="day-status" style="padding: 8px; border-radius: 8px; border: 2px solid var(--border);">
        <option value="open">Open</option>
        <option value="closed">Closed</option>
      </select>
    </div>
    <div class="day-time">
      <input type="time" class="day-start" value="09:00">
      <span>to</span>
      <input type="time" class="day-end" value="18:00">
    </div>
  `;
  daysContainer.appendChild(dayBox);
});

// ===== HOLIDAY FUNCTIONS =====
function addHoliday() {
  const container = document.getElementById('holidaysContainer');
  const holidayItem = document.createElement('div');
  holidayItem.className = 'holiday-item';
  holidayItem.innerHTML = `
    <input type="text" class="holidayName" placeholder="Holiday name">
    <input type="date" class="holidayDate" value="${new Date().toISOString().split('T')[0]}">
    <button type="button" class="remove-btn" onclick="removeHoliday(this)">Ã—</button>
  `;
  container.appendChild(holidayItem);
}

function removeHoliday(button) {
  button.parentElement.remove();
}

// ===== PRODUCT FUNCTIONS =====
function addOffer() {
  productCount++;
  const box = document.createElement('div');
  box.className = 'product-card';
  box.innerHTML = `
    <h3 style="margin-bottom: 12px;">Product ${productCount}</h3>
    
    <div class="file-upload" style="margin-bottom: 12px;">
      <i class="fas fa-image"></i>
      <span>Product Image</span>
      <input type="file" class="productImg" accept="image/*">
    </div>
    
    <input type="text" class="productTitle" placeholder="Product Title" style="width:100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; margin-bottom: 8px;">
    
    <textarea class="productDesc" placeholder="Description" rows="2" style="width:100%; padding: 12px; border: 2px solid var(--border); border-radius: 10px; margin-bottom: 8px;"></textarea>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 12px;">
      <input type="number" class="originalPrice" placeholder="Original Price" style="padding: 12px; border: 2px solid var(--border); border-radius: 10px;">
      <input type="number" class="discountPrice" placeholder="Discounted Price" style="padding: 12px; border: 2px solid var(--border); border-radius: 10px;">
    </div>
    
    <div class="product-badges">
      <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" value="ðŸ”¥ Hot Deal"> Hot Deal</label>
      <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" value="â­ Best Seller"> Best Seller</label>
      <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" value="ðŸ’¸ Discount"> Discount</label>
    </div>
  `;
  document.getElementById('offersForm').appendChild(box);
}

// ===== DELIVERY ZONE FUNCTIONS =====
function addDeliveryZone(zoneData = null) {
  const container = document.getElementById('deliveryZonesList');
  const zoneId = 'zone_' + Date.now();
  
  const zoneItem = document.createElement('div');
  zoneItem.className = 'zone-item';
  zoneItem.id = zoneId;
  zoneItem.innerHTML = `
    <input type="text" placeholder="City Name" value="${zoneData?.city || ''}" style="padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
    <input type="number" placeholder="Charge" value="${zoneData?.charge || ''}" style="padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
    <input type="text" placeholder="Delivery Time" value="${zoneData?.time || ''}" style="padding: 10px; border: 2px solid var(--border); border-radius: 8px;">
    <button onclick="this.parentElement.remove()" style="background: var(--danger); color: white; border: none; border-radius: 8px; padding: 10px;">Ã—</button>
  `;
  container.appendChild(zoneItem);
}

// ===== PROFESSIONAL PAYMENT FUNCTIONS =====
function togglePaymentGateway(gateway) {
  const index = selectedPaymentGateways.indexOf(gateway);
  if (index === -1) {
    selectedPaymentGateways.push(gateway);
  } else {
    selectedPaymentGateways.splice(index, 1);
  }
  
  // Update UI
  document.querySelectorAll('.payment-card').forEach(card => {
    card.classList.remove('selected');
  });
  
  selectedPaymentGateways.forEach(g => {
    const card = document.getElementById(`gateway-${g}`);
    if (card) {
      card.classList.add('selected');
      document.getElementById(`${g}-badge`).style.display = 'inline-block';
    }
  });
  
  // Hide badges for non-selected
  ['jazzcash', 'easypaisa', 'bank', 'card', 'cod', 'crypto'].forEach(g => {
    if (!selectedPaymentGateways.includes(g)) {
      const badge = document.getElementById(`${g}-badge`);
      if (badge) badge.style.display = 'none';
    }
  });
  
  console.log('Selected gateways:', selectedPaymentGateways);
}

function updatePaymentData(gateway, field, value) {
  if (!paymentData[gateway]) paymentData[gateway] = {};
  paymentData[gateway][field] = value;
  console.log(`Updated ${gateway}.${field}:`, value);
}

function handleFileUpload(input, gateway) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    
    // Store file
    if (!paymentData[gateway]) paymentData[gateway] = {};
    paymentData[gateway].barcodeFile = file;
    
    // Show preview
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = document.getElementById(`${gateway}-preview`);
      if (preview) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      }
    };
    reader.readAsDataURL(file);
    
    showSuccess(`ðŸ“· QR code uploaded for ${gateway}`);
  }
}

function updateTicketSetting(setting, value) {
  ticketSettings[setting] = value;
  console.log(`Ticket setting ${setting}:`, value);
}

// ===== TOKEN FUNCTIONS =====
function generateProfessionalToken() {
  const prefix = document.getElementById('tokenPrefix')?.value || 'TKT';
  const timestamp = Date.now().toString().slice(-8);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let random = '';
  for (let i = 0; i < 4; i++) {
    random += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return `${prefix}-${timestamp}-${random}`;
}

function testTokenGeneration() {
  const token = generateProfessionalToken();
  document.getElementById('tokenPreview').textContent = token;
  showSuccess(`âœ… Token generated: ${token}`);
}

// ===== MODAL FUNCTIONS =====
function openPaymentModal() {
  document.getElementById('paymentModal').style.display = 'flex';
  testTokenGeneration();
}

function closePaymentModal() {
  document.getElementById('paymentModal').style.display = 'none';
}

function savePaymentAndTicketSettings() {
  showSuccess('âœ… Payment settings saved successfully!');
  setTimeout(() => closePaymentModal(), 1500);
}

// ===== IMAGE COMPRESSION =====
function resizeImage(file) {
  return new Promise((resolve) => {
    if (!file) {
      resolve('');
      return;
    }
    
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      const maxSize = 1024;
      let width = img.width;
      let height = img.height;
      
      if (width > height) {
        if (width > maxSize) {
          height *= maxSize / width;
          width = maxSize;
        }
      } else {
        if (height > maxSize) {
          width *= maxSize / height;
          height = maxSize;
        }
      }
      
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);
      resolve(canvas.toDataURL('image/jpeg', 0.85));
    };
    img.src = URL.createObjectURL(file);
  });
}

// ===== MAIN GENERATE FUNCTION =====
async function generate() {
  // Validate
  if (!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value) {
    showSuccess('âŒ Name & Phone are required');
    return;
  }
  
  if (!document.getElementById('businessName').value) {
    showSuccess('âŒ Business title is required');
    return;
  }
  
  if (!document.getElementById('address').value) {
    showSuccess('âŒ Business address is required');
    return;
  }
  
  showLoading();
  
  try {
    const id = crypto.randomUUID();
    
    // Collect business hours
    const businessHours = [];
    document.querySelectorAll('.day-box').forEach(box => {
      businessHours.push({
        status: box.querySelector('.day-status').value,
        start: box.querySelector('.day-start').value,
        end: box.querySelector('.day-end').value
      });
    });
    
    // Collect holidays
    const holidays = [];
    document.querySelectorAll('#holidaysContainer .holiday-item').forEach(item => {
      const name = item.querySelector('.holidayName').value;
      const date = item.querySelector('.holidayDate').value;
      if (name && date) holidays.push({ name, date });
    });
    
    // Collect products
    const products = [];
    const productBoxes = document.querySelectorAll('.product-card');
    
    for (let i = 0; i < productBoxes.length; i++) {
      const box = productBoxes[i];
      const file = box.querySelector('.productImg').files[0];
      
      const product = {
        title: box.querySelector('.productTitle').value || '',
        desc: box.querySelector('.productDesc').value || '',
        originalPrice: parseFloat(box.querySelector('.originalPrice').value) || null,
        discountPrice: parseFloat(box.querySelector('.discountPrice').value) || null,
        badges: Array.from(box.querySelectorAll('input[type=checkbox]:checked')).map(cb => cb.value),
        image: file ? await resizeImage(file) : ''
      };
      
      if (product.title || product.image) products.push(product);
    }
    
    // Collect delivery zones
    const zones = [];
    document.querySelectorAll('#deliveryZonesList .zone-item').forEach(zone => {
      const inputs = zone.querySelectorAll('input');
      zones.push({
        city: inputs[0].value,
        charge: parseFloat(inputs[1].value),
        time: inputs[2].value
      });
    });
    
    // Process barcodes
    if (paymentData.jazzcash.barcodeFile) {
      paymentData.jazzcash.barcode = await resizeImage(paymentData.jazzcash.barcodeFile);
    }
    if (paymentData.easypaisa.barcodeFile) {
      paymentData.easypaisa.barcode = await resizeImage(paymentData.easypaisa.barcodeFile);
    }
    if (paymentData.crypto.barcodeFile) {
      paymentData.crypto.barcode = await resizeImage(paymentData.crypto.barcodeFile);
    }
    
    // Build payment methods
    const paymentMethods = {
      whatsapp: {
        active: !!document.getElementById('whatsappNumber').value,
        number: document.getElementById('whatsappNumber').value
      },
      gateways: {},
      tokenSystem: {
        enabled: document.getElementById('enableTokenSystem').checked,
        requireTokenForTracking: document.getElementById('requireTokenForTracking').checked,
        prefix: document.getElementById('tokenPrefix').value,
        length: parseInt(document.getElementById('tokenLength').value)
      }
    };
    
    // Add selected gateways
    selectedPaymentGateways.forEach(gateway => {
      if (gateway === 'cod') {
        paymentMethods.gateways.cod = {
          active: document.getElementById('codEnabled').checked,
          minimumOrder: parseFloat(document.getElementById('codMinimumOrder').value)
        };
      } else {
        paymentMethods.gateways[gateway] = {
          active: true,
          ...paymentData[gateway]
        };
      }
    });
    
    // Build final card data
    const cardData = {
      id,
      name: document.getElementById('fullName').value,
      phone: document.getElementById('phoneNumber').value,
      email: document.getElementById('email').value,
      address: document.getElementById('address').value,
      businessName: document.getElementById('businessName').value,
      business: { about: document.getElementById('businessAbout').value },
      socialMedia: {
        facebook: document.getElementById('facebook').value,
        instagram: document.getElementById('instagram').value,
        twitter: document.getElementById('twitter').value,
        linkedin: document.getElementById('linkedin').value,
        youtube: document.getElementById('youtube').value,
        tiktok: document.getElementById('tiktok').value,
        website: document.getElementById('website').value
      },
      businessHours,
      holidays,
      products,
      payments: paymentMethods,
      deliverySettings: {
        default: {
          withinCity: {
            charge: parseFloat(document.getElementById('deliveryChargeCity').value),
            time: document.getElementById('deliveryTimeCity').value
          },
          otherCities: {
            charge: parseFloat(document.getElementById('deliveryChargeOther').value),
            time: document.getElementById('deliveryTimeOther').value
          }
        },
        zones,
        freeDeliveryMin: parseFloat(document.getElementById('freeDeliveryMin').value),
        cutoffTime: document.getElementById('deliveryCutoffTime').value,
        maxDays: document.getElementById('deliveryDays').value,
        addressConfirmation: {
          required: document.getElementById('requireAddressConfirmation').checked,
          saveAddresses: document.getElementById('saveCustomerAddresses').checked
        }
      },
      ticketSettings,
      version: '3.0.0',
      created: new Date().toISOString()
    };
    
    // Add profile image
    if (document.getElementById('profileImage').files[0]) {
      cardData.profileImage = await resizeImage(document.getElementById('profileImage').files[0]);
    }
    
    // Save to Supabase
    const { data: inserted, error } = await db.from('cards').insert({
      id,
      data: JSON.stringify(cardData)
    }).select().single();
    
    if (error) throw error;
    
    localStorage.setItem('lastCardId', inserted.id);
    hideLoading();
    showSuccess('âœ… Card created! Redirecting...');
    
    setTimeout(() => {
      location.href = 'card.html?id=' + inserted.id;
    }, 2000);
    
  } catch (error) {
    hideLoading();
    console.error('Error:', error);
    showSuccess('âŒ Error: ' + error.message);
  }
}

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', function() {
  // Add sample zones
  addDeliveryZone({city: 'Karachi', charge: 150, time: '1-2 days'});
  addDeliveryZone({city: 'Lahore', charge: 200, time: '2-3 days'});
  addDeliveryZone({city: 'Islamabad', charge: 250, time: '2-3 days'});
  
  // Add first product
  addOffer();
  
  // Select COD by default
  setTimeout(() => {
    togglePaymentGateway('cod');
  }, 100);
  
  // Update WhatsApp preview
  document.getElementById('businessName').addEventListener('input', function(e) {
    const preview = document.getElementById('whatsappPreview');
    if (preview) {
      preview.innerHTML = `ðŸŽ‰ *NEW ORDER CONFIRMED* - TOKEN: TKT-123456-A7F2

*Order ID:* ORD-12345678
*Token:* TKT-123456-A7F2
*Customer:* [Customer Name]
*Phone:* [Customer Phone]
*Address:* [Full Address]

*ITEMS:*
â€¢ Product 1 (Qty: 1) - PKR 1,000

*Total:* PKR 1,150

Thank you for your order from ${e.target.value}! ðŸ›ï¸`;
    }
  });
  
  // Token preview on change
  document.getElementById('tokenPrefix').addEventListener('input', testTokenGeneration);
  document.getElementById('tokenLength').addEventListener('change', testTokenGeneration);
});
</script>
</body>
</html>
