<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Digital Business Card ¬∑ Professional Suite</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(145deg, #0b1120 0%, #19233c 100%);
      font-family: 'Inter', sans-serif;
      padding: 16px;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
    }

    /* cards + consistent spacing */
    .card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(2px);
      border-radius: 32px;
      padding: 24px 20px;
      margin-bottom: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.2);
      width: 100%;
      overflow: visible;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .card-header i {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
      flex-shrink: 0;
    }

    .card-header h2 {
      font-size: 1.25rem;
      font-weight: 700;
      color: #0f172a;
      line-height: 1.3;
    }

    .card-header p {
      font-size: 0.8rem;
      color: #475569;
    }

    /* inputs ‚Äî never overflow */
    .input-group {
      margin-bottom: 18px;
      width: 100%;
    }

    .input-group label {
      display: block;
      font-weight: 600;
      font-size: 0.85rem;
      color: #1e293b;
      margin-bottom: 6px;
    }

    .input-group input,
    .input-group textarea,
    .input-group select {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 20px;
      font-size: 0.95rem;
      background: white;
      transition: 0.2s;
      font-family: 'Inter', sans-serif;
    }

    .input-group input:focus,
    .input-group textarea:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59,130,246,0.2);
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* file upload ‚Äì refined */
    .file-upload {
      border: 2px dashed #cbd5e1;
      border-radius: 24px;
      padding: 20px;
      text-align: center;
      background: #f8fafc;
      position: relative;
      cursor: pointer;
      transition: 0.2s;
    }

    .file-upload:hover {
      border-color: #3b82f6;
      background: #f1f5f9;
    }

    .file-upload i {
      font-size: 28px;
      color: #3b82f6;
      margin-bottom: 6px;
    }

    .file-upload span {
      display: block;
      font-weight: 500;
      color: #1e293b;
    }

    .file-upload small {
      font-size: 0.75rem;
      color: #64748b;
    }

    .file-upload input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .preview-image {
      max-width: 80px;
      max-height: 80px;
      border-radius: 16px;
      margin-top: 12px;
      border: 2px solid #e2e8f0;
      display: none;
      object-fit: cover;
    }

    /* social grid ‚Äì no overflow */
    .social-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 10px;
      margin-top: 12px;
    }

    .social-input {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #f1f5f9;
      border-radius: 18px;
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
    }

    .social-input i {
      font-size: 1.2rem;
      min-width: 20px;
    }

    .social-input input {
      border: none;
      background: transparent;
      width: 100%;
      padding: 0;
      font-size: 0.85rem;
    }

    .social-input input:focus {
      outline: none;
    }

    /* business hours ‚Äì no overflow */
    .day-box {
      background: #f8fafc;
      border-radius: 24px;
      padding: 18px;
      margin-bottom: 12px;
      border: 2px solid #e2e8f0;
    }

    .day-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .day-name {
      font-weight: 700;
      color: #0f172a;
      min-width: 90px;
    }

    .day-status {
      padding: 8px 14px;
      border-radius: 40px;
      border: 2px solid #cbd5e1;
      background: white;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .day-time {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-left: 0;
    }

    .day-time input {
      padding: 10px 14px;
      border-radius: 40px;
      border: 2px solid #cbd5e1;
      background: white;
      flex: 1 1 110px;
    }

    /* holidays & zones */
    .holiday-item {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      background: #f8fafc;
      border-radius: 20px;
      padding: 14px;
      border: 2px solid #e2e8f0;
      margin-bottom: 10px;
    }

    .holiday-item > * {
      flex: 1 1 auto;
    }

    .holiday-item input {
      padding: 12px;
      border: 2px solid #cbd5e1;
      border-radius: 18px;
    }

    .remove-btn {
      width: 48px;
      height: 48px;
      border-radius: 18px;
      background: #ef4444;
      color: white;
      border: none;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      flex-shrink: 0;
    }

    .add-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      padding: 16px;
      border-radius: 30px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      margin-top: 16px;
    }

    /* zone item */
    .zone-item {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      background: #f8fafc;
      border-radius: 20px;
      padding: 14px;
      border: 2px solid #e2e8f0;
      margin-bottom: 10px;
    }

    .zone-item input {
      padding: 12px;
      border: 2px solid #cbd5e1;
      border-radius: 18px;
      flex: 1 1 100px;
    }

    .zone-item button {
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 18px;
      width: 48px;
      height: 48px;
      font-size: 1.4rem;
      cursor: pointer;
    }

    /* product cards inside scroll ‚Äì now they never overflow */
    .products-scroll {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding: 8px 4px 16px;
      scrollbar-width: thin;
      -webkit-overflow-scrolling: touch;
    }

    .product-card {
      min-width: 280px;
      background: white;
      border-radius: 28px;
      padding: 20px;
      border: 2px solid #e2e8f0;
      flex-shrink: 0;
    }

    .product-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 12px 0 0;
    }

    .product-badges label {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #f1f5f9;
      padding: 6px 12px;
      border-radius: 30px;
      font-size: 0.8rem;
    }

    /* buttons */
    .btn {
      padding: 16px 24px;
      border: none;
      border-radius: 40px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      margin-bottom: 16px;
      transition: 0.2s;
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
    }

    /* modal ‚Äî FIXED: never goes outside */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 12px;
      box-sizing: border-box;
    }

    .modal-content {
      background: white;
      border-radius: 40px;
      width: 100%;
      max-width: 460px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 30px 60px rgba(0,0,0,0.6);
      margin: 0 auto;
    }

    .modal-header {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      padding: 22px 24px;
      border-radius: 40px 40px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-close {
      background: rgba(255,255,255,0.25);
      border: none;
      color: white;
      width: 44px;
      height: 44px;
      border-radius: 20px;
      font-size: 1.8rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-body {
      padding: 24px;
    }

    /* payment cards inside modal ‚Äî perfectly contained */
    .payment-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .payment-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 28px;
      overflow: hidden;
    }

    .payment-card.selected {
      border-color: #10b981;
      box-shadow: 0 8px 20px rgba(16,185,129,0.15);
    }

    .payment-card-header {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
    }

    .payment-icon {
      width: 52px;
      height: 52px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      color: white;
      flex-shrink: 0;
    }

    .payment-info {
      flex: 1;
    }

    .payment-name {
      font-weight: 700;
      color: #0f172a;
      font-size: 1.1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
    }

    .payment-badge {
      background: #10b981;
      color: white;
      padding: 4px 10px;
      border-radius: 40px;
      font-size: 0.7rem;
    }

    .payment-desc {
      font-size: 0.8rem;
      color: #475569;
    }

    .payment-chevron {
      color: #94a3b8;
      transition: 0.2s;
    }

    .payment-card.selected .payment-chevron {
      transform: rotate(180deg);
      color: #10b981;
    }

    /* payment fields ‚Äì padded well */
    .payment-fields {
      padding: 0 20px 24px 86px;
      display: none;
    }

    .payment-card.selected .payment-fields {
      display: block;
    }

    .field-row {
      margin-bottom: 18px;
    }

    .field-label {
      font-size: 0.8rem;
      font-weight: 600;
      color: #334155;
      margin-bottom: 5px;
    }

    .field-input, .field-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 24px;
      font-size: 0.9rem;
      background: white;
    }

    .token-preview {
      background: #0f172a;
      border-radius: 28px;
      padding: 20px;
      margin: 20px 0;
      color: white;
    }

    .token-code {
      font-family: 'Courier New', monospace;
      font-size: 1.4rem;
      font-weight: 800;
      color: #10b981;
      text-align: center;
      padding: 14px;
      background: rgba(255,255,255,0.08);
      border-radius: 20px;
      word-break: break-word;
    }

    .toggle-switch {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .toggle-switch input[type=checkbox] {
      width: 48px;
      height: 26px;
      appearance: none;
      background: #cbd5e1;
      border-radius: 40px;
      position: relative;
      cursor: pointer;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .toggle-switch input:checked {
      background: #10b981;
    }

    .toggle-switch input::before {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: 0.2s;
    }

    .toggle-switch input:checked::before {
      left: 24px;
    }

    .toggle-switch label {
      font-weight: 600;
      color: #1e293b;
    }

    .loading-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: white;
    }

    .loading-spinner {
      width: 54px;
      height: 54px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .success-message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #10b981;
      color: white;
      padding: 14px 28px;
      border-radius: 60px;
      font-weight: 600;
      box-shadow: 0 15px 30px rgba(16,185,129,0.5);
      z-index: 4000;
      display: none;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      max-width: 90vw;
    }
    /* small screens tweaks */
    @media (max-width: 420px) {
      .payment-fields { padding-left: 20px; }
      .day-time input { flex: 1 1 100%; }
      .social-grid { grid-template-columns: 1fr; }
      .modal-body { padding: 16px; }
    }
  </style>
</head>
<body>
<div class="container">

<div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i> <span id="successText">Success</span></div>
<div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text">Creating professional card...</div></div>

<!-- PROFILE CARD (exactly same structure, safe) -->
<div class="card">
  <div class="card-header"><i class="fas fa-user"></i><div><h2>Profile Information</h2><p>Personal & business details</p></div></div>
  <div class="input-group"><label>Profile image</label><div class="file-upload"><i class="fas fa-cloud-upload-alt"></i><span>Click to upload</span><small>PNG, JPG up to 5MB</small><input type="file" id="profileImage" accept="image/*"></div></div>
  <div class="input-group"><label>Full name *</label><input type="text" id="fullName" placeholder="Enter full name"></div>
  <div class="input-group"><label>Phone *</label><input type="tel" id="phoneNumber" placeholder="03XXXXXXXXX"></div>
  <div class="input-group"><label>Email</label><input type="email" id="email" placeholder="your@email.com"></div>
  <div class="input-group"><label>Business address *</label><textarea id="address" rows="2" placeholder="Complete address"></textarea></div>
</div>

<!-- BUSINESS DETAILS -->
<div class="card">
  <div class="card-header"><i class="fas fa-building"></i><div><h2>Business details</h2><p>Your identity</p></div></div>
  <div class="input-group"><label>Business title *</label><input type="text" id="businessName" placeholder="Your business name"></div>
  <div class="input-group"><label>About business</label><textarea id="businessAbout" rows="2" placeholder="Describe..."></textarea></div>
  <div class="input-group"><label>Website</label><input type="url" id="website" placeholder="https://..."></div>
  <h3 style="margin:20px 0 12px; font-size:1rem;">Social links</h3>
  <div class="social-grid">
    <div class="social-input"><i class="fab fa-facebook" style="color:#1877F2;"></i><input type="text" id="facebook" placeholder="Facebook"></div>
    <div class="social-input"><i class="fab fa-instagram" style="color:#E4405F;"></i><input type="text" id="instagram" placeholder="Instagram"></div>
    <div class="social-input"><i class="fab fa-twitter" style="color:#1DA1F2;"></i><input type="text" id="twitter" placeholder="Twitter"></div>
    <div class="social-input"><i class="fab fa-linkedin" style="color:#0A66C2;"></i><input type="text" id="linkedin" placeholder="LinkedIn"></div>
    <div class="social-input"><i class="fab fa-youtube" style="color:#FF0000;"></i><input type="text" id="youtube" placeholder="YouTube"></div>
    <div class="social-input"><i class="fab fa-tiktok"></i><input type="text" id="tiktok" placeholder="TikTok"></div>
  </div>
</div>

<!-- BUSINESS HOURS -->
<div class="card"><div class="card-header"><i class="fas fa-clock"></i><div><h2>Business hours</h2><p>Working days</p></div></div><div id="daysContainer"></div></div>

<!-- HOLIDAYS -->
<div class="card"><div class="card-header"><i class="fas fa-calendar-times"></i><div><h2>Special holidays</h2><p>Closed days</p></div></div><div id="holidaysContainer"><div class="holiday-item"><input type="text" class="holidayName" placeholder="Holiday name" value="Eid"><input type="date" class="holidayDate"><button class="remove-btn" onclick="removeHoliday(this)">√ó</button></div></div><button class="add-btn" onclick="addHoliday()"><i class="fas fa-plus"></i> Add Holiday</button></div>

<!-- DELIVERY SETTINGS -->
<div class="card">
  <div class="card-header"><i class="fas fa-truck"></i><div><h2>Delivery settings</h2><p>Charges & zones</p></div></div>
  <h3 style="font-size:1rem; margin-bottom:12px;">Default</h3>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>Within city (PKR)</label><input type="number" id="deliveryChargeCity" value="150"></div>
    <div class="input-group"><label>Other cities (PKR)</label><input type="number" id="deliveryChargeOther" value="300"></div>
  </div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>City time</label><input type="text" id="deliveryTimeCity" value="1-2 days"></div>
    <div class="input-group"><label>Other time</label><input type="text" id="deliveryTimeOther" value="3-5 days"></div>
  </div>
  <div class="input-group"><label>Free min (PKR)</label><input type="number" id="freeDeliveryMin" value="2000"></div>
  <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
    <div class="input-group"><label>Cutoff time</label><input type="time" id="deliveryCutoffTime" value="16:00"></div>
    <div class="input-group"><label>Max days</label><input type="text" id="deliveryDays" value="5-7 days"></div>
  </div>
  <h3 style="margin:20px 0 12px;">Specific zones</h3>
  <div id="deliveryZonesList"></div>
  <button class="add-btn" onclick="addDeliveryZone()" style="background:#8b5cf6"><i class="fas fa-plus"></i> Add zone</button>
  <div style="margin-top:20px; background:#f0f9ff; border-radius:20px; padding:16px;">
    <div class="toggle-switch"><input type="checkbox" id="requireAddressConfirmation" checked><label>Require address confirmation</label></div>
    <div class="toggle-switch"><input type="checkbox" id="saveCustomerAddresses" checked><label>Save customer addresses</label></div>
  </div>
</div>

<!-- PRODUCTS -->
<div class="card"><div class="card-header"><i class="fas fa-gift"></i><div><h2>Products & offers</h2></div></div><div id="offersForm" class="products-scroll"></div><button class="add-btn" onclick="addOffer()" style="background:#8b5cf6"><i class="fas fa-plus"></i> Add product</button></div>

<!-- ACTION BUTTONS (inside container, no overflow) -->
<button class="btn btn-success" onclick="openPaymentModal()"><i class="fas fa-credit-card"></i> Configure payments & tokens</button>
<button class="btn btn-primary" onclick="generate()"><i class="fas fa-magic"></i> Generate digital card</button>

<!-- PAYMENT MODAL ‚Äì completely safe, scrolls inside -->
<div class="modal" id="paymentModal">
  <div class="modal-content">
    <div class="modal-header"><h2><i class="fas fa-cog"></i> Payment & Token</h2><button class="modal-close" onclick="closePaymentModal()">√ó</button></div>
    <div class="modal-body">
      <h3 style="display:flex; gap:8px; margin-bottom:16px;"><i class="fab fa-whatsapp" style="color:#25D366;"></i> WhatsApp</h3>
      <div class="input-group"><label>WhatsApp number</label><input type="text" id="whatsappNumber" placeholder="+92300..." value="+92"></div>
      <div style="background:#e6f7ff; border-radius:24px; padding:16px; margin:20px 0;">
        <div style="background:white; border-radius:16px; padding:16px; font-family:monospace; font-size:0.85rem; white-space:pre-wrap;" id="whatsappPreview">üéâ *NEW ORDER* - TOKEN: TKT-123456-A7F2\n*Order ID:* ORD-12345678\n*Token:* TKT-123456-A7F2\n*Customer:* [Name]\n...</div>
      </div>
      <h3 style="margin:24px 0 12px;"><i class="fas fa-ticket-alt"></i> Token system</h3>
      <div class="toggle-switch"><input type="checkbox" id="enableTokenSystem" checked><label>Enable token generation</label></div>
      <div class="toggle-switch"><input type="checkbox" id="requireTokenForTracking" checked><label>Require token for tracking</label></div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div class="input-group"><label>Prefix</label><input type="text" id="tokenPrefix" value="TKT"></div>
        <div class="input-group"><label>Length</label><select id="tokenLength"><option value="8">8</option><option value="10">10</option><option value="12" selected>12</option></select></div>
      </div>
      <div class="token-preview"><div class="token-code" id="tokenPreview">TKT-87654321-X9Y2</div></div>

      <h3 style="margin:28px 0 12px;"><i class="fas fa-credit-card"></i> Payment gateways (multi)</h3>
      <div class="payment-grid" id="paymentGateways">
        <!-- JAZZCASH -->
        <div class="payment-card" id="gateway-jazzcash"><div class="payment-card-header" onclick="togglePaymentGateway('jazzcash')"><div class="payment-icon" style="background:#FF6B00;"><i class="fas fa-mobile-alt"></i></div><div class="payment-info"><div class="payment-name">JazzCash <span class="payment-badge" id="jazzcash-badge" style="display:none;">Active</span></div><div class="payment-desc">Mobile wallet</div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-jazzcash"><div class="field-row"><label class="field-label">Account number</label><input class="field-input" id="jazzcashNumber" value="03001234567"></div><div class="field-row"><label>Account type</label><select class="field-select" id="jazzcashType"><option value="jazzcash">JazzCash</option><option value="easypaisa">EasyPaisa</option></select></div><div class="field-row"><label>QR code</label><div class="file-upload"><i class="fas fa-qrcode"></i><span>Upload QR</span><input type="file" id="jazzcashBarcode" accept="image/*" onchange="handleFileUpload(this,'jazzcash')"></div><img id="jazzcash-preview" class="preview-image"></div></div></div>
        <!-- EASYPAISA -->
        <div class="payment-card" id="gateway-easypaisa"><div class="payment-card-header" onclick="togglePaymentGateway('easypaisa')"><div class="payment-icon" style="background:#0A5C36;"><i class="fas fa-wallet"></i></div><div class="payment-info"><div class="payment-name">EasyPaisa <span class="payment-badge" id="easypaisa-badge" style="display:none;">Active</span></div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-easypaisa"><div class="field-row"><label>Account number</label><input class="field-input" id="easypaisaNumber" value="03001234567"></div><div class="field-row"><label>QR code</label><div class="file-upload"><i class="fas fa-qrcode"></i><input type="file" id="easypaisaBarcode" accept="image/*" onchange="handleFileUpload(this,'easypaisa')"></div><img id="easypaisa-preview" class="preview-image"></div></div></div>
        <!-- BANK -->
        <div class="payment-card" id="gateway-bank"><div class="payment-card-header" onclick="togglePaymentGateway('bank')"><div class="payment-icon" style="background:#2563eb;"><i class="fas fa-university"></i></div><div class="payment-info"><div class="payment-name">Bank Transfer <span class="payment-badge" id="bank-badge" style="display:none;">Active</span></div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-bank"><div class="field-row"><label>Bank</label><select class="field-select" id="bankName"><option value="HBL">HBL</option><option value="UBL">UBL</option></select></div><div class="field-row"><label>Account title</label><input class="field-input" id="accountTitle" value="Business Account"></div><div class="field-row"><label>Account number</label><input class="field-input" id="accountNumber" value="1234567890"></div><div class="field-row"><label>IBAN</label><input class="field-input" id="ibanNumber" value="PK36..."></div></div></div>
        <!-- CARD -->
        <div class="payment-card" id="gateway-card"><div class="payment-card-header" onclick="togglePaymentGateway('card')"><div class="payment-icon" style="background:#8b5cf6;"><i class="fas fa-credit-card"></i></div><div class="payment-info"><div class="payment-name">Card <span class="payment-badge" id="card-badge" style="display:none;">Active</span></div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-card"><div class="field-row"><label>Processor</label><select class="field-select" id="cardProcessor"><option value="stripe">Stripe</option></select></div><div class="field-row"><label>Merchant ID</label><input class="field-input" id="merchantId" value="pk_test_xxx"></div></div></div>
        <!-- COD -->
        <div class="payment-card" id="gateway-cod"><div class="payment-card-header" onclick="togglePaymentGateway('cod')"><div class="payment-icon" style="background:#10b981;"><i class="fas fa-truck"></i></div><div class="payment-info"><div class="payment-name">Cash on delivery <span class="payment-badge" id="cod-badge" style="display:none;">Active</span></div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-cod"><div class="toggle-switch"><input type="checkbox" id="codEnabled" checked><label>Enable COD</label></div><div class="field-row"><label>Min order (PKR)</label><input class="field-input" id="codMinimumOrder" value="500"></div></div></div>
        <!-- CRYPTO -->
        <div class="payment-card" id="gateway-crypto"><div class="payment-card-header" onclick="togglePaymentGateway('crypto')"><div class="payment-icon" style="background:#f7931a;"><i class="fab fa-bitcoin"></i></div><div class="payment-info"><div class="payment-name">Crypto <span class="payment-badge" id="crypto-badge" style="display:none;">Active</span></div></div><i class="fas fa-chevron-down payment-chevron"></i></div><div class="payment-fields" id="fields-crypto"><div class="field-row"><label>Wallet</label><input class="field-input" id="cryptoWalletAddress" value="0x742d..."></div><div class="field-row"><label>Network</label><select class="field-select" id="cryptoNetwork"><option>ERC20</option></select></div><div class="field-row"><label>QR</label><div class="file-upload"><i class="fas fa-qrcode"></i><input type="file" id="cryptoBarcode" onchange="handleFileUpload(this,'crypto')"></div><img id="crypto-preview" class="preview-image"></div></div></div>
      </div>
      <button class="btn btn-success" onclick="savePaymentAndTicketSettings()" style="margin:20px 0;"><i class="fas fa-save"></i> Save all settings</button>
      <button class="btn btn-outline" onclick="testTokenGeneration()"><i class="fas fa-flask"></i> Test token</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  // dummy supabase (avoid crash)
  const db = supabase.createClient('https://dfvnefbxgayxqgjjgtrr.supabase.co', 'sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE');
  let selectedPaymentGateways = [];
  let paymentData = {}, ticketSettings = {};

  // helpers
  function showSuccess(m) { const e=document.getElementById('successMessage'); document.getElementById('successText').innerText=m; e.style.display='flex'; setTimeout(()=>e.style.display='none',2500); }
  function showLoading() { document.getElementById('loadingOverlay').style.display='flex'; }
  function hideLoading() { document.getElementById('loadingOverlay').style.display='none'; }

  // business hours init
  const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  const dc = document.getElementById('daysContainer');
  days.forEach(day=>{const d=document.createElement('div'); d.className='day-box'; d.innerHTML=`
    <div class="day-header"><span class="day-name">${day}</span><select class="day-status"><option value="open" selected>Open</option><option value="closed">Closed</option></select></div>
    <div class="day-time"><input type="time" class="day-start" value="09:00"><span>to</span><input type="time" class="day-end" value="18:00"></div>`; dc.appendChild(d);});

  function addHoliday(){ const c=document.getElementById('holidaysContainer'), d=document.createElement('div'); d.className='holiday-item'; d.innerHTML='<input type="text" class="holidayName" placeholder="Holiday name"><input type="date" class="holidayDate"><button class="remove-btn" onclick="removeHoliday(this)">√ó</button>'; c.appendChild(d); }
  window.removeHoliday = (btn)=>btn.parentElement.remove();

  let productCount=0;
  function addOffer(){productCount++; const b=document.createElement('div'); b.className='product-card'; b.innerHTML=`
    <h4 style="margin-bottom:10px;">Product ${productCount}</h4>
    <div class="file-upload"><i class="fas fa-image"></i><span>Product image</span><input type="file" class="productImg" accept="image/*"></div>
    <input type="text" class="productTitle" placeholder="Title" style="width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:20px; margin:8px 0;">
    <textarea class="productDesc" placeholder="Description" rows="2" style="width:100%; padding:12px; border-radius:20px; border:2px solid #e2e8f0;"></textarea>
    <div style="display:grid; gap:8px; grid-template-columns:1fr 1fr; margin:8px 0;">
      <input type="number" class="originalPrice" placeholder="Original price">
      <input type="number" class="discountPrice" placeholder="Discounted price">
    </div>
    <div class="product-badges"><label><input type="checkbox" value="Hot Deal"> üî• Hot</label><label><input type="checkbox" value="Best Seller"> ‚≠ê Best</label><label><input type="checkbox" value="Discount"> üí∏ Sale</label></div>
  `; document.getElementById('offersForm').appendChild(b);}

  function addDeliveryZone(z){ const c=document.getElementById('deliveryZonesList'), id='zone_'+Date.now(), d=document.createElement('div'); d.className='zone-item'; d.innerHTML=`<input type="text" placeholder="City" value="${z?.city||''}"><input type="number" placeholder="Charge" value="${z?.charge||''}"><input type="text" placeholder="Time" value="${z?.time||''}"><button onclick="this.parentElement.remove()">√ó</button>`; c.appendChild(d);}
  window.addDeliveryZone = ()=>addDeliveryZone({city:'',charge:'',time:''});

  // payment modal
  window.openPaymentModal = ()=>document.getElementById('paymentModal').style.display='flex';
  window.closePaymentModal = ()=>document.getElementById('paymentModal').style.display='none';
  window.togglePaymentGateway = (g)=>{
    const idx = selectedPaymentGateways.indexOf(g);
    idx===-1 ? selectedPaymentGateways.push(g) : selectedPaymentGateways.splice(idx,1);
    document.querySelectorAll('.payment-card').forEach(c=>c.classList.remove('selected'));
    selectedPaymentGateways.forEach(gw=>{ const card=document.getElementById(`gateway-${gw}`); if(card){ card.classList.add('selected'); document.getElementById(`${gw}-badge`).style.display='inline-block'; } });
    ['jazzcash','easypaisa','bank','card','cod','crypto'].forEach(gw=>{if(!selectedPaymentGateways.includes(gw)){ let b=document.getElementById(`${gw}-badge`); if(b) b.style.display='none';}});
  };
  window.handleFileUpload = (input, gw)=>{ if(input.files?.[0]){ const r=new FileReader(); r.onload=(e)=>{let p=document.getElementById(gw+'-preview'); if(p){ p.src=e.target.result; p.style.display='block'; } }; r.readAsDataURL(input.files[0]); showSuccess('QR uploaded'); } };
  window.testTokenGeneration = ()=>{ let p=document.getElementById('tokenPrefix')?.value||'TKT', ts=Date.now().toString().slice(-8), r=Math.random().toString(36).substring(2,6).toUpperCase(); document.getElementById('tokenPreview').innerText=`${p}-${ts}-${r}`; };
  window.savePaymentAndTicketSettings = ()=>{ showSuccess('‚úÖ Payment settings saved'); setTimeout(()=>closePaymentModal(),1200); };

  // initial data
  setTimeout(()=>{ addDeliveryZone({city:'Karachi',charge:150,time:'1-2 days'}); addDeliveryZone({city:'Lahore',charge:200,time:'2-3 days'}); addOffer(); togglePaymentGateway('cod'); testTokenGeneration(); },100);

  // generate (simplified)
  window.generate = async function(){ 
    if(!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value || !document.getElementById('businessName').value) 
      return showSuccess('‚ùå Name, phone & business required');
    showLoading();
    setTimeout(()=>{ hideLoading(); showSuccess('‚úÖ Digital card created! (demo)'); },1500);
  }
</script>
</body>
</html>
