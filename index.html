<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Digital Business Card - Professional E-Commerce Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ===== PROFESSIONAL STYLING ===== */
:root {
  --primary: #667eea;
  --primary-dark: #5a67d8;
  --secondary: #764ba2;
  --success: #10b981;
  --danger: #ef4444;
  --warning: #f59e0b;
  --dark: #1e293b;
  --light: #f8fafc;
  --gray: #64748b;
  --border: #e2e8f0;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 16px;
}

.container {
  max-width: 480px;
  margin: 0 auto;
  width: 100%;
}

/* ===== CARDS ===== */
.card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  width: 100%;
  box-sizing: border-box;
  overflow: hidden;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 2px solid var(--border);
}

.card-header i {
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 18px;
  flex-shrink: 0;
}

.card-header h2 {
  font-size: 18px;
  font-weight: 700;
  color: var(--dark);
  margin: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.card-header p {
  font-size: 12px;
  color: var(--gray);
  margin-top: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ===== FIXED PRODUCT CARDS - PROPER SIZE ===== */
.products-scroll {
  display: flex;
  gap: 12px;
  overflow-x: auto;
  padding: 4px 0 12px;
  scrollbar-width: thin;
  width: 100%;
  -webkit-overflow-scrolling: touch;
}

.product-card {
  min-width: 240px; /* REDUCED from 280px */
  max-width: 240px; /* FIXED WIDTH */
  background: white;
  border-radius: 16px;
  padding: 14px;
  border: 2px solid var(--border);
  flex-shrink: 0;
  position: relative;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  transition: all 0.2s ease;
}

.product-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.1);
}

/* ===== FIXED PRODUCT IMAGE THUMBNAIL ===== */
.product-image-container {
  width: 100%;
  height: 120px;
  margin-bottom: 12px;
  border-radius: 10px;
  overflow: hidden;
  border: 2px solid var(--border);
  background: #f8fafc;
  position: relative;
}

.product-image-preview {
  width: 100%;
  height: 100%;
  object-fit: cover; /* CHANGED from contain to cover */
  display: none;
}

.product-image-preview.show {
  display: block;
}

.product-image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  color: #94a3b8;
  background: #f1f5f9;
}

.product-image-placeholder i {
  font-size: 32px;
  margin-bottom: 4px;
  color: #cbd5e1;
}

.product-image-placeholder span {
  font-size: 11px;
}

.product-image-placeholder.hidden {
  display: none;
}

/* ===== FIXED UPLOAD AREA ===== */
.upload-area {
  border: 2px dashed var(--border);
  border-radius: 8px;
  padding: 8px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  background: #f8fafc;
  margin: 8px 0;
  font-size: 11px;
}

.upload-area:hover {
  border-color: var(--primary);
  background: #f1f5f9;
}

.upload-area.has-file {
  border-color: var(--success);
  background: #f0fdf4;
}

.upload-area i {
  font-size: 16px;
  color: var(--primary);
  margin-right: 4px;
}

.upload-area.has-file i {
  color: var(--success);
}

.upload-area span {
  display: inline-block;
  font-size: 11px;
  color: var(--gray);
  max-width: 140px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle;
}

.upload-area input {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0;
  cursor: pointer;
}

/* ===== PRODUCT TITLE AND INPUTS - FIXED SIZES ===== */
.product-card h3 {
  font-size: 14px;
  margin-bottom: 8px;
  color: var(--dark);
}

.product-card input,
.product-card textarea {
  width: 100%;
  padding: 8px 10px;
  border: 2px solid var(--border);
  border-radius: 8px;
  font-size: 12px;
  margin-bottom: 6px;
  box-sizing: border-box;
}

.product-card textarea {
  min-height: 60px;
  resize: vertical;
}

.price-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  margin-bottom: 8px;
}

/* ===== PRODUCT BADGES - COMPACT ===== */
.product-badges {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 8px;
}

.product-badges label {
  display: flex;
  align-items: center;
  gap: 2px;
  font-size: 10px;
  background: #f1f5f9;
  padding: 4px 8px;
  border-radius: 20px;
  cursor: pointer;
}

.product-badges input[type="checkbox"] {
  width: auto;
  margin: 0;
  accent-color: var(--primary);
}

/* ===== REMOVE IMAGE BUTTON ===== */
.btn-small {
  background: var(--danger);
  color: white;
  border: none;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 10px;
  cursor: pointer;
  margin-bottom: 8px;
  width: 100%;
}

.btn-small:hover {
  background: #dc2626;
}

/* ===== PROFILE THUMBNAIL ===== */
.thumbnail-preview {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-top: 12px;
  padding: 10px;
  background: #f8fafc;
  border-radius: 10px;
  border: 2px solid var(--border);
}

.thumbnail-preview.hidden {
  display: none;
}

.thumbnail-image {
  width: 50px;
  height: 50px;
  border-radius: 8px;
  object-fit: cover;
  border: 2px solid var(--primary);
  background: white;
  flex-shrink: 0;
}

.thumbnail-info {
  flex: 1;
  min-width: 0;
}

.thumbnail-name {
  font-weight: 600;
  color: var(--dark);
  font-size: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.thumbnail-size {
  font-size: 10px;
  color: var(--gray);
  margin-top: 2px;
}

.thumbnail-remove {
  color: var(--danger);
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
  padding: 0 6px;
  flex-shrink: 0;
  font-weight: 700;
}

/* ===== REST OF YOUR STYLES ===== */
.input-group {
  margin-bottom: 16px;
  width: 100%;
}

.input-group label {
  display: block;
  font-size: 13px;
  font-weight: 600;
  color: var(--dark);
  margin-bottom: 4px;
}

.input-group input,
.input-group textarea,
.input-group select {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--border);
  border-radius: 12px;
  font-size: 14px;
  transition: all 0.3s ease;
  background: white;
  box-sizing: border-box;
}

.row-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  width: 100%;
}

.social-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-top: 12px;
  width: 100%;
}

.social-input {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px;
  background: #f8fafc;
  border-radius: 10px;
  border: 2px solid var(--border);
  transition: all 0.3s ease;
  width: 100%;
  box-sizing: border-box;
}

.social-input i {
  width: 18px;
  color: var(--gray);
  font-size: 14px;
  flex-shrink: 0;
}

.social-input input {
  flex: 1;
  border: none;
  background: transparent;
  padding: 0;
  font-size: 12px;
  min-width: 0;
  width: 100%;
}

.btn {
  padding: 14px 20px;
  border: none;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  width: 100%;
  box-sizing: border-box;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
}

.success-message {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(135deg, var(--success), #059669);
  color: white;
  padding: 12px 20px;
  border-radius: 40px;
  box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
  z-index: 4000;
  font-weight: 600;
  font-size: 13px;
  display: none;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
  max-width: 90%;
  overflow: hidden;
  text-overflow: ellipsis;
}

.loading-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.9);
  backdrop-filter: blur(10px);
  z-index: 3000;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
  box-sizing: border-box;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid rgba(255,255,255,0.2);
  border-top: 4px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  justify-content: center;
  align-items: center;
  padding: 16px;
  box-sizing: border-box;
  overflow-y: auto;
}

.modal-content {
  background: white;
  border-radius: 24px;
  width: 100%;
  max-width: 440px;
  max-height: 85vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  margin: auto;
  box-sizing: border-box;
}

.modal-header {
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  color: white;
  padding: 16px 20px;
  border-radius: 24px 24px 0 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 480px) {
  .social-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .row-2 {
    grid-template-columns: 1fr;
  }
  
  .product-card {
    min-width: 220px; /* EVEN SMALLER on mobile */
    max-width: 220px;
  }
}

@media (max-width: 360px) {
  .product-card {
    min-width: 200px;
    max-width: 200px;
  }
}
</style>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<div class="container">

<!-- Success Message -->
<div class="success-message" id="successMessage">
  <i class="fas fa-check-circle"></i>
  <span id="successText">Success!</span>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <div class="loading-text">Creating your professional digital business card...</div>
</div>

<!-- ===== PROFILE SECTION ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-user"></i>
    <div style="min-width:0; flex:1;">
      <h2>Profile Information</h2>
      <p>Your personal and business details</p>
    </div>
  </div>
  
  <div class="input-group">
    <label>Profile Image</label>
    <div class="upload-area" id="profileUploadArea">
      <i class="fas fa-cloud-upload-alt" id="profileUploadIcon"></i>
      <span id="profileUploadText">Click to upload</span>
      <input type="file" id="profileImage" accept="image/*" onchange="handleProfileImageUpload(this)">
    </div>
    
    <!-- Profile Thumbnail -->
    <div class="thumbnail-preview hidden" id="profilePreviewContainer">
      <img src="" alt="Preview" class="thumbnail-image" id="profilePreview">
      <div class="thumbnail-info">
        <div class="thumbnail-name" id="profilePreviewName">image.jpg</div>
        <div class="thumbnail-size" id="profilePreviewSize">0 KB</div>
      </div>
      <button class="thumbnail-remove" onclick="removeProfileImage()">√ó</button>
    </div>
  </div>
  
  <div class="input-group">
    <label>Full Name <span style="color: var(--danger);">*</span></label>
    <input type="text" id="fullName" placeholder="Enter your full name" required>
  </div>
  
  <div class="input-group">
    <label>Phone Number <span style="color: var(--danger);">*</span></label>
    <input type="tel" id="phoneNumber" placeholder="03XXXXXXXXX" required>
  </div>
  
  <div class="input-group">
    <label>Email Address</label>
    <input type="email" id="email" placeholder="your@email.com">
  </div>
  
  <div class="input-group">
    <label>Business Address <span style="color: var(--danger);">*</span></label>
    <textarea id="address" rows="2" placeholder="Complete business address" required></textarea>
  </div>
</div>

<!-- ===== BUSINESS DETAILS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-building"></i>
    <div style="min-width:0; flex:1;">
      <h2>Business Details</h2>
      <p>Your business identity</p>
    </div>
  </div>
  
  <div class="input-group">
    <label>Business Title <span style="color: var(--danger);">*</span></label>
    <input type="text" id="businessName" placeholder="Your business name" required>
  </div>
  
  <div class="input-group">
    <label>About Business</label>
    <textarea id="businessAbout" rows="3" placeholder="Describe your business..."></textarea>
  </div>
  
  <div class="input-group">
    <label>Website URL</label>
    <input type="url" id="website" placeholder="https://yourwebsite.com">
  </div>
  
  <h3 style="font-size: 15px; margin: 16px 0 10px; color: var(--dark);">Social Media Links</h3>
  
  <div class="social-grid">
    <div class="social-input">
      <i class="fab fa-facebook"></i>
      <input type="text" id="facebook" placeholder="Facebook">
    </div>
    <div class="social-input">
      <i class="fab fa-instagram"></i>
      <input type="text" id="instagram" placeholder="Instagram">
    </div>
    <div class="social-input">
      <i class="fab fa-twitter"></i>
      <input type="text" id="twitter" placeholder="Twitter">
    </div>
    <div class="social-input">
      <i class="fab fa-linkedin"></i>
      <input type="text" id="linkedin" placeholder="LinkedIn">
    </div>
    <div class="social-input">
      <i class="fab fa-youtube"></i>
      <input type="text" id="youtube" placeholder="YouTube">
    </div>
    <div class="social-input">
      <i class="fab fa-tiktok"></i>
      <input type="text" id="tiktok" placeholder="TikTok">
    </div>
  </div>
</div>

<!-- ===== BUSINESS HOURS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-clock"></i>
    <div style="min-width:0; flex:1;">
      <h2>Business Hours</h2>
      <p>Set your working days and times</p>
    </div>
  </div>
  
  <div id="daysContainer"></div>
</div>

<!-- ===== HOLIDAYS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-calendar-times"></i>
    <div style="min-width:0; flex:1;">
      <h2>Special Holidays</h2>
      <p>Days when business is closed</p>
    </div>
  </div>
  
  <div id="holidaysContainer">
    <div class="holiday-item" style="display: grid; grid-template-columns: 1fr 120px auto; gap: 8px; align-items: center; margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 12px; border: 2px solid var(--border);">
      <input type="text" class="holidayName" placeholder="Holiday name" value="Eid ul-Fitr">
      <input type="date" class="holidayDate">
      <button type="button" class="remove-btn" onclick="removeHoliday(this)" style="width: 36px; height: 36px; border-radius: 8px; background: var(--danger); color: white; border: none; cursor: pointer;">√ó</button>
    </div>
  </div>
  
  <button class="add-btn" onclick="addHoliday()" style="background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 600; width: 100%; margin-top: 8px; cursor: pointer;">
    <i class="fas fa-plus"></i> Add Holiday
  </button>
</div>

<!-- ===== DELIVERY SETTINGS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-truck"></i>
    <div style="min-width:0; flex:1;">
      <h2>Delivery Settings</h2>
      <p>Configure delivery charges and zones</p>
    </div>
  </div>
  
  <h3 style="font-size: 15px; margin: 0 0 12px; color: var(--dark);">Default Delivery</h3>
  
  <div class="row-2">
    <div class="input-group">
      <label>Within City (PKR)</label>
      <input type="number" id="deliveryChargeCity" value="150">
    </div>
    <div class="input-group">
      <label>Other Cities (PKR)</label>
      <input type="number" id="deliveryChargeOther" value="300">
    </div>
  </div>
  
  <div class="row-2">
    <div class="input-group">
      <label>Within City Time</label>
      <input type="text" id="deliveryTimeCity" value="1-2 business days">
    </div>
    <div class="input-group">
      <label>Other Cities Time</label>
      <input type="text" id="deliveryTimeOther" value="3-5 business days">
    </div>
  </div>
  
  <div class="input-group">
    <label>Free Delivery Minimum (PKR)</label>
    <input type="number" id="freeDeliveryMin" value="2000">
  </div>
  
  <div class="row-2">
    <div class="input-group">
      <label>Cutoff Time</label>
      <input type="time" id="deliveryCutoffTime" value="16:00">
    </div>
    <div class="input-group">
      <label>Max Delivery Days</label>
      <input type="text" id="deliveryDays" value="5-7 days">
    </div>
  </div>
  
  <h3 style="font-size: 15px; margin: 20px 0 12px; color: var(--dark);">Specific Zones</h3>
  
  <div id="deliveryZonesList"></div>
  
  <button class="add-btn" onclick="addDeliveryZone()" style="background: #8b5cf6; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 600; width: 100%; margin-bottom: 16px; cursor: pointer;">
    <i class="fas fa-plus"></i> Add Zone
  </button>
  
  <div style="background: #f0f9ff; border-radius: 14px; padding: 14px;">
    <div class="toggle-switch" style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
      <input type="checkbox" id="requireAddressConfirmation" checked>
      <label for="requireAddressConfirmation">Require address confirmation</label>
    </div>
    <div class="toggle-switch" style="display: flex; align-items: center; gap: 10px;">
      <input type="checkbox" id="saveCustomerAddresses" checked>
      <label for="saveCustomerAddresses">Save customer addresses</label>
    </div>
  </div>
</div>

<!-- ===== PRODUCTS WITH FIXED SIZE CARDS ===== -->
<div class="card">
  <div class="card-header">
    <i class="fas fa-gift"></i>
    <div style="min-width:0; flex:1;">
      <h2>Products & Offers</h2>
      <p>Add your products to sell</p>
    </div>
  </div>
  
  <div id="offersForm" class="products-scroll"></div>
  
  <button class="add-btn" onclick="addOffer()" style="background: #8b5cf6; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 600; width: 100%; margin-top: 12px; cursor: pointer;">
    <i class="fas fa-plus"></i> Add Product
  </button>
</div>

<!-- ===== ACTION BUTTONS ===== -->
<button class="btn btn-success" onclick="openPaymentModal()" style="margin-bottom: 12px;">
  <i class="fas fa-credit-card"></i> Configure Payments
</button>

<button class="btn btn-primary" onclick="generate()" id="generateButton">
  <i class="fas fa-magic"></i> Generate Digital Card
</button>

<!-- ===== PAYMENT MODAL ===== -->
<div class="modal" id="paymentModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-cog"></i> Payment Settings</h2>
      <button class="modal-close" onclick="closePaymentModal()">√ó</button>
    </div>
    
    <div class="modal-body" style="padding: 20px;">
      <div class="input-group">
        <label>WhatsApp Number</label>
        <input type="text" id="whatsappNumber" placeholder="+923001234567" value="+92">
      </div>
      
      <div class="row-2">
        <div class="input-group">
          <label>Token Prefix</label>
          <input type="text" id="tokenPrefix" value="TKT">
        </div>
        <div class="input-group">
          <label>Length</label>
          <select id="tokenLength">
            <option value="8">8</option>
            <option value="10">10</option>
            <option value="12" selected>12</option>
          </select>
        </div>
      </div>
      
      <div class="token-preview" style="background: #1e293b; border-radius: 14px; padding: 16px; margin: 16px 0;">
        <div class="token-code" id="tokenPreview" style="font-family: monospace; font-size: 16px; font-weight: 800; color: #10b981; text-align: center;">TKT-12345678-A1B2</div>
      </div>
      
      <div class="payment-grid" id="paymentGateways">
        <!-- JazzCash -->
        <div class="payment-card" id="gateway-jazzcash" style="border: 2px solid var(--border); border-radius: 12px; margin-bottom: 10px;">
          <div class="payment-card-header" onclick="togglePaymentGateway('jazzcash')" style="padding: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer;">
            <div style="width: 36px; height: 36px; background: #FF6B00; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">üì±</div>
            <div style="flex:1; font-weight: 600;">JazzCash</div>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="payment-fields" id="fields-jazzcash" style="padding: 0 12px 12px 58px; display: none;">
            <input type="text" id="jazzcashNumber" placeholder="Account Number" value="03001234567" style="width:100%; padding:8px; border:2px solid var(--border); border-radius:6px; margin-bottom:8px;">
          </div>
        </div>
        
        <!-- Cash on Delivery -->
        <div class="payment-card" id="gateway-cod" style="border: 2px solid var(--border); border-radius: 12px;">
          <div class="payment-card-header" onclick="togglePaymentGateway('cod')" style="padding: 12px; display: flex; align-items: center; gap: 10px; cursor: pointer;">
            <div style="width: 36px; height: 36px; background: #10b981; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">üöö</div>
            <div style="flex:1; font-weight: 600;">Cash on Delivery</div>
            <i class="fas fa-chevron-down"></i>
          </div>
          <div class="payment-fields" id="fields-cod" style="padding: 0 12px 12px 58px; display: none;">
            <input type="number" id="codMinimumOrder" value="500" style="width:100%; padding:8px; border:2px solid var(--border); border-radius:6px;">
          </div>
        </div>
      </div>
      
      <button class="btn btn-success" onclick="savePaymentAndTicketSettings()" style="margin-top: 16px;">
        Save Settings
      </button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
// ===== SUPABASE CLIENT =====
const supa = supabase.createClient(
  "https://dfvnefbxgayxqgjjgtrr.supabase.co",
  "sb_publishable_WypeFELCIlVDlqGY4PdWwA_snqoPUSE"
);

// ===== GLOBAL VARIABLES =====
let productCount = 0;
let selectedPaymentGateways = ['cod'];
let profileImageFile = null;
let productImageFiles = {};

// ===== PROFILE IMAGE HANDLER =====
function handleProfileImageUpload(input) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    
    if (!file.type.match('image.*')) {
      showSuccess('‚ùå Please select an image file');
      return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
      showSuccess('‚ùå Image size should be less than 5MB');
      return;
    }
    
    profileImageFile = file;
    
    const uploadArea = document.getElementById('profileUploadArea');
    uploadArea.classList.add('has-file');
    uploadArea.querySelector('i').className = 'fas fa-check-circle';
    uploadArea.querySelector('span').textContent = file.name.substring(0, 15) + '...';
    
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('profilePreview').src = e.target.result;
      document.getElementById('profilePreviewName').textContent = file.name;
      
      let size = file.size;
      if (size < 1024) document.getElementById('profilePreviewSize').textContent = size + ' B';
      else if (size < 1024*1024) document.getElementById('profilePreviewSize').textContent = (size/1024).toFixed(1) + ' KB';
      else document.getElementById('profilePreviewSize').textContent = (size/(1024*1024)).toFixed(1) + ' MB';
      
      document.getElementById('profilePreviewContainer').classList.remove('hidden');
    };
    reader.readAsDataURL(file);
    
    showSuccess('‚úÖ Profile image uploaded!');
  }
}

function removeProfileImage() {
  document.getElementById('profileImage').value = '';
  profileImageFile = null;
  
  const uploadArea = document.getElementById('profileUploadArea');
  uploadArea.classList.remove('has-file');
  uploadArea.querySelector('i').className = 'fas fa-cloud-upload-alt';
  uploadArea.querySelector('span').textContent = 'Click to upload';
  
  document.getElementById('profilePreviewContainer').classList.add('hidden');
  showSuccess('üóëÔ∏è Profile image removed');
}

// ===== PRODUCT IMAGE HANDLER =====
function handleProductImageUpload(input, productIndex) {
  if (input.files && input.files[0]) {
    const file = input.files[0];
    
    if (!file.type.match('image.*')) {
      showSuccess('‚ùå Please select an image file');
      return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
      showSuccess('‚ùå Image size should be less than 5MB');
      return;
    }
    
    productImageFiles[productIndex] = file;
    
    const productCard = input.closest('.product-card');
    const uploadArea = productCard.querySelector('.upload-area');
    uploadArea.classList.add('has-file');
    uploadArea.querySelector('i').className = 'fas fa-check-circle';
    uploadArea.querySelector('span').textContent = file.name.substring(0, 12) + '...';
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const preview = productCard.querySelector('.product-image-preview');
      preview.src = e.target.result;
      preview.classList.add('show');
      
      const placeholder = productCard.querySelector('.product-image-placeholder');
      placeholder.classList.add('hidden');
    };
    reader.readAsDataURL(file);
    
    showSuccess('‚úÖ Product image uploaded!');
  }
}

function removeProductImage(button) {
  const productCard = button.closest('.product-card');
  const index = productCard.dataset.index;
  
  delete productImageFiles[index];
  
  const fileInput = productCard.querySelector('.productImg');
  if (fileInput) fileInput.value = '';
  
  const uploadArea = productCard.querySelector('.upload-area');
  uploadArea.classList.remove('has-file');
  uploadArea.querySelector('i').className = 'fas fa-image';
  uploadArea.querySelector('span').textContent = 'Product Image';
  
  const preview = productCard.querySelector('.product-image-preview');
  preview.classList.remove('show');
  preview.src = '';
  
  const placeholder = productCard.querySelector('.product-image-placeholder');
  placeholder.classList.remove('hidden');
  
  showSuccess('üóëÔ∏è Product image removed');
}

// ===== BUSINESS HOURS =====
const days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
const daysContainer = document.getElementById('daysContainer');

days.forEach(day => {
  const dayBox = document.createElement('div');
  dayBox.className = 'day-box';
  dayBox.style.cssText = 'background: #f8fafc; border-radius: 12px; padding: 12px; margin-bottom: 8px; border: 2px solid var(--border);';
  dayBox.innerHTML = `
    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
      <span style="font-weight: 600; min-width: 70px;">${day}</span>
      <select style="padding: 6px; border-radius: 20px; border: 2px solid var(--border);">
        <option value="open">Open</option>
        <option value="closed">Closed</option>
      </select>
    </div>
    <div style="display: flex; align-items: center; gap: 8px;">
      <input type="time" value="09:00" style="padding: 6px; border: 2px solid var(--border); border-radius: 6px; flex:1;">
      <span>to</span>
      <input type="time" value="18:00" style="padding: 6px; border: 2px solid var(--border); border-radius: 6px; flex:1;">
    </div>
  `;
  daysContainer.appendChild(dayBox);
});

// ===== UI FUNCTIONS =====
function showSuccess(message) {
  const el = document.getElementById('successMessage');
  document.getElementById('successText').textContent = message;
  el.style.display = 'flex';
  setTimeout(() => el.style.display = 'none', 3000);
}

function showLoading() {
  document.getElementById('loadingOverlay').style.display = 'flex';
}

function hideLoading() {
  document.getElementById('loadingOverlay').style.display = 'none';
}

// ===== HOLIDAY FUNCTIONS =====
function addHoliday() {
  const container = document.getElementById('holidaysContainer');
  const item = document.createElement('div');
  item.className = 'holiday-item';
  item.style.cssText = 'display: grid; grid-template-columns: 1fr 120px auto; gap: 8px; margin-bottom: 10px; padding: 10px; background: #f8fafc; border-radius: 12px; border: 2px solid var(--border);';
  item.innerHTML = `
    <input type="text" placeholder="Holiday" style="padding:8px; border:2px solid var(--border); border-radius:6px;">
    <input type="date" value="${new Date().toISOString().split('T')[0]}" style="padding:8px; border:2px solid var(--border); border-radius:6px;">
    <button onclick="this.parentElement.remove()" style="background:var(--danger); color:white; border:none; border-radius:6px; width:36px; height:36px;">√ó</button>
  `;
  container.appendChild(item);
}

// ===== PRODUCT FUNCTIONS =====
function addOffer() {
  productCount++;
  const box = document.createElement('div');
  box.className = 'product-card';
  box.dataset.index = productCount;
  box.innerHTML = `
    <h3>Product ${productCount}</h3>
    
    <div class="product-image-container">
      <img class="product-image-preview" src="">
      <div class="product-image-placeholder">
        <i class="fas fa-image"></i>
        <span>No image</span>
      </div>
    </div>
    
    <div class="upload-area">
      <i class="fas fa-image"></i>
      <span>Product Image</span>
      <input type="file" class="productImg" accept="image/*">
    </div>
    
    <button class="btn-small" onclick="removeProductImage(this)">Remove Image</button>
    
    <input type="text" class="productTitle" placeholder="Title">
    <textarea class="productDesc" placeholder="Description" rows="2"></textarea>
    
    <div class="price-row">
      <input type="number" class="originalPrice" placeholder="Original">
      <input type="number" class="discountPrice" placeholder="Discounted">
    </div>
    
    <div class="product-badges">
      <label><input type="checkbox" value="üî• Hot"> Hot</label>
      <label><input type="checkbox" value="‚≠ê Best"> Best</label>
      <label><input type="checkbox" value="üí∏ Sale"> Sale</label>
    </div>
  `;
  
  const fileInput = box.querySelector('.productImg');
  fileInput.addEventListener('change', function() {
    handleProductImageUpload(this, productCount);
  });
  
  document.getElementById('offersForm').appendChild(box);
}

// ===== DELIVERY ZONE =====
function addDeliveryZone(zoneData = null) {
  const container = document.getElementById('deliveryZonesList');
  const item = document.createElement('div');
  item.style.cssText = 'display: grid; grid-template-columns: 1fr 80px 100px auto; gap: 6px; margin-bottom: 8px; padding: 8px; background: #f8fafc; border-radius: 8px; border: 2px solid var(--border);';
  item.innerHTML = `
    <input type="text" placeholder="City" value="${zoneData?.city || ''}" style="padding:6px; border:2px solid var(--border); border-radius:4px;">
    <input type="number" placeholder="Charge" value="${zoneData?.charge || ''}" style="padding:6px; border:2px solid var(--border); border-radius:4px;">
    <input type="text" placeholder="Time" value="${zoneData?.time || ''}" style="padding:6px; border:2px solid var(--border); border-radius:4px;">
    <button onclick="this.parentElement.remove()" style="background:var(--danger); color:white; border:none; border-radius:4px; width:32px; height:32px;">√ó</button>
  `;
  container.appendChild(item);
}

// ===== PAYMENT FUNCTIONS =====
function togglePaymentGateway(gateway) {
  const index = selectedPaymentGateways.indexOf(gateway);
  if (index === -1) selectedPaymentGateways.push(gateway);
  else selectedPaymentGateways.splice(index, 1);
  
  document.querySelectorAll('.payment-card').forEach(card => {
    card.style.borderColor = 'var(--border)';
  });
  
  selectedPaymentGateways.forEach(g => {
    const card = document.getElementById(`gateway-${g}`);
    if (card) card.style.borderColor = '#10b981';
  });
}

function testTokenGeneration() {
  const prefix = document.getElementById('tokenPrefix').value;
  const time = Date.now().toString().slice(-8);
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let random = '';
  for (let i = 0; i < 4; i++) random += chars[Math.floor(Math.random() * chars.length)];
  document.getElementById('tokenPreview').textContent = `${prefix}-${time}-${random}`;
}

function openPaymentModal() {
  document.getElementById('paymentModal').style.display = 'flex';
  testTokenGeneration();
}

function closePaymentModal() {
  document.getElementById('paymentModal').style.display = 'none';
}

function savePaymentAndTicketSettings() {
  showSuccess('‚úÖ Settings saved');
  setTimeout(closePaymentModal, 1000);
}

// ===== IMAGE RESIZE =====
function resizeImage(file) {
  return new Promise((resolve) => {
    if (!file) { resolve(''); return; }
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      let w = img.width, h = img.height;
      const max = 800;
      if (w > h && w > max) { h *= max / w; w = max; }
      else if (h > max) { w *= max / h; h = max; }
      canvas.width = w; canvas.height = h;
      canvas.getContext('2d').drawImage(img, 0, 0, w, h);
      resolve(canvas.toDataURL('image/jpeg', 0.8));
    };
    img.src = URL.createObjectURL(file);
  });
}

// ===== GENERATE =====
async function generate() {
  if (!document.getElementById('fullName').value || !document.getElementById('phoneNumber').value) {
    showSuccess('‚ùå Name & Phone required'); return;
  }
  if (!document.getElementById('businessName').value) {
    showSuccess('‚ùå Business title required'); return;
  }
  if (!document.getElementById('address').value) {
    showSuccess('‚ùå Business address required'); return;
  }
  
  showLoading();
  
  try {
    const id = crypto.randomUUID();
    
    // Products with images
    const products = [];
    const productBoxes = document.querySelectorAll('.product-card');
    
    for (let i = 0; i < productBoxes.length; i++) {
      const box = productBoxes[i];
      const index = box.dataset.index;
      const file = productImageFiles[index];
      
      const product = {
        title: box.querySelector('.productTitle').value || '',
        desc: box.querySelector('.productDesc').value || '',
        originalPrice: parseFloat(box.querySelector('.originalPrice').value) || null,
        discountPrice: parseFloat(box.querySelector('.discountPrice').value) || null,
        badges: Array.from(box.querySelectorAll('input[type=checkbox]:checked')).map(cb => cb.value),
        image: file ? await resizeImage(file) : ''
      };
      
      if (product.title || product.image) products.push(product);
    }
    
    // Payment methods
    const paymentMethods = {
      whatsapp: { number: document.getElementById('whatsappNumber').value },
      gateways: {},
      tokenSystem: {
        prefix: document.getElementById('tokenPrefix').value,
        length: parseInt(document.getElementById('tokenLength').value)
      }
    };
    
    selectedPaymentGateways.forEach(g => {
      if (g === 'cod') {
        paymentMethods.gateways.cod = { active: true, minimumOrder: 500 };
      }
    });
    
    const cardData = {
      id,
      name: document.getElementById('fullName').value,
      phone: document.getElementById('phoneNumber').value,
      email: document.getElementById('email').value,
      address: document.getElementById('address').value,
      businessName: document.getElementById('businessName').value,
      business: { about: document.getElementById('businessAbout').value },
      socialMedia: {
        facebook: document.getElementById('facebook').value,
        instagram: document.getElementById('instagram').value,
        twitter: document.getElementById('twitter').value,
        linkedin: document.getElementById('linkedin').value,
        youtube: document.getElementById('youtube').value,
        tiktok: document.getElementById('tiktok').value,
        website: document.getElementById('website').value
      },
      businessHours: [],
      holidays: [],
      products,
      payments: paymentMethods,
      deliverySettings: {
        default: {
          withinCity: { charge: 150, time: '1-2 days' },
          otherCities: { charge: 300, time: '3-5 days' }
        },
        zones: [],
        freeDeliveryMin: 2000
      },
      ticketSettings: { enabled: true },
      version: '1.0',
      created: new Date().toISOString()
    };
    
    if (profileImageFile) {
      cardData.profileImage = await resizeImage(profileImageFile);
    }
    
    const { data, error } = await supa.from('cards').insert({ id, data: JSON.stringify(cardData) }).select().single();
    if (error) throw error;
    
    localStorage.setItem('lastCardId', data.id);
    hideLoading();
    showSuccess('‚úÖ Card created!');
    setTimeout(() => location.href = 'card.html?id=' + data.id, 2000);
    
  } catch (error) {
    hideLoading();
    showSuccess('‚ùå Error: ' + error.message);
  }
}

// ===== INIT =====
document.addEventListener('DOMContentLoaded', function() {
  addDeliveryZone({city: 'Karachi', charge: 150, time: '1-2 days'});
  addDeliveryZone({city: 'Lahore', charge: 200, time: '2-3 days'});
  addOffer();
  
  // Toggle switch styles
  const style = document.createElement('style');
  style.textContent = `
    .toggle-switch input {
      appearance: none;
      width: 40px;
      height: 22px;
      background: var(--border);
      border-radius: 30px;
      position: relative;
      cursor: pointer;
    }
    .toggle-switch input:checked { background: var(--success); }
    .toggle-switch input::before {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: 0.3s;
    }
    .toggle-switch input:checked::before { left: 20px; }
  `;
  document.head.appendChild(style);
});
</script>
</body>
</html>
