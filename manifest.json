// MINIMAL Service Worker for PWA Installation
// This won't interfere with Chrome's PWA detection

const CACHE_NAME = 'business-app-v1';

// Just install and activate - no caching during install
self.addEventListener('install', event => {
  console.log('[SW] Installing PWA-friendly service worker');
  // Skip waiting to activate immediately
  event.waitUntil(self.skipWaiting());
});

// Take control immediately
self.addEventListener('activate', event => {
  console.log('[SW] Activating - taking control');
  event.waitUntil(self.clients.claim());
});

// SIMPLE fetch handler - pass through ALL requests during PWA install
// This ensures Chrome can fetch fresh resources for install validation
self.addEventListener('fetch', event => {
  // For PWA installation, Chrome needs direct network access
  // We'll cache AFTER install, not before
  event.respondWith(
    fetch(event.request)
      .then(response => {
        // Only cache after successful install
        // This prevents interference with PWA validation
        return response;
      })
      .catch(error => {
        console.log('[SW] Network failed, no cache fallback during install');
        throw error;
      })
  );
});

// IMPORTANT: This event tells you when PWA is actually installed
self.addEventListener('appinstalled', event => {
  console.log('[SW] PWA was successfully installed!');
  // Now you can enable caching
});
